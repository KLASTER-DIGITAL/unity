const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/mobile-app-0ydPxBR1.js","assets/admin-app-iwD8KRkB.js","assets/vendor-react-mA_BqLSv.js","assets/vendor-misc-DRKw7Fqf.js","assets/shared-lib-CnbwMGYH.js","assets/shared-components-D2XvDNhB.js","assets/shared-components-CmxIAlOK.css","assets/admin-features-Cuv_P1eQ.js","assets/vendor-supabase-CVL815jG.js","assets/vendor-charts-D4JKID8J.js","assets/admin-features-D0O7nwP9.css","assets/mobile-features-CYzxgWMv.js"])))=>i.map(i=>d[i]);
import{r as a,j as s,aP as M}from"./vendor-react-mA_BqLSv.js";import{_ as x}from"./admin-app-iwD8KRkB.js";import{c as U,s as W}from"./mobile-features-CYzxgWMv.js";import{Q as m}from"./shared-components-D2XvDNhB.js";import"./vendor-misc-DRKw7Fqf.js";import"./shared-lib-CnbwMGYH.js";import"./admin-features-Cuv_P1eQ.js";import"./vendor-supabase-CVL815jG.js";import"./vendor-charts-D4JKID8J.js";(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))d(e);new MutationObserver(e=>{for(const n of e)if(n.type==="childList")for(const l of n.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&d(l)}).observe(document,{childList:!0,subtree:!0});function u(e){const n={};return e.integrity&&(n.integrity=e.integrity),e.referrerPolicy&&(n.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?n.credentials="include":e.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function d(e){if(e.ep)return;e.ep=!0;const n=u(e);fetch(e.href,n)}})();const z=a.lazy(()=>x(()=>import("./mobile-app-0ydPxBR1.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11])).then(r=>({default:r.MobileApp}))),B=a.lazy(()=>x(()=>import("./admin-app-iwD8KRkB.js").then(r=>r.i),__vite__mapDeps([1,2,3,4,5,6,7,8,9,10])).then(r=>({default:r.AdminApp})));function V(){const[r,i]=a.useState(1),[u,d]=a.useState(!1),[e,n]=a.useState(null),[l,S]=a.useState(!0),[A,v]=a.useState("ru"),[j,E]=a.useState(!1),[L,p]=a.useState(!1),[C,f]=a.useState(!1),[O,g]=a.useState("register"),[P,h]=a.useState({language:"ru",diaryName:"Мой дневник",diaryEmoji:"🏆",notificationSettings:{selectedTime:"none",morningTime:"08:00",eveningTime:"21:00",permissionGranted:!1},firstEntry:""});a.useEffect(()=>{const t=()=>{const c=new URLSearchParams(window.location.search).get("view")==="admin",w=e?.profile?.role==="super_admin"||e?.role==="super_admin",b=c||w;E(b),w&&!c&&window.history.pushState({},"","?view=admin"),b&&!e&&p(!0)};return t(),window.addEventListener("popstate",t),window.addEventListener("hashchange",t),()=>{window.removeEventListener("popstate",t),window.removeEventListener("hashchange",t)}},[e]),a.useEffect(()=>{(async()=>{try{const o=await U();o&&o.success!==!1&&o.user?(n(o),o.profile?.onboardingCompleted?(d(!0),i(5)):i(2)):i(1)}catch{i(1)}finally{S(!1)}})()},[]);const _=t=>{v(t),h(o=>({...o,language:t})),i(2)},N=()=>{g("login"),f(!0)},T=()=>{i(3)},R=(t,o)=>{h(c=>({...c,diaryName:t,diaryEmoji:o})),i(4)},D=(t,o)=>{h(c=>({...c,firstEntry:t,notificationSettings:o})),g("register"),f(!0)},I=async t=>{n(t),f(!1),t.onboardingCompleted?(d(!0),i(5)):i(2)},y=async()=>{await W(),n(null),d(!1),i(1),p(!1)},k=t=>{n(t),p(!1)},K=t=>{n(o=>({...o,profile:t}))};return j?l?s.jsx(m,{defaultTheme:"system",storageKey:"unity-theme",children:s.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),s.jsx("p",{className:"text-muted-foreground",children:"Загрузка..."})]})})}):s.jsx(m,{defaultTheme:"system",storageKey:"unity-theme",children:s.jsx(B,{userData:e,showAdminAuth:L,onAuthComplete:k,onLogout:y,onBack:()=>{window.location.href="/"}})}):l?s.jsx(m,{defaultTheme:"system",storageKey:"unity-theme",children:s.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background max-w-md mx-auto",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),s.jsx("p",{className:"text-muted-foreground",children:"Загрузка..."})]})})}):s.jsx(m,{defaultTheme:"system",storageKey:"unity-theme",children:s.jsx(z,{userData:e,onboardingComplete:u,currentStep:r,selectedLanguage:A,showAuth:C,authMode:O,onboardingData:P,onWelcomeComplete:_,onWelcomeSkip:N,onOnboarding2Complete:T,onOnboarding3Complete:R,onOnboarding4Complete:D,onAuthComplete:I,onLogout:y,onProfileUpdate:K})})}window.addEventListener("vite:preloadError",r=>{window.location.reload()});window.addEventListener("error",r=>{r.error&&r.error.message&&r.error.message.includes("Loading chunk")&&window.location.reload()});window.addEventListener("unhandledrejection",r=>{});M.createRoot(document.getElementById("root")).render(s.jsx(V,{}));
