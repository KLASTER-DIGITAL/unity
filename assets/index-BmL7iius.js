const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/mobile-app-CUiA-yit.js","assets/admin-app-DIPjmXHI.js","assets/vendor-libs-D7ox_bhj.js","assets/shared-lib-CuHsX56P.js","assets/shared-components-Dj1Z_mBv.js","assets/shared-components-CmxIAlOK.css","assets/admin-features-ADDrHkXg.js","assets/vendor-supabase-YYsDQiBI.js","assets/vendor-charts-3-SxtEtK.js","assets/admin-features-D0O7nwP9.css","assets/mobile-features-CFe4Nnjl.js"])))=>i.map(i=>d[i]);
import{r as a,j as r,bp as M}from"./vendor-libs-D7ox_bhj.js";import{_ as x}from"./admin-app-DIPjmXHI.js";import{c as U,s as W}from"./mobile-features-CFe4Nnjl.js";import{Q as u}from"./shared-components-Dj1Z_mBv.js";import"./shared-lib-CuHsX56P.js";import"./admin-features-ADDrHkXg.js";import"./vendor-supabase-YYsDQiBI.js";import"./vendor-charts-3-SxtEtK.js";(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))d(e);new MutationObserver(e=>{for(const n of e)if(n.type==="childList")for(const l of n.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&d(l)}).observe(document,{childList:!0,subtree:!0});function m(e){const n={};return e.integrity&&(n.integrity=e.integrity),e.referrerPolicy&&(n.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?n.credentials="include":e.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function d(e){if(e.ep)return;e.ep=!0;const n=m(e);fetch(e.href,n)}})();const z=a.lazy(()=>x(()=>import("./mobile-app-CUiA-yit.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10])).then(s=>({default:s.MobileApp}))),B=a.lazy(()=>x(()=>import("./admin-app-DIPjmXHI.js").then(s=>s.i),__vite__mapDeps([1,2,3,4,5,6,7,8,9])).then(s=>({default:s.AdminApp})));function V(){const[s,i]=a.useState(1),[m,d]=a.useState(!1),[e,n]=a.useState(null),[l,S]=a.useState(!0),[A,v]=a.useState("ru"),[j,E]=a.useState(!1),[L,h]=a.useState(!1),[C,p]=a.useState(!1),[O,g]=a.useState("register"),[_,f]=a.useState({language:"ru",diaryName:"Мой дневник",diaryEmoji:"🏆",notificationSettings:{selectedTime:"none",morningTime:"08:00",eveningTime:"21:00",permissionGranted:!1},firstEntry:""});a.useEffect(()=>{const t=()=>{const c=new URLSearchParams(window.location.search).get("view")==="admin",y=e?.profile?.role==="super_admin"||e?.role==="super_admin",b=c||y;E(b),y&&!c&&window.history.pushState({},"","?view=admin"),b&&!e&&h(!0)};return t(),window.addEventListener("popstate",t),window.addEventListener("hashchange",t),()=>{window.removeEventListener("popstate",t),window.removeEventListener("hashchange",t)}},[e]),a.useEffect(()=>{(async()=>{try{const o=await U();o&&o.success!==!1&&o.user?(n(o),o.profile?.onboardingCompleted?(d(!0),i(5)):i(2)):i(1)}catch{i(1)}finally{S(!1)}})()},[]);const P=t=>{v(t),f(o=>({...o,language:t})),i(2)},N=()=>{g("login"),p(!0)},T=()=>{i(3)},R=(t,o)=>{f(c=>({...c,diaryName:t,diaryEmoji:o})),i(4)},D=(t,o)=>{f(c=>({...c,firstEntry:t,notificationSettings:o})),g("register"),p(!0)},I=async t=>{n(t),p(!1),t.onboardingCompleted?(d(!0),i(5)):i(2)},w=async()=>{await W(),n(null),d(!1),i(1),h(!1)},k=t=>{n(t),h(!1)},K=t=>{n(o=>({...o,profile:t}))};return j?l?r.jsx(u,{defaultTheme:"light",storageKey:"unity-theme",children:r.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background",children:r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),r.jsx("p",{className:"text-muted-foreground",children:"Загрузка..."})]})})}):r.jsx(u,{defaultTheme:"light",storageKey:"unity-theme",children:r.jsx(B,{userData:e,showAdminAuth:L,onAuthComplete:k,onLogout:w,onBack:()=>{window.location.href="/"}})}):l?r.jsx(u,{defaultTheme:"light",storageKey:"unity-theme",children:r.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background max-w-md mx-auto",children:r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),r.jsx("p",{className:"text-muted-foreground",children:"Загрузка..."})]})})}):r.jsx(u,{defaultTheme:"light",storageKey:"unity-theme",children:r.jsx(z,{userData:e,onboardingComplete:m,currentStep:s,selectedLanguage:A,showAuth:C,authMode:O,onboardingData:_,onWelcomeComplete:P,onWelcomeSkip:N,onOnboarding2Complete:T,onOnboarding3Complete:R,onOnboarding4Complete:D,onAuthComplete:I,onLogout:w,onProfileUpdate:K})})}window.addEventListener("vite:preloadError",s=>{window.location.reload()});window.addEventListener("error",s=>{s.error&&s.error.message&&s.error.message.includes("Loading chunk")&&window.location.reload()});window.addEventListener("unhandledrejection",s=>{});M.createRoot(document.getElementById("root")).render(r.jsx(V,{}));
