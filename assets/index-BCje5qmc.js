const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/mobile-app-B0gBvOiB.js","assets/admin-app-CYz180Wc.js","assets/vendor-react-BXu5E51P.js","assets/vendor-misc-Dw75T6bB.js","assets/vendor-ui-Dc_FVRD7.js","assets/vendor-utils-DMrxSiOu.js","assets/shared-lib-C_GrYo29.js","assets/shared-components-CL_26IYM.js","assets/shared-components-CmxIAlOK.css","assets/admin-features-DsatJhZL.js","assets/vendor-supabase-CVKGrTY8.js","assets/vendor-charts-BcfTLZJV.js","assets/admin-features-D0O7nwP9.css","assets/mobile-features-BpNf1VaI.js"])))=>i.map(i=>d[i]);
import{r as a,j as r,aK as M}from"./vendor-react-BXu5E51P.js";import{_ as x}from"./admin-app-CYz180Wc.js";import{c as U,s as W}from"./mobile-features-BpNf1VaI.js";import{Q as m}from"./shared-components-CL_26IYM.js";import"./vendor-misc-Dw75T6bB.js";import"./vendor-ui-Dc_FVRD7.js";import"./vendor-utils-DMrxSiOu.js";import"./shared-lib-C_GrYo29.js";import"./admin-features-DsatJhZL.js";import"./vendor-supabase-CVKGrTY8.js";import"./vendor-charts-BcfTLZJV.js";(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))d(e);new MutationObserver(e=>{for(const o of e)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&d(l)}).observe(document,{childList:!0,subtree:!0});function u(e){const o={};return e.integrity&&(o.integrity=e.integrity),e.referrerPolicy&&(o.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?o.credentials="include":e.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function d(e){if(e.ep)return;e.ep=!0;const o=u(e);fetch(e.href,o)}})();const z=a.lazy(()=>x(()=>import("./mobile-app-B0gBvOiB.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13])).then(s=>({default:s.MobileApp}))),B=a.lazy(()=>x(()=>import("./admin-app-CYz180Wc.js").then(s=>s.i),__vite__mapDeps([1,2,3,4,5,6,7,8,9,10,11,12])).then(s=>({default:s.AdminApp})));function V(){const[s,i]=a.useState(1),[u,d]=a.useState(!1),[e,o]=a.useState(null),[l,S]=a.useState(!0),[A,v]=a.useState("ru"),[j,E]=a.useState(!1),[L,p]=a.useState(!1),[C,f]=a.useState(!1),[O,g]=a.useState("register"),[_,h]=a.useState({language:"ru",diaryName:"Мой дневник",diaryEmoji:"🏆",notificationSettings:{selectedTime:"none",morningTime:"08:00",eveningTime:"21:00",permissionGranted:!1},firstEntry:""});a.useEffect(()=>{const t=()=>{const c=new URLSearchParams(window.location.search).get("view")==="admin",w=e?.profile?.role==="super_admin"||e?.role==="super_admin",b=c||w;E(b),w&&!c&&window.history.pushState({},"","?view=admin"),b&&!e&&p(!0)};return t(),window.addEventListener("popstate",t),window.addEventListener("hashchange",t),()=>{window.removeEventListener("popstate",t),window.removeEventListener("hashchange",t)}},[e]),a.useEffect(()=>{(async()=>{try{const n=await U();n&&n.success!==!1&&n.user?(o(n),n.profile?.onboardingCompleted?(d(!0),i(5)):i(2)):i(1)}catch{i(1)}finally{S(!1)}})()},[]);const P=t=>{v(t),h(n=>({...n,language:t})),i(2)},N=()=>{g("login"),f(!0)},T=()=>{i(3)},R=(t,n)=>{h(c=>({...c,diaryName:t,diaryEmoji:n})),i(4)},D=(t,n)=>{h(c=>({...c,firstEntry:t,notificationSettings:n})),g("register"),f(!0)},I=async t=>{o(t),f(!1),t.onboardingCompleted?(d(!0),i(5)):i(2)},y=async()=>{await W(),o(null),d(!1),i(1),p(!1)},K=t=>{o(t),p(!1)},k=t=>{o(n=>({...n,profile:t}))};return j?l?r.jsx(m,{defaultTheme:"system",storageKey:"unity-theme",children:r.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background",children:r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),r.jsx("p",{className:"text-muted-foreground",children:"Загрузка..."})]})})}):r.jsx(m,{defaultTheme:"system",storageKey:"unity-theme",children:r.jsx(B,{userData:e,showAdminAuth:L,onAuthComplete:K,onLogout:y,onBack:()=>{window.location.href="/"}})}):l?r.jsx(m,{defaultTheme:"system",storageKey:"unity-theme",children:r.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background max-w-md mx-auto",children:r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),r.jsx("p",{className:"text-muted-foreground",children:"Загрузка..."})]})})}):r.jsx(m,{defaultTheme:"system",storageKey:"unity-theme",children:r.jsx(z,{userData:e,onboardingComplete:u,currentStep:s,selectedLanguage:A,showAuth:C,authMode:O,onboardingData:_,onWelcomeComplete:P,onWelcomeSkip:N,onOnboarding2Complete:T,onOnboarding3Complete:R,onOnboarding4Complete:D,onAuthComplete:I,onLogout:y,onProfileUpdate:k})})}window.addEventListener("vite:preloadError",s=>{window.location.reload()});window.addEventListener("error",s=>{s.error&&s.error.message&&s.error.message.includes("Loading chunk")&&window.location.reload()});window.addEventListener("unhandledrejection",s=>{});M.createRoot(document.getElementById("root")).render(r.jsx(V,{}));
