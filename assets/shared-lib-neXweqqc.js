import{r as A,j as p}from"./vendor-libs-kWwOq1hT.js";import"./shared-components-uDOFDz2u.js";import{c as f}from"./admin-features-kRsOojRn.js";const m={get OS(){return typeof window<"u"&&typeof document<"u"?"web":typeof navigator<"u"&&navigator.product==="ReactNative"?"native":"web"},get isWeb(){return this.OS==="web"},get isNative(){return this.OS==="native"},get hasDOMAPI(){return typeof window<"u"&&typeof document<"u"&&typeof localStorage<"u"},get isBrowser(){return typeof window<"u"&&typeof window.location<"u"},get isPWA(){if(!this.isBrowser)return!1;const n=window.matchMedia("(display-mode: standalone)").matches,e=window.navigator.standalone===!0;return n||e},select(n){if(this.isWeb&&n.web!==void 0)return n.web;if(this.isNative&&n.native!==void 0)return n.native;if(n.default!==void 0)return n.default;throw new Error(`No implementation found for platform "${this.OS}". Available: ${Object.keys(n).join(", ")}`)},execute(n){const e=this.select(n);typeof e=="function"&&e()},value(n,e,t){return this.select({web:n,native:e,default:t??n})}};m.value(50*1024*1024,20*1024*1024,10*1024*1024),m.value(["image/jpeg","image/png","image/webp","image/gif"],["image/jpeg","image/png"],["image/jpeg","image/png"]),m.value(["video/mp4","video/webm","video/ogg"],["video/mp4"],["video/mp4"]),m.value(300,250,300),m.value(0,50,0);class N{isAvailable(){try{if(typeof localStorage>"u")return!1;const e="__storage_test__";return localStorage.setItem(e,"test"),localStorage.removeItem(e),!0}catch{return!1}}async getItem(e){try{return this.isAvailable()?localStorage.getItem(e):null}catch{return null}}async setItem(e,t){try{if(!this.isAvailable())return;localStorage.setItem(e,t)}catch(a){throw a}}async removeItem(e){try{if(!this.isAvailable())return;localStorage.removeItem(e)}catch(t){throw t}}async clear(){try{if(!this.isAvailable())return;localStorage.clear()}catch(e){throw e}}async getAllKeys(){try{return this.isAvailable()?Object.keys(localStorage):[]}catch{return[]}}async multiGet(e){try{return this.isAvailable()?e.map(t=>[t,localStorage.getItem(t)]):e.map(t=>[t,null])}catch{return e.map(a=>[a,null])}}async multiSet(e){try{if(!this.isAvailable())return;e.forEach(([t,a])=>{localStorage.setItem(t,a)})}catch(t){throw t}}async multiRemove(e){try{if(!this.isAvailable())return;e.forEach(t=>{localStorage.removeItem(t)})}catch(t){throw t}}}class O{async getItem(e){return null}async setItem(e,t){}async removeItem(e){}async clear(){}async getAllKeys(){return[]}async multiGet(e){return e.map(t=>[t,null])}async multiSet(e){}async multiRemove(e){}}class x{storage=new Map;async getItem(e){return this.storage.get(e)??null}async setItem(e,t){this.storage.set(e,t)}async removeItem(e){this.storage.delete(e)}async clear(){this.storage.clear()}async getAllKeys(){return Array.from(this.storage.keys())}async multiGet(e){return e.map(t=>[t,this.storage.get(t)??null])}async multiSet(e){e.forEach(([t,a])=>{this.storage.set(t,a)})}async multiRemove(e){e.forEach(t=>{this.storage.delete(t)})}}const y=m.select({web:new N,native:new O,default:new x});class g{static CACHE_PREFIX="i18n_cache_";static LAST_SYNC_KEY="i18n_last_sync";static DEFAULT_CONFIG={maxAge:1440*60*1e3,maxSize:1024*1024,compressionEnabled:!0};static async getCache(e){const t=this.CACHE_PREFIX+e,a=await y.getItem(t);if(!a)return null;try{const r=JSON.parse(a);return this.isCacheExpired(r)?(await this.removeCache(e),null):this.validateCacheIntegrity(r)?r:(await this.removeCache(e),null)}catch{return await this.removeCache(e),null}}static async setCache(e,t,a){const r={language:e,translations:t,version:this.generateVersion(),lastUpdated:new Date().toISOString(),etag:a,checksum:this.calculateChecksum(t)},i=this.CACHE_PREFIX+e;try{const s=JSON.stringify(r);this.DEFAULT_CONFIG.compressionEnabled&&this.getSizeInBytes(s)>this.DEFAULT_CONFIG.maxSize&&await this.cleanupOldCache(),await y.setItem(i,s),await y.setItem(this.LAST_SYNC_KEY,new Date().toISOString())}catch(s){await this.handleStorageError(s)}}static isCacheExpired(e){return Date.now()-new Date(e.lastUpdated).getTime()>this.DEFAULT_CONFIG.maxAge}static async removeCache(e){const t=this.CACHE_PREFIX+e;await y.removeItem(t)}static async clearCache(){const t=(await y.getAllKeys()).filter(a=>a.startsWith(this.CACHE_PREFIX));await y.multiRemove([...t,this.LAST_SYNC_KEY])}static async getLastSync(){const e=await y.getItem(this.LAST_SYNC_KEY);return e?new Date(e):null}static async getCacheETag(e){return(await this.getCache(e))?.etag}static async getCachedLanguages(){return(await y.getAllKeys()).filter(t=>t.startsWith(this.CACHE_PREFIX)).map(t=>t.replace(this.CACHE_PREFIX,""))}static async validateAllCaches(){const e=await this.getCachedLanguages(),t=[],a=[];for(const r of e){const i=await this.getCache(r);i&&this.validateCacheIntegrity(i)?t.push(r):(a.push(r),await this.removeCache(r))}return{valid:t,invalid:a}}static async getCacheStats(){const e=await this.getCachedLanguages();let t=0,a=0,r=null,i=null;for(const s of e){const o=this.CACHE_PREFIX+s,l=await y.getItem(o);if(l){t+=this.getSizeInBytes(l);try{const d=JSON.parse(l);a+=Object.keys(d.translations).length;const c=new Date(d.lastUpdated);(!r||c<r)&&(r=c),(!i||c>i)&&(i=c)}catch{}}}return{totalSize:t,languagesCount:e.length,totalKeys:a,oldestCache:r,newestCache:i}}static generateVersion(){return Date.now().toString()}static calculateChecksum(e){const t=JSON.stringify(e);return btoa(t).slice(0,16)}static validateCacheIntegrity(e){return!!(e.language&&e.translations&&typeof e.translations=="object"&&Object.keys(e.translations).length>0&&e.lastUpdated&&e.version)}static getSizeInBytes(e){return new Blob([e]).size}static async handleStorageError(e){e.name==="QuotaExceededError"?await this.cleanupOldCache():e.name}static async cleanupOldCache(){const t=(await y.getAllKeys()).filter(o=>o.startsWith(this.CACHE_PREFIX)),a=await Promise.all(t.map(async o=>{try{const l=await y.getItem(o),d=JSON.parse(l||"{}");return{key:o,lastUpdated:new Date(d.lastUpdated||0),size:this.getSizeInBytes(l||"")}}catch{return{key:o,lastUpdated:new Date(0),size:0}}}));a.sort((o,l)=>o.lastUpdated.getTime()-l.lastUpdated.getTime()),a.reduce((o,l)=>o+l.size,0);const r=this.DEFAULT_CONFIG.maxSize*.5;let i=0;const s=[];a.forEach(({key:o,size:l})=>{i<r&&(s.push(o),i+=l)}),await y.multiRemove(s)}static async exportCache(){const e={},t=await this.getCachedLanguages();for(const a of t){const r=await this.getCache(a);r&&(e[a]=r)}return e}static async importCache(e){for(const[t,a]of Object.entries(e))this.validateCacheIntegrity(a)&&await this.setCache(t,a.translations,a.etag)}}const E="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVjdXd1enFsd2Rra2RuY2FtcG5jIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjAwNTg2OTQsImV4cCI6MjA3NTYzNDY5NH0.OnBM1BIQMVgJur2nM4gZGDW-PWWwSR92DpJHhPpqB88";class T{static BASE_URL="https://ecuwuzqlwdkkdncampnc.supabase.co/functions/v1/translations-api";static ADMIN_API_URL="https://ecuwuzqlwdkkdncampnc.supabase.co/functions/v1/admin-api";static async getSupportedLanguages(){try{const e=await fetch(`${this.BASE_URL}/languages`,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${E}`}});if(!e.ok)throw new Error(`Failed to fetch languages: ${e.status} ${e.statusText}`);const t=await e.json();if(!t.success)throw new Error(t.error||"Failed to fetch languages");return t.languages||[]}catch{return this.getFallbackLanguages()}}static async getTranslations(e,t){try{const a={"Content-Type":"application/json",Authorization:`Bearer ${E}`};t?.etag&&(a["If-None-Match"]=t.etag);const r=await fetch(`${this.BASE_URL}/${e}`,{headers:a});if(r.status===304){const l=g.getCache(e);if(l)return l.translations}if(!r.ok)throw new Error(`Failed to fetch translations: ${r.status} ${r.statusText}`);const i=await r.json();if(!i.success)throw new Error(i.error||"Failed to fetch translations");const s=r.headers.get("ETag"),o=i.translations||{};return t?.useCache!==!1&&g.setCache(e,o,s||void 0),o}catch(a){const r=g.getCache(e);if(r)return r.translations;throw a}}static async getTranslationKeys(){try{const e=await fetch(`${this.BASE_URL}/keys`,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${E}`}});if(!e.ok)throw new Error(`Failed to fetch keys: ${e.status} ${e.statusText}`);const t=await e.json();if(!t.success)throw new Error(t.error||"Failed to fetch keys");return t.keys||[]}catch{return this.getFallbackKeys()}}static async reportMissingTranslation(e,t,a){try{const r={key:e,language:t,context:a,userAgent:navigator.userAgent,timestamp:new Date().toISOString()};(await fetch(`${this.BASE_URL}/missing`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${E}`},body:JSON.stringify(r)})).ok}catch{}}static async getTranslationStats(){try{const e=localStorage.getItem("sb-ecuwuzqlwdkkdncampnc-auth-token"),t=await fetch(`${this.ADMIN_API_URL}/admin/translation-stats`,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`}});if(!t.ok)throw new Error(`Failed to fetch stats: ${t.status}`);const a=await t.json();if(!a.success)throw new Error(a.error||"Failed to fetch stats");return a.stats}catch{return{totalKeys:0,translatedKeys:{},progress:{},lastUpdated:{}}}}static async updateTranslations(e,t){try{const a=localStorage.getItem("sb-ecuwuzqlwdkkdncampnc-auth-token"),r=await fetch(`${this.ADMIN_API_URL}/admin/translations`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({language:e,translations:t})});if(!r.ok)throw new Error(`Failed to update translations: ${r.status}`);const i=await r.json();if(!i.success)throw new Error(i.error||"Failed to update translations");return g.setCache(e,t),!0}catch{return!1}}static async autoTranslate(e,t){try{const a=localStorage.getItem("sb-ecuwuzqlwdkkdncampnc-auth-token"),r=localStorage.getItem("admin_openai_api_key");if(!r)throw new Error("OpenAI API key not configured");const i=await fetch(`${this.ADMIN_API_URL}/admin/translate`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`,"X-OpenAI-Key":r},body:JSON.stringify({sourceLanguage:e,targetLanguages:t})});if(!i.ok)throw new Error(`Auto-translation failed: ${i.status}`);const s=await i.json();if(!s.success)throw new Error(s.error||"Auto-translation failed");for(const o of t){const l=s.results[o]?.reduce((d,c)=>(d[c.key]=c.translatedText,d),{});l&&Object.keys(l).length>0&&g.setCache(o,l)}return{success:!0,results:s.results}}catch(a){return{success:!1,results:{},error:a instanceof Error?a.message:"Unknown error"}}}static async healthCheck(){try{return(await fetch(`${this.BASE_URL}/health`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${E}`}})).ok}catch{return!1}}static getFallbackLanguages(){return[{code:"ru",name:"Russian",native_name:"Русский",flag:"🇷🇺",is_active:!0},{code:"en",name:"English",native_name:"English",flag:"🇺🇸",is_active:!0},{code:"es",name:"Spanish",native_name:"Español",flag:"🇪🇸",is_active:!0},{code:"de",name:"German",native_name:"Deutsch",flag:"🇩🇪",is_active:!1},{code:"fr",name:"French",native_name:"Français",flag:"🇫🇷",is_active:!1},{code:"zh",name:"Chinese",native_name:"中文",flag:"🇨🇳",is_active:!1},{code:"ja",name:"Japanese",native_name:"日本語",flag:"🇯🇵",is_active:!1}]}static getFallbackKeys(){return["welcome_title","start_button","skip","next","back","home","history","achievements","reports","settings","greeting","today_question","input_placeholder","send","save","cancel_button","delete","sign_in","sign_up","your_email","password","notifications","language","support","family","work","finance","gratitude","health","personal_development","creativity","relationships","connected_to_ai","ai_help","history_title","select_language","diary_name","first_entry","reminders"]}}class S{static DEFAULT_TIMEOUT=1e4;static DEFAULT_RETRY_COUNT=3;static RETRY_DELAY=1e3;static async loadTranslations(e){const{language:t,fallbackLanguage:a="ru",forceRefresh:r=!1,timeout:i=this.DEFAULT_TIMEOUT,retryCount:s=this.DEFAULT_RETRY_COUNT}=e;let o=0;for(;o<s;)try{return await this.attemptLoad({language:t,fallbackLanguage:a,forceRefresh:r,timeout:i,attempt:o})}catch{o++,o<s&&await this.delay(this.RETRY_DELAY*o)}return this.loadFallback(a)}static async attemptLoad(e){const{language:t,fallbackLanguage:a,forceRefresh:r,timeout:i,attempt:s}=e;if(!r&&s===0){const l=g.getCache(t);if(l&&!this.isCacheStale(l))return{translations:l.translations,language:t,usedFallback:!1,fromCache:!0}}const o=await this.withTimeout(T.getTranslations(t,{useCache:!0,etag:s===0?g.getCacheETag(t):void 0}),i);if(Object.keys(o).length===0)throw new Error("No translations received from API");return{translations:o,language:t,usedFallback:!1,fromCache:!1}}static async loadFallback(e){const t=g.getCache(e);if(t)return{translations:t.translations,language:e,usedFallback:!0,fromCache:!0};try{return{translations:await this.withTimeout(T.getTranslations(e),this.DEFAULT_TIMEOUT),language:e,usedFallback:!0,fromCache:!1}}catch{return{translations:this.getBuiltinTranslations(e),language:e,usedFallback:!0,fromCache:!1}}}static async preloadLanguages(e,t={}){const a=e.map(r=>this.loadTranslations({...t,language:r}).then(i=>{}).catch(i=>null));await Promise.allSettled(a)}static async validateCache(){try{const t=(await T.getSupportedLanguages()).map(a=>a.code);for(const a of t){const r=g.getCache(a);r&&(this.validateCacheIntegrity(r)||g.removeCache(a))}Object.keys(localStorage).filter(a=>a.startsWith("i18n_cache_")).forEach(a=>{const r=a.replace("i18n_cache_","");t.includes(r)||g.removeCache(r)})}catch{}}static async clearAllTranslations(){g.clearCache(),Object.keys(localStorage).filter(e=>e.startsWith("i18n_")).forEach(e=>localStorage.removeItem(e))}static getLoadingStats(){return{cacheStats:g.getCacheStats(),lastSync:g.getLastSync(),supportedLanguages:g.getCachedLanguages()}}static async withTimeout(e,t){const a=new Promise((r,i)=>{setTimeout(()=>i(new Error(`Timeout after ${t}ms`)),t)});return Promise.race([e,a])}static delay(e){return new Promise(t=>setTimeout(t,e))}static isCacheStale(e){return Date.now()-new Date(e.lastUpdated).getTime()>864e5}static validateCacheIntegrity(e){return!!(e.language&&e.translations&&typeof e.translations=="object"&&Object.keys(e.translations).length>0&&e.lastUpdated&&e.version)}static getBuiltinTranslations(e){const t={ru:{welcome_title:"Создавай дневник побед",start_button:"Начать",skip:"Пропустить",next:"Далее",back:"Назад",home:"Главная",settings:"Настройки",loading_translations:"Загрузка переводов...",translation_error:"Ошибка загрузки переводов",retry:"Повторить",cancel_button:"Отмена",select_language:"Выберите язык",language:"Язык"},en:{welcome_title:"Create a victory diary",start_button:"Get Started",skip:"Skip",next:"Next",back:"Back",home:"Home",settings:"Settings",loading_translations:"Loading translations...",translation_error:"Translation loading error",retry:"Retry",cancel_button:"Cancel",select_language:"Select language",language:"Language"}};return t[e]||t.ru}static async debugInfo(){return{currentCache:g.exportCache(),loadingStats:this.getLoadingStats(),apiHealth:await T.healthCheck(),localStorageUsage:JSON.stringify(localStorage).length}}}const I={ru:{greeting:"Привет!",todayQuestion:"Как прошёл день?",home:"Главная",history:"История",awards:"Награды",reviews:"Отчёты",settings:"Настройки",inputPlaceholder:"Расскажите о своём дне...",searchPlaceholder:"Поиск записей...",addPhoto:"Добавить фото",send:"Отправить",save:"Сохранить",cancel:"Отмена",delete:"Удалить",back:"Назад",next:"Далее",skip:"Пропустить",start_button:"Начать",alreadyHaveAccount:"У меня уже есть аккаунт",signIn:"Войти",signUp:"Регистрация",signInWith:"Войти через",signUpWith:"Регистрация через",yourEmail:"Ваш email",yourName:"Ваше имя",password:"Пароль",welcomeBack:"Добро пожаловать!",createAccount:"Создать аккаунт",notRegisteredYet:"Еще не зарегистрированы?",alreadyHaveAccountAuth:"Уже есть аккаунт?",notifications:"Уведомления",dailyReminders:"Ежедневные напоминания",weeklyReports:"Еженедельные отчёты",newAchievements:"Новые достижения",motivationalMessages:"Мотивационные сообщения",themes:"Темы",security:"Безопасность",language:"Язык",support:"Поддержка",appLanguage:"Язык приложения",currentLanguage:"Текущий язык",changeLanguage:"Изменить язык",firstDayOfWeek:"Первый день недели",monday:"Понедельник",importData:"Импорт данных",contactSupport:"Связаться с поддержкой",rateApp:"Оценить приложение",faq:"Часто задаваемые вопросы",dangerousZone:"Опасная зона",logout:"Выйти",deleteAllData:"Удалить все данные",appVersion:"Версия приложения",appSubtitle:"Дневник Достижений",family:"Семья",work:"Работа",finance:"Финансы",gratitude:"Благодарность",health:"Здоровье",personalDevelopment:"Личное развитие",creativity:"Творчество",relationships:"Отношения",defaultCard1Title:"Отличный день!",defaultCard1Description:"Вы сделали важный шаг к своим целям",defaultCard2Title:"Продолжайте!",defaultCard2Description:"Каждый день приближает вас к успеху",defaultCard3Title:"Вы молодец!",defaultCard3Description:"Ваши усилия не останутся незамеченными",connectedToAI:"Подключено к ИИ",aiHelp:"Помощь ИИ",aiHelpDescription:"ИИ поможет проанализировать ваши записи",historyTitle:"История записей",foundEntries:"Найдено записей",filters:"Фильтры",welcomeTitle:"Создавай дневник побед",selectLanguage:"Выберите язык",diaryName:"Название дневника",firstEntry:"Первая запись",reminders:"Напоминания",select_language:"Выберите язык",app_language_description:"Выберите язык интерфейса приложения",loading_translations:"Загрузка переводов...",translation_error:"Ошибка загрузки переводов",retry:"Повторить",cancel_button:"Отмена",auto_translate:"Автоперевод",translation_progress:"Прогресс перевода",untranslated_keys:"Непереведенные ключи",translation_complete:"Перевод завершен",translation_failed:"Ошибка перевода"},en:{greeting:"Hello!",todayQuestion:"How was your day?",home:"Home",history:"History",awards:"Awards",reviews:"Reports",settings:"Settings",inputPlaceholder:"Tell us about your day...",searchPlaceholder:"Search entries...",addPhoto:"Add Photo",send:"Send",save:"Save",cancel:"Cancel",delete:"Delete",back:"Back",next:"Next",skip:"Skip",start_button:"Get Started",alreadyHaveAccount:"I already have an account",signIn:"Sign In",signUp:"Sign Up",signInWith:"Sign in with",signUpWith:"Sign up with",yourEmail:"Your email",yourName:"Your name",password:"Password",welcomeBack:"Welcome back!",createAccount:"Create account",notRegisteredYet:"Not registered yet?",alreadyHaveAccountAuth:"Already have an account?",notifications:"Notifications",dailyReminders:"Daily reminders",weeklyReports:"Weekly reports",newAchievements:"New achievements",motivationalMessages:"Motivational messages",themes:"Themes",security:"Security",language:"Language",support:"Support",appLanguage:"App language",currentLanguage:"Current language",changeLanguage:"Change language",firstDayOfWeek:"First day of week",monday:"Monday",importData:"Import data",contactSupport:"Contact support",rateApp:"Rate app",faq:"FAQ",dangerousZone:"Dangerous zone",logout:"Logout",deleteAllData:"Delete all data",appVersion:"App version",appSubtitle:"Achievement Diary",family:"Family",work:"Work",finance:"Finance",gratitude:"Gratitude",health:"Health",personalDevelopment:"Personal Development",creativity:"Creativity",relationships:"Relationships",defaultCard1Title:"Great day!",defaultCard1Description:"You made an important step towards your goals",defaultCard2Title:"Keep going!",defaultCard2Description:"Every day brings you closer to success",defaultCard3Title:"You are great!",defaultCard3Description:"Your efforts will not go unnoticed",connectedToAI:"Connected to AI",aiHelp:"AI Help",aiHelpDescription:"AI will help analyze your entries",historyTitle:"Entry History",foundEntries:"Found entries",filters:"Filters",welcomeTitle:"Create a victory diary",selectLanguage:"Select language",diaryName:"Diary name",firstEntry:"First entry",reminders:"Reminders",select_language:"Select language",app_language_description:"Choose the interface language for the app",loading_translations:"Loading translations...",translation_error:"Translation loading error",retry:"Retry",cancel_button:"Cancel",auto_translate:"Auto-translate",translation_progress:"Translation progress",untranslated_keys:"Untranslated keys",translation_complete:"Translation complete",translation_failed:"Translation failed"},es:{greeting:"¡Hola!",todayQuestion:"¿Cómo fue tu día?",home:"Inicio",history:"Historial",awards:"Premios",reviews:"Informes",settings:"Configuración",inputPlaceholder:"Cuéntanos sobre tu día...",searchPlaceholder:"Buscar entradas...",addPhoto:"Agregar foto",send:"Enviar",save:"Guardar",cancel:"Cancelar",delete:"Eliminar",back:"Atrás",next:"Siguiente",skip:"Omitir",start_button:"Comenzar",alreadyHaveAccount:"Ya tengo una cuenta",signIn:"Iniciar sesión",signUp:"Registrarse",signInWith:"Iniciar sesión con",signUpWith:"Registrarse con",yourEmail:"Tu email",yourName:"Tu nombre",password:"Contraseña",welcomeBack:"¡Bienvenido!",createAccount:"Crear cuenta",notRegisteredYet:"¿Aún no estás registrado?",alreadyHaveAccountAuth:"¿Ya tienes una cuenta?",notifications:"Notificaciones",dailyReminders:"Recordatorios diarios",weeklyReports:"Informes semanales",newAchievements:"Nuevos logros",motivationalMessages:"Mensajes motivacionales",themes:"Temas",security:"Seguridad",language:"Idioma",support:"Soporte",appLanguage:"Idioma de la app",currentLanguage:"Idioma actual",changeLanguage:"Cambiar idioma",firstDayOfWeek:"Primer día de la semana",monday:"Lunes",importData:"Importar datos",contactSupport:"Contactar soporte",rateApp:"Calificar app",faq:"Preguntas frecuentes",dangerousZone:"Zona peligrosa",logout:"Cerrar sesión",deleteAllData:"Eliminar todos los datos",appVersion:"Versión de la app",appSubtitle:"Diario de Logros",family:"Familia",work:"Trabajo",finance:"Finanzas",gratitude:"Gratitud",health:"Salud",personalDevelopment:"Desarrollo personal",creativity:"Creatividad",relationships:"Relaciones",defaultCard1Title:"¡Excelente día!",defaultCard1Description:"Diste un paso importante hacia tus objetivos",defaultCard2Title:"¡Continúa!",defaultCard2Description:"Cada día te acerca más al éxito",defaultCard3Title:"¡Eres genial!",defaultCard3Description:"Tus esfuerzos no pasarán desapercibidos",connectedToAI:"Conectado a IA",aiHelp:"Ayuda de IA",aiHelpDescription:"La IA te ayudará a analizar tus entradas",historyTitle:"Historial de entradas",foundEntries:"Entradas encontradas",filters:"Filtros",welcomeTitle:"Crea un diario de victorias",selectLanguage:"Seleccionar idioma",diaryName:"Nombre del diario",firstEntry:"Primera entrada",reminders:"Recordatorios",select_language:"Seleccionar idioma",app_language_description:"Elige el idioma de la interfaz de la aplicación",loading_translations:"Cargando traducciones...",translation_error:"Error al cargar traducciones",retry:"Reintentar",cancel_button:"Cancelar",auto_translate:"Traducción automática",translation_progress:"Progreso de traducción",untranslated_keys:"Claves no traducidas",translation_complete:"Traducción completa",translation_failed:"Error de traducción"},de:{greeting:"Hallo!",todayQuestion:"Wie war dein Tag?",home:"Startseite",history:"Verlauf",awards:"Auszeichnungen",reviews:"Berichte",settings:"Einstellungen",inputPlaceholder:"Erzähl uns von deinem Tag...",searchPlaceholder:"Einträge suchen...",addPhoto:"Foto hinzufügen",send:"Senden",save:"Speichern",cancel:"Abbrechen",delete:"Löschen",back:"Zurück",next:"Weiter",skip:"Überspringen",start_button:"Beginnen",alreadyHaveAccount:"Ich habe bereits ein Konto",signIn:"Anmelden",signUp:"Registrieren",signInWith:"Anmelden mit",signUpWith:"Registrieren mit",yourEmail:"Deine E-Mail",yourName:"Dein Name",password:"Passwort",welcomeBack:"Willkommen zurück!",createAccount:"Konto erstellen",notRegisteredYet:"Noch nicht registriert?",alreadyHaveAccountAuth:"Hast du bereits ein Konto?",notifications:"Benachrichtigungen",dailyReminders:"Tägliche Erinnerungen",weeklyReports:"Wöchentliche Berichte",newAchievements:"Neue Erfolge",motivationalMessages:"Motivationsnachrichten",themes:"Themen",security:"Sicherheit",language:"Sprache",support:"Support",appLanguage:"App-Sprache",currentLanguage:"Aktuelle Sprache",changeLanguage:"Sprache ändern",firstDayOfWeek:"Erster Tag der Woche",monday:"Montag",importData:"Daten importieren",contactSupport:"Support kontaktieren",rateApp:"App bewerten",faq:"Häufige Fragen",dangerousZone:"Gefahrenzone",logout:"Abmelden",deleteAllData:"Alle Daten löschen",appVersion:"App-Version",appSubtitle:"Erfolgs-Tagebuch",family:"Familie",work:"Arbeit",finance:"Finanzen",gratitude:"Dankbarkeit",health:"Gesundheit",personalDevelopment:"Persönliche Entwicklung",creativity:"Kreativität",relationships:"Beziehungen",defaultCard1Title:"Großartiger Tag!",defaultCard1Description:"Du hast einen wichtigen Schritt zu deinen Zielen gemacht",defaultCard2Title:"Weiter so!",defaultCard2Description:"Jeder Tag bringt dich dem Erfolg näher",defaultCard3Title:"Du bist großartig!",defaultCard3Description:"Deine Anstrengungen werden nicht unbemerkt bleiben",connectedToAI:"Mit KI verbunden",aiHelp:"KI-Hilfe",aiHelpDescription:"KI hilft dir beim Analysieren deiner Einträge",historyTitle:"Einträge-Verlauf",foundEntries:"Gefundene Einträge",filters:"Filter",welcomeTitle:"Erstelle ein Siegestagebuch",selectLanguage:"Sprache auswählen",diaryName:"Tagebuch-Name",firstEntry:"Erster Eintrag",reminders:"Erinnerungen",select_language:"Sprache auswählen",app_language_description:"Wählen Sie die Sprache der App-Oberfläche",loading_translations:"Übersetzungen werden geladen...",translation_error:"Fehler beim Laden der Übersetzungen",retry:"Wiederholen",cancel_button:"Abbrechen",auto_translate:"Automatische Übersetzung",translation_progress:"Übersetzungsfortschritt",untranslated_keys:"Nicht übersetzte Schlüssel",translation_complete:"Übersetzung abgeschlossen",translation_failed:"Übersetzung fehlgeschlagen"},fr:{greeting:"Bonjour!",todayQuestion:"Comment s'est passé votre journée?",home:"Accueil",history:"Historique",awards:"Récompenses",reviews:"Rapports",settings:"Paramètres",inputPlaceholder:"Parlez-nous de votre journée...",searchPlaceholder:"Rechercher des entrées...",addPhoto:"Ajouter une photo",send:"Envoyer",save:"Enregistrer",cancel:"Annuler",delete:"Supprimer",back:"Retour",next:"Suivant",skip:"Ignorer",start_button:"Commencer",alreadyHaveAccount:"J'ai déjà un compte",signIn:"Se connecter",signUp:"S'inscrire",signInWith:"Se connecter avec",signUpWith:"S'inscrire avec",yourEmail:"Votre email",yourName:"Votre nom",password:"Mot de passe",welcomeBack:"Bon retour!",createAccount:"Créer un compte",notRegisteredYet:"Pas encore inscrit?",alreadyHaveAccountAuth:"Vous avez déjà un compte?",notifications:"Notifications",dailyReminders:"Rappels quotidiens",weeklyReports:"Rapports hebdomadaires",newAchievements:"Nouveaux succès",motivationalMessages:"Messages motivationnels",themes:"Thèmes",security:"Sécurité",language:"Langue",support:"Support",appLanguage:"Langue de l'app",currentLanguage:"Langue actuelle",changeLanguage:"Changer de langue",firstDayOfWeek:"Premier jour de la semaine",monday:"Lundi",importData:"Importer des données",contactSupport:"Contacter le support",rateApp:"Noter l'app",faq:"FAQ",dangerousZone:"Zone dangereuse",logout:"Se déconnecter",deleteAllData:"Supprimer toutes les données",appVersion:"Version de l'app",appSubtitle:"Journal des Succès",family:"Famille",work:"Travail",finance:"Finances",gratitude:"Gratitude",health:"Santé",personalDevelopment:"Développement personnel",creativity:"Créativité",relationships:"Relations",defaultCard1Title:"Excellente journée!",defaultCard1Description:"Vous avez fait un pas important vers vos objectifs",defaultCard2Title:"Continuez!",defaultCard2Description:"Chaque jour vous rapproche du succès",defaultCard3Title:"Vous êtes formidable!",defaultCard3Description:"Vos efforts ne passeront pas inaperçus",connectedToAI:"Connecté à l'IA",aiHelp:"Aide IA",aiHelpDescription:"L'IA vous aidera à analyser vos entrées",historyTitle:"Historique des entrées",foundEntries:"Entrées trouvées",filters:"Filtres",welcomeTitle:"Créez un journal de victoires",selectLanguage:"Sélectionner la langue",diaryName:"Nom du journal",firstEntry:"Première entrée",reminders:"Rappels",select_language:"Sélectionner la langue",app_language_description:"Choisissez la langue de l'interface de l'application",loading_translations:"Chargement des traductions...",translation_error:"Erreur de chargement des traductions",retry:"Réessayer",cancel_button:"Annuler",auto_translate:"Traduction automatique",translation_progress:"Progression de la traduction",untranslated_keys:"Clés non traduites",translation_complete:"Traduction terminée",translation_failed:"Échec de la traduction"},zh:{greeting:"你好！",todayQuestion:"今天过得怎么样？",home:"首页",history:"历史",awards:"奖项",reviews:"报告",settings:"设置",inputPlaceholder:"告诉我们你的一天...",searchPlaceholder:"搜索条目...",addPhoto:"添加照片",send:"发送",save:"保存",cancel:"取消",delete:"删除",back:"返回",next:"下一步",skip:"跳过",start_button:"开始",alreadyHaveAccount:"我已有账户",signIn:"登录",signUp:"注册",signInWith:"使用以下方式登录",signUpWith:"使用以下方式注册",yourEmail:"您的邮箱",yourName:"您的姓名",password:"密码",welcomeBack:"欢迎回来！",createAccount:"创建账户",notRegisteredYet:"还没有注册？",alreadyHaveAccountAuth:"已有账户？",notifications:"通知",dailyReminders:"每日提醒",weeklyReports:"周报",newAchievements:"新成就",motivationalMessages:"励志消息",themes:"主题",security:"安全",language:"语言",support:"支持",appLanguage:"应用语言",currentLanguage:"当前语言",changeLanguage:"更改语言",firstDayOfWeek:"一周的第一天",monday:"星期一",importData:"导入数据",contactSupport:"联系支持",rateApp:"评价应用",faq:"常见问题",dangerousZone:"危险区域",logout:"退出登录",deleteAllData:"删除所有数据",appVersion:"应用版本",appSubtitle:"成就日记",family:"家庭",work:"工作",finance:"财务",gratitude:"感恩",health:"健康",personalDevelopment:"个人发展",creativity:"创造力",relationships:"关系",defaultCard1Title:"美好的一天！",defaultCard1Description:"您朝着目标迈出了重要一步",defaultCard2Title:"继续加油！",defaultCard2Description:"每一天都让您更接近成功",defaultCard3Title:"您很棒！",defaultCard3Description:"您的努力不会被忽视",connectedToAI:"已连接AI",aiHelp:"AI帮助",aiHelpDescription:"AI将帮助分析您的条目",historyTitle:"条目历史",foundEntries:"找到的条目",filters:"过滤器",welcomeTitle:"创建胜利日记",selectLanguage:"选择语言",diaryName:"日记名称",firstEntry:"第一条记录",reminders:"提醒",select_language:"选择语言",app_language_description:"选择应用程序界面语言",loading_translations:"正在加载翻译...",translation_error:"翻译加载错误",retry:"重试",cancel_button:"取消",auto_translate:"自动翻译",translation_progress:"翻译进度",untranslated_keys:"未翻译的键",translation_complete:"翻译完成",translation_failed:"翻译失败"},ja:{greeting:"こんにちは！",todayQuestion:"今日はどうでしたか？",home:"ホーム",history:"履歴",awards:"受賞",reviews:"レポート",settings:"設定",inputPlaceholder:"今日のことを教えてください...",searchPlaceholder:"エントリを検索...",addPhoto:"写真を追加",send:"送信",save:"保存",cancel:"キャンセル",delete:"削除",back:"戻る",next:"次へ",skip:"スキップ",start_button:"始める",alreadyHaveAccount:"アカウントをお持ちです",signIn:"サインイン",signUp:"サインアップ",signInWith:"でサインイン",signUpWith:"でサインアップ",yourEmail:"あなたのメール",yourName:"あなたの名前",password:"パスワード",welcomeBack:"おかえりなさい！",createAccount:"アカウントを作成",notRegisteredYet:"まだ登録していませんか？",alreadyHaveAccountAuth:"すでにアカウントをお持ちですか？",notifications:"通知",dailyReminders:"日次リマインダー",weeklyReports:"週次レポート",newAchievements:"新しい成果",motivationalMessages:"モチベーションメッセージ",themes:"テーマ",security:"セキュリティ",language:"言語",support:"サポート",appLanguage:"アプリ言語",currentLanguage:"現在の言語",changeLanguage:"言語を変更",firstDayOfWeek:"週の最初の日",monday:"月曜日",importData:"データをインポート",contactSupport:"サポートに連絡",rateApp:"アプリを評価",faq:"よくある質問",dangerousZone:"危険ゾーン",logout:"ログアウト",deleteAllData:"すべてのデータを削除",appVersion:"アプリバージョン",appSubtitle:"成果日記",family:"家族",work:"仕事",finance:"財務",gratitude:"感謝",health:"健康",personalDevelopment:"個人の成長",creativity:"創造性",relationships:"人間関係",defaultCard1Title:"素晴らしい日！",defaultCard1Description:"目標に向けて重要な一歩を踏み出しました",defaultCard2Title:"続けてください！",defaultCard2Description:"毎日が成功に近づきます",defaultCard3Title:"あなたは素晴らしい！",defaultCard3Description:"あなたの努力は見過ごされません",connectedToAI:"AIに接続済み",aiHelp:"AIヘルプ",aiHelpDescription:"AIがエントリの分析をサポートします",historyTitle:"エントリ履歴",foundEntries:"見つかったエントリ",filters:"フィルター",welcomeTitle:"勝利の日記を作成",selectLanguage:"言語を選択",diaryName:"日記の名前",firstEntry:"最初のエントリ",reminders:"リマインダー",select_language:"言語を選択",app_language_description:"アプリのインターフェース言語を選択してください",loading_translations:"翻訳を読み込み中...",translation_error:"翻訳の読み込みエラー",retry:"再試行",cancel_button:"キャンセル",auto_translate:"自動翻訳",translation_progress:"翻訳の進行状況",untranslated_keys:"未翻訳のキー",translation_complete:"翻訳完了",translation_failed:"翻訳失敗"}};function k(n){return I[n]||I.ru}const L=A.createContext(null),U=(n,e)=>{switch(e.type){case"SET_LOADING":return{...n,isLoading:e.payload};case"SET_ERROR":return{...n,error:e.payload};case"SET_LANGUAGE":return{...n,currentLanguage:e.payload};case"SET_TRANSLATIONS":return{...n,cache:new Map(n.cache).set(e.payload.language,{language:e.payload.language,translations:e.payload.translations,version:Date.now().toString(),lastUpdated:new Date().toISOString()})};case"CLEAR_CACHE":return{...n,cache:new Map};case"SET_LOADED":return{...n,isLoaded:e.payload};default:return n}},q=({children:n,defaultLanguage:e="ru",fallbackLanguage:t="ru"})=>{const[a,r]=A.useReducer(U,{currentLanguage:e,isLoading:!1,error:null,isLoaded:!1,cache:new Map,fallbackLanguage:t}),i=async c=>{r({type:"SET_LOADING",payload:!0}),r({type:"SET_ERROR",payload:null});try{const u=await S.loadTranslations({language:c,fallbackLanguage:t,forceRefresh:!1});r({type:"SET_TRANSLATIONS",payload:{language:u.language,translations:u.translations}}),u.usedFallback&&u.language!==c&&r({type:"SET_LANGUAGE",payload:u.language}),r({type:"SET_LOADED",payload:!0})}catch(u){const h=u instanceof Error?u.message:"Unknown error";if(r({type:"SET_ERROR",payload:h}),c!==t)await i(t);else{const w=k(t);r({type:"SET_TRANSLATIONS",payload:{language:t,translations:w}}),r({type:"SET_LOADED",payload:!0})}}finally{r({type:"SET_LOADING",payload:!1})}},s=async c=>{a.currentLanguage!==c&&(r({type:"SET_LANGUAGE",payload:c}),r({type:"SET_LOADED",payload:!1}),await i(c))},o=async()=>{g.removeCache(a.currentLanguage),r({type:"SET_LOADED",payload:!1}),await i(a.currentLanguage)},l=(c,u)=>{const h=a.cache.get(a.currentLanguage);if(h?.translations[c])return h.translations[c];if(a.currentLanguage!==a.fallbackLanguage){const v=a.cache.get(a.fallbackLanguage);if(v?.translations[c])return v.translations[c]}const w=k(a.currentLanguage);if(w[c])return w[c];const _=u||c;return S.loadTranslations({language:a.currentLanguage}).then(()=>{a.cache.get(a.currentLanguage)?.translations[c]}).catch(v=>{}),_};A.useEffect(()=>{(async()=>{try{await S.validateCache(),await i(a.currentLanguage)}catch{}})()},[]);const d={state:a,changeLanguage:s,refreshTranslations:o,t:l,isLoading:a.isLoading,error:a.error,currentLanguage:a.currentLanguage,isLoaded:a.isLoaded};return p.jsx(L.Provider,{value:d,children:n})},R=()=>{const n=A.useContext(L);if(!n)throw new Error("useTranslationContext must be used within TranslationProvider");return n},Z=({children:n,preloadLanguages:e=["en"],onLanguageChange:t,validateCacheOnMount:a=!0})=>{const{currentLanguage:r,changeLanguage:i,isLoading:s,error:o,isLoaded:l}=R(),[d,c]=A.useState(!1),[u,h]=A.useState(null);return A.useEffect(()=>{(async()=>{try{a&&await S.validateCache(),e.length>0&&await S.preloadLanguages(e),c(!0),h(null)}catch(_){h(_ instanceof Error?_.message:"Unknown error"),c(!0)}})()},[e,a]),A.useEffect(()=>{t?.(r)},[r,t]),d?u&&!l?p.jsx("div",{className:"flex items-center justify-center min-h-screen bg-background",children:p.jsxs("div",{className:"text-center max-w-md mx-auto p-6",children:[p.jsx("div",{className:"text-red-500 text-4xl mb-4",children:"⚠️"}),p.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Initialization Error"}),p.jsx("p",{className:"text-muted-foreground mb-4",children:"We had trouble setting up the app, but we'll try to continue with basic functionality."}),p.jsx("div",{className:"text-sm text-red-500 bg-red-50 p-3 rounded",children:u})]})}):p.jsx(p.Fragment,{children:n}):p.jsx("div",{className:"flex items-center justify-center min-h-screen bg-background",children:p.jsxs("div",{className:"text-center max-w-md mx-auto p-6",children:[p.jsx("div",{className:"w-12 h-12 border-4 border-primary border-t-transparent rounded-full animate-spin mx-auto mb-4"}),p.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Setting up your experience"}),p.jsx("p",{className:"text-muted-foreground mb-4",children:"Loading translations and preparing the app..."}),u&&p.jsxs("div",{className:"text-sm text-red-500 bg-red-50 p-3 rounded",children:["Error: ",u]})]})})},X=()=>{const{t:n,changeLanguage:e,currentLanguage:t,isLoading:a,error:r,isLoaded:i,state:s,refreshTranslations:o}=R();return{t:n,changeLanguage:e,currentLanguage:t,isLoading:a,error:r,isLoaded:i,refreshTranslations:o,hasTranslation:l=>!!s.cache.get(t)?.translations[l],getAvailableLanguages:()=>Array.from(s.cache.keys()),isLanguageLoaded:l=>s.cache.has(l)}},b="ecuwuzqlwdkkdncampnc",F=`https://${b}.supabase.co/functions/v1/profiles`,P=`https://${b}.supabase.co/functions/v1/ai-analysis`,D=`https://${b}.supabase.co/functions/v1/motivations`,j=`https://${b}.supabase.co/functions/v1/media`,z=`https://${b}.supabase.co/functions/v1/transcription-api`;async function M(n,e={}){const{method:t="GET",body:a,headers:r={}}=e,i=f(),{data:{session:s}}=await i.auth.getSession();if(!s?.access_token)throw new Error("No active session. Please log in.");const o={"Content-Type":"application/json",Authorization:`Bearer ${s.access_token}`,...r},l={method:t,headers:o};a&&t!=="GET"&&(l.body=JSON.stringify(a));try{const d=await fetch(`${F}${n}`,l),c=await d.text();let u;try{u=JSON.parse(c)}catch{throw new Error(`Invalid JSON response: ${c.substring(0,100)}`)}if(!d.ok)throw new Error(u.error||`API request failed: ${d.status} ${d.statusText}`);return u}catch(d){throw d}}async function Q(n,e,t){try{const a=f(),{data:{session:r}}=await a.auth.getSession();if(!r?.access_token)throw new Error("No active session. Please log in.");const i=await fetch(P,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r.access_token}`},body:JSON.stringify({text:n,userName:e,userId:t})});if(!i.ok){const o=await i.text();throw new Error(`AI analysis failed: ${i.status} ${i.statusText}`)}const s=await i.json();if(!s.success)throw new Error(s.error||"AI analysis failed");return s.analysis}catch{return{sentiment:"positive",category:"Другое",tags:[],reply:"Записано! 💪 Продолжай отмечать свои достижения!",summary:n.substring(0,50)+(n.length>50?"...":""),insight:"Каждая запись приближает тебя к цели!",isAchievement:!0,mood:"хорошее",confidence:.5}}}async function ee(n){const e=f(),{data:t,error:a}=await e.from("entries").insert({user_id:n.userId,text:n.text,sentiment:n.sentiment||"neutral",category:n.category||"Другое",mood:n.mood||"нормальное",is_first_entry:n.isFirstEntry||!1,media:n.media||null,ai_reply:n.aiReply||"",ai_summary:n.aiSummary||null,ai_insight:n.aiInsight||null,is_achievement:n.isAchievement||!1,tags:n.tags||[],streak_day:n.streakDay||1,focus_area:n.focusArea||n.category||"Другое",created_at:new Date().toISOString()}).select().single();if(a)throw new Error(a.message);return{id:t.id,userId:t.user_id,text:t.text,sentiment:t.sentiment,category:t.category,mood:t.mood,isFirstEntry:t.is_first_entry,media:t.media,aiReply:t.ai_reply,aiSummary:t.ai_summary,aiInsight:t.ai_insight,isAchievement:t.is_achievement,tags:t.tags,streakDay:t.streak_day,focusArea:t.focus_area,createdAt:t.created_at,aiResponse:t.ai_reply}}async function te(n,e=50){const t=f(),{data:a,error:r}=await t.from("entries").select("*").eq("user_id",n).order("created_at",{ascending:!1}).limit(e);if(r)throw new Error(r.message||"Failed to fetch entries");return a.map(s=>({id:s.id,userId:s.user_id,text:s.text,sentiment:s.sentiment,category:s.category,mood:s.mood,isFirstEntry:s.is_first_entry,media:s.media,aiReply:s.ai_reply,aiSummary:s.ai_summary,aiInsight:s.ai_insight,isAchievement:s.is_achievement,tags:s.tags,streakDay:s.streak_day,focusArea:s.focus_area,createdAt:s.created_at,voiceUrl:s.voice_url,mediaUrl:s.media_url}))}async function ae(n,e){const t=f(),a={};e.text!==void 0&&(a.text=e.text),e.sentiment!==void 0&&(a.sentiment=e.sentiment),e.category!==void 0&&(a.category=e.category),e.mood!==void 0&&(a.mood=e.mood);const{data:r,error:i}=await t.from("entries").update(a).eq("id",n).select().single();if(i)throw new Error(i.message||"Failed to update entry");return{id:r.id,userId:r.user_id,text:r.text,sentiment:r.sentiment,category:r.category,mood:r.mood,isFirstEntry:r.is_first_entry,media:r.media,aiReply:r.ai_reply,aiSummary:r.ai_summary,aiInsight:r.ai_insight,isAchievement:r.is_achievement,tags:r.tags,streakDay:r.streak_day,focusArea:r.focus_area,createdAt:r.created_at,voiceUrl:r.voice_url,mediaUrl:r.media_url}}async function re(n,e){const t=f(),{error:a}=await t.from("entries").delete().eq("id",n);if(a)throw new Error(a.message||"Failed to delete entry")}async function ne(n){const e=f(),{data:t,error:a}=await e.from("entries").select("*").eq("user_id",n).order("created_at",{ascending:!1});if(a)throw new Error(a.message||"Failed to fetch stats");const r=t?.length||0,i={};t?.forEach(c=>{const u=c.category||"Другое";i[u]=(i[u]||0)+1});const s={};t?.forEach(c=>{const u=c.sentiment||"neutral";s[u]=(s[u]||0)+1});let o=0;if(t&&t.length>0){const c=t.map(h=>new Date(h.created_at).setHours(0,0,0,0)).sort((h,w)=>w-h),u=new Date().setHours(0,0,0,0);if(c.length>0){const h=c[0];if(Math.floor((u-h)/(1e3*60*60*24))<=1){o=1;let _=h-1e3*60*60*24;for(let v=1;v<c.length&&c[v]===_;v++)o++,_-=1e3*60*60*24}}}const l=t&&t.length>0?t[0].created_at:null;return{totalEntries:r,currentStreak:o,categoryCounts:i,sentimentCounts:s,lastEntryDate:l}}async function se(n,e){const t=await M(`/${n}`,{method:"PUT",body:e});if(!t.success)throw new Error("Failed to update profile");return t.profile}async function ie(n,e,t){const a=await C(n),r=f(),{data:{session:i}}=await r.auth.getSession();if(!i?.access_token)throw new Error("No active session");const s=await fetch(`${z}/transcribe`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i.access_token}`},body:JSON.stringify({audio:a,mimeType:n.type,userId:e,language:"ru"})});if(!s.ok)throw await s.text(),new Error(`Transcription failed: ${s.statusText}`);const o=await s.json();if(!o.success)throw new Error(o.error||"Transcription failed");return o.text}async function oe(n,e,t){const a=await C(n);let r;t?.thumbnail&&(r=await C(t.thumbnail));const i=f(),{data:{session:s}}=await i.auth.getSession();if(!s?.access_token)throw new Error("No active session");const o={file:a,fileName:n.name,mimeType:n.type,userId:e,thumbnail:r,width:t?.width,height:t?.height,duration:t?.duration,entryId:t?.entryId};try{const l=new AbortController,d=setTimeout(()=>l.abort(),1e4),c=await fetch(`${j}/upload`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s.access_token}`},body:JSON.stringify(o),signal:l.signal});if(clearTimeout(d),!c.ok)throw new Error(`Microservice returned ${c.status}`);const u=await c.json();if(!u.success)throw new Error(u.error||"Microservice returned error");const h=n.type.startsWith("image/")?"image":"video";return{id:u.id||"",userId:e,fileName:n.name,filePath:u.path,fileType:h,fileSize:n.size,createdAt:new Date().toISOString(),url:u.url,path:u.path,type:h,mimeType:u.mimeType}}catch(l){throw new Error("Failed to upload media: "+l.message)}}function C(n){return new Promise((e,t)=>{const a=new FileReader;a.onloadend=()=>{const r=a.result.split(",")[1];e(r)},a.onerror=t,a.readAsDataURL(n)})}async function ce(n){const e=f(),{data:{session:t}}=await e.auth.getSession();if(!t?.access_token)throw new Error("No active session");try{const a=new AbortController,r=setTimeout(()=>a.abort(),5e3),i=await fetch(`${D}/cards/${n}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t.access_token}`},signal:a.signal});if(clearTimeout(r),!i.ok)throw new Error(`Microservice returned ${i.status}`);const s=await i.json();if(!s.success)throw new Error(s.error||"Microservice returned error");return s.cards||[]}catch(a){throw new Error("Failed to fetch motivation cards: "+a.message)}}async function le(n,e){const t=f(),{data:{session:a}}=await t.auth.getSession();if(!a?.access_token)throw new Error("No active session");try{const r=new AbortController,i=setTimeout(()=>r.abort(),5e3),s=await fetch(`${D}/mark-read`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a.access_token}`},body:JSON.stringify({userId:n,cardId:e}),signal:r.signal});if(clearTimeout(i),!s.ok)throw new Error(`Microservice returned ${s.status}`);const o=await s.json();if(!o.success)throw new Error(o.error||"Microservice returned error")}catch(r){throw new Error("Failed to mark card as read: "+r.message)}}class B{async readAsDataURL(e){return new Promise((t,a)=>{const r=new FileReader;r.onload=i=>{t(i.target?.result)},r.onerror=()=>{a(new Error("Failed to read file as data URL"))},r.readAsDataURL(e)})}async readAsArrayBuffer(e){return new Promise((t,a)=>{const r=new FileReader;r.onload=i=>{t(i.target?.result)},r.onerror=()=>{a(new Error("Failed to read file as array buffer"))},r.readAsArrayBuffer(e)})}async readAsText(e){return new Promise((t,a)=>{const r=new FileReader;r.onload=i=>{t(i.target?.result)},r.onerror=()=>{a(new Error("Failed to read file as text"))},r.readAsText(e)})}createObjectURL(e){return URL.createObjectURL(e)}revokeObjectURL(e){URL.revokeObjectURL(e)}async getImageDimensions(e){return new Promise((t,a)=>{const r=new FileReader;r.onload=i=>{const s=new Image;s.onload=()=>{t({width:s.width,height:s.height})},s.onerror=()=>{a(new Error("Failed to load image"))},s.src=i.target?.result},r.onerror=()=>{a(new Error("Failed to read image file"))},r.readAsDataURL(e)})}async getVideoMetadata(e){return new Promise((t,a)=>{const r=document.createElement("video");r.preload="metadata",r.onloadedmetadata=()=>{URL.revokeObjectURL(r.src),t({duration:Math.round(r.duration),width:r.videoWidth,height:r.videoHeight})},r.onerror=()=>{a(new Error("Failed to load video metadata"))},r.src=URL.createObjectURL(e)})}createCanvas(e,t){const a=document.createElement("canvas");return a.width=e,a.height=t,a}createImage(){return new Image}createVideo(){return document.createElement("video")}}class H{async readAsDataURL(e){throw new Error("NativeMediaAdapter not implemented yet")}async readAsArrayBuffer(e){throw new Error("NativeMediaAdapter not implemented yet")}async readAsText(e){throw new Error("NativeMediaAdapter not implemented yet")}createObjectURL(e){throw new Error("NativeMediaAdapter not implemented yet")}revokeObjectURL(e){}async getImageDimensions(e){throw new Error("NativeMediaAdapter not implemented yet")}async getVideoMetadata(e){throw new Error("NativeMediaAdapter not implemented yet")}createCanvas(e,t){throw new Error("NativeMediaAdapter not implemented yet")}createImage(){throw new Error("NativeMediaAdapter not implemented yet")}createVideo(){throw new Error("NativeMediaAdapter not implemented yet")}}class ${async readAsDataURL(e){return"data:text/plain;base64,"}async readAsArrayBuffer(e){return new ArrayBuffer(0)}async readAsText(e){return""}createObjectURL(e){return"blob:memory://fallback"}revokeObjectURL(e){}async getImageDimensions(e){return{width:0,height:0}}async getVideoMetadata(e){return{duration:0,width:0,height:0}}createCanvas(e,t){return{width:e,height:t,getContext:()=>null,toDataURL:()=>"data:image/png;base64,"}}createImage(){return{width:0,height:0,onload:null,onerror:null,src:""}}createVideo(){return{duration:0,videoWidth:0,videoHeight:0,onloadedmetadata:null,onerror:null,src:""}}}const ue=m.select({web:new B,native:new H,default:new $});class W{history=null;location=null;constructor(){m.isBrowser&&typeof window<"u"&&(this.history=window.history,this.location=window.location)}navigate(e,t){if(m.isBrowser)try{const a=this.buildUrl(e,t?.params);t?.replace?this.history?.replaceState(null,"",a):this.history?.pushState(null,"",a),window.dispatchEvent(new PopStateEvent("popstate"))}catch{}}goBack(){if(m.isBrowser)try{this.history?.back()}catch{}}replace(e,t){this.navigate(e,{...t,replace:!0})}reset(e,t){if(m.isBrowser)try{const a=this.buildUrl(e,t?.params);this.history?.replaceState(null,"",a),window.dispatchEvent(new PopStateEvent("popstate"))}catch{}}getCurrentRoute(){return!m.isBrowser||!this.location?"/":this.location.pathname+this.location.search+this.location.hash}canGoBack(){return m.isBrowser?window.history.length>1:!1}addListener(e,t){if(!m.isBrowser)return()=>{};const r={focus:"focus",blur:"blur",beforeRemove:"beforeunload",state:"popstate"}[e]||e,i=s=>{t({type:e,target:s.target,data:s.state})};return window.addEventListener(r,i),()=>{window.removeEventListener(r,i)}}buildUrl(e,t){if(!t||Object.keys(t).length===0)return e;const a=new URL(e,window.location.origin);return Object.entries(t).forEach(([r,i])=>{i!==void 0&&a.searchParams.set(r,String(i))}),a.pathname+a.search+a.hash}}class G{navigate(e,t){}goBack(){}replace(e,t){}reset(e,t){}getCurrentRoute(){return"/"}canGoBack(){return!1}addListener(e,t){return()=>{}}}class K{currentRoute="/";history=["/"];listeners={};navigate(e,t){t?.replace?this.history[this.history.length-1]=e:this.history.push(e),this.currentRoute=e,this.emit("state",{route:e})}goBack(){this.history.length>1&&(this.history.pop(),this.currentRoute=this.history[this.history.length-1],this.emit("state",{route:this.currentRoute}))}replace(e,t){this.navigate(e,{...t,replace:!0})}reset(e,t){this.history=[e],this.currentRoute=e,this.emit("state",{route:e})}getCurrentRoute(){return this.currentRoute}canGoBack(){return this.history.length>1}addListener(e,t){return this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t),()=>{const a=this.listeners[e]?.indexOf(t);a!==void 0&&a>-1&&this.listeners[e].splice(a,1)}}emit(e,t){this.listeners[e]?.forEach(a=>{try{a(t)}catch{}})}}m.select({web:new W,native:new G,default:new K});export{q as T,Z as a,oe as b,Q as c,ee as d,ce as e,ne as f,te as g,le as h,re as i,ae as j,se as k,ue as m,ie as t,X as u};
