# Role-Based Access Control (RBAC)

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-10-21  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P0 - –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

---

## üìã –û–±–∑–æ—Ä

UNITY-v2 –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—Ç—Ä–æ–≥–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ –º–µ–∂–¥—É –æ–±—ã—á–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ PWA –∏ —Å—É–ø–µ—Ä-–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º–∏. –°–∏—Å—Ç–µ–º–∞ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç —á—Ç–æ:

- **–°—É–ø–µ—Ä-–∞–¥–º–∏–Ω—ã** –∏–º–µ—é—Ç –¥–æ—Å—Ç—É–ø –¢–û–õ–¨–ö–û –∫ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ (`/?view=admin`)
- **–û–±—ã—á–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏** –∏–º–µ—é—Ç –¥–æ—Å—Ç—É–ø –¢–û–õ–¨–ö–û –∫ PWA –∫–∞–±–∏–Ω–µ—Ç—É
- –ü–æ–ø—ã—Ç–∫–∏ –¥–æ—Å—Ç—É–ø–∞ –∫ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–º—É –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è

---

## üîê –†–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### 1. `user` - –û–±—ã—á–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å

**–î–æ—Å—Ç—É–ø:**
- ‚úÖ PWA –∫–∞–±–∏–Ω–µ—Ç (`/`)
- ‚úÖ –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–Ω–µ–≤–Ω–∏–∫–∞ (–∑–∞–ø–∏—Å–∏, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞, –Ω–∞—Å—Ç—Ä–æ–π–∫–∏)
- ‚ùå –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å (`/?view=admin`)

**–•—Ä–∞–Ω–µ–Ω–∏–µ:**
```sql
SELECT role FROM profiles WHERE id = auth.uid();
-- –†–µ–∑—É–ª—å—Ç–∞—Ç: 'user'
```

### 2. `super_admin` - –°—É–ø–µ—Ä-–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä

**–î–æ—Å—Ç—É–ø:**
- ‚úÖ –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å (`/?view=admin`)
- ‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏, –ø–µ—Ä–µ–≤–æ–¥–∞–º–∏, —è–∑—ã–∫–∞–º–∏
- ‚úÖ AI –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- ‚ùå PWA –∫–∞–±–∏–Ω–µ—Ç (`/`)

**–•—Ä–∞–Ω–µ–Ω–∏–µ:**
```sql
SELECT role FROM profiles WHERE id = auth.uid();
-- –†–µ–∑—É–ª—å—Ç–∞—Ç: 'super_admin'
```

**–¢–µ–∫—É—â–∏–µ —Å—É–ø–µ—Ä-–∞–¥–º–∏–Ω—ã:**
- `diary@leadshunter.biz`

---

## üõ°Ô∏è –¢–æ—á–∫–∏ –∫–æ–Ω—Ç—Ä–æ–ª—è –¥–æ—Å—Ç—É–ø–∞

### 1. –§–æ—Ä–º—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

#### PWA –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (`AuthScreenNew.tsx`)

```typescript
// –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –≤—Ö–æ–¥–∞
if (result.profile.role === 'super_admin') {
  toast.error("–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω", {
    description: "–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /?view=admin –¥–ª—è –≤—Ö–æ–¥–∞ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å"
  });
  await supabase.auth.signOut();
  return;
}
```

**–ü–æ–≤–µ–¥–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–æ–ª—å –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- –ï—Å–ª–∏ `super_admin` ‚Üí –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ—à–∏–±–∫—É –∏ –≤—ã—Ö–æ–¥–∏—Ç –∏–∑ —Å–∏—Å—Ç–µ–º—ã
- –ï—Å–ª–∏ `user` ‚Üí –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –≤—Ö–æ–¥ –≤ PWA

#### –ê–¥–º–∏–Ω –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (`AdminLoginScreen.tsx`)

```typescript
// –ü–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è
if (profileData.profile.role !== 'super_admin') {
  toast.error("–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω", {
    description: "–£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –∫ –ø–∞–Ω–µ–ª–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞"
  });
  await supabase.auth.signOut();
  return;
}
```

**–ü–æ–≤–µ–¥–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–æ–ª—å –∏–∑ –ë–î (–Ω–µ hardcoded email)
- –ï—Å–ª–∏ –ù–ï `super_admin` ‚Üí –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ—à–∏–±–∫—É –∏ –≤—ã—Ö–æ–¥–∏—Ç
- –ï—Å–ª–∏ `super_admin` ‚Üí –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –≤—Ö–æ–¥ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å

---

### 2. –ó–∞—â–∏—Ç–∞ –º–∞—Ä—à—Ä—É—Ç–æ–≤ (`App.tsx`)

#### –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

```typescript
useEffect(() => {
  const initSession = async () => {
    const session = await checkSession();
    
    if (session && session.user) {
      const urlParams = new URLSearchParams(window.location.search);
      const isAdminView = urlParams.get('view') === 'admin';
      const userRole = session.profile?.role || session.role;

      // –û–±—ã—á–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—ã—Ç–∞–µ—Ç—Å—è –æ—Ç–∫—Ä—ã—Ç—å –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
      if (isAdminView && userRole !== 'super_admin') {
        window.location.href = '/';
        return;
      }

      // –°—É–ø–µ—Ä-–∞–¥–º–∏–Ω –ø—ã—Ç–∞–µ—Ç—Å—è –æ—Ç–∫—Ä—ã—Ç—å PWA –∫–∞–±–∏–Ω–µ—Ç
      if (!isAdminView && userRole === 'super_admin') {
        window.location.href = '/?view=admin';
        return;
      }
    }
  };

  initSession();
}, []);
```

**–ü–æ–≤–µ–¥–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–æ–ª—å –ø—Ä–∏ –∫–∞–∂–¥–æ–π –∑–∞–≥—Ä—É–∑–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∏—Ç –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
- –†–∞–±–æ—Ç–∞–µ—Ç –¥–∞–∂–µ –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç URL –≤—Ä—É—á–Ω—É—é

#### –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –º–∞—Ä—à—Ä—É—Ç–∞

```typescript
useEffect(() => {
  const checkAdminRoute = () => {
    const urlParams = new URLSearchParams(window.location.search);
    const isAdminParam = urlParams.get('view') === 'admin';

    if (userData) {
      const userRole = userData.profile?.role || userData.role;

      if (isAdminParam && userRole !== 'super_admin') {
        window.location.href = '/';
        return;
      }

      if (!isAdminParam && userRole === 'super_admin') {
        window.location.href = '/?view=admin';
        return;
      }
    }
  };

  checkAdminRoute();
  window.addEventListener('popstate', checkAdminRoute);
  window.addEventListener('hashchange', checkAdminRoute);

  return () => {
    window.removeEventListener('popstate', checkAdminRoute);
    window.removeEventListener('hashchange', checkAdminRoute);
  };
}, [userData]);
```

**–ü–æ–≤–µ–¥–µ–Ω–∏–µ:**
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è URL (–∫–Ω–æ–ø–∫–∏ –Ω–∞–∑–∞–¥/–≤–ø–µ—Ä–µ–¥)
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–æ–ª—å –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –º–∞—Ä—à—Ä—É—Ç–∞
- –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –æ–±—Ö–æ–¥ —á–µ—Ä–µ–∑ –Ω–∞–≤–∏–≥–∞—Ü–∏—é –±—Ä–∞—É–∑–µ—Ä–∞

---

### 3. Edge Functions

#### `profiles` Edge Function

```typescript
// GET /profiles/:userId
const profile = {
  id: data.id,
  name: data.name,
  email: data.email,
  role: data.role, // üîí SECURITY: Add role for access control
  // ... other fields
};
```

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `role` –≤ GET –∏ CREATE endpoints
- –í–µ—Ä—Å–∏—è 4 –∑–∞–¥–µ–ø–ª–æ–µ–Ω–∞
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–æ–ª–∏ –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ

#### `admin-api` Edge Function

```typescript
// –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–∏ —á–µ—Ä–µ–∑ service role (–æ–±—Ö–æ–¥ RLS)
const { data: profile } = await supabaseAdmin
  .from('profiles')
  .select('role')
  .eq('id', user.id)
  .single();

if (profile.role !== 'super_admin') {
  return new Response(
    JSON.stringify({ error: 'Forbidden: Super admin access required' }),
    { status: 403 }
  );
}
```

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `supabaseAdmin` (service role) –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–æ–ª–∏
- –û–±—Ö–æ–¥–∏—Ç RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏
- –í–µ—Ä—Å–∏—è 8 –∑–∞–¥–µ–ø–ª–æ–µ–Ω–∞

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç-–∫–µ–π—Å—ã

| # | –°—Ü–µ–Ω–∞—Ä–∏–π | –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç | –°—Ç–∞—Ç—É—Å |
|---|----------|---------------------|--------|
| 1 | –°—É–ø–µ—Ä-–∞–¥–º–∏–Ω ‚Üí PWA –≤—Ö–æ–¥ | –û—à–∏–±–∫–∞ "–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /?view=admin", –∞–≤—Ç–æ–≤—ã—Ö–æ–¥ | ‚úÖ –ü–†–û–ô–î–ï–ù |
| 2 | –°—É–ø–µ—Ä-–∞–¥–º–∏–Ω ‚Üí PWA –∫–∞–±–∏–Ω–µ—Ç –Ω–∞–ø—Ä—è–º—É—é | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/?view=admin` | ‚úÖ –ü–†–û–ô–î–ï–ù |
| 3 | PWA –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí –Ω–æ—Ä–º–∞–ª—å–Ω—ã–π –≤—Ö–æ–¥ | –£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥ –≤ PWA –∫–∞–±–∏–Ω–µ—Ç | ‚è∏Ô∏è –ü–†–û–ü–£–©–ï–ù* |
| 4 | PWA –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å | –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/` –∏–ª–∏ –æ—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ | ‚è∏Ô∏è –ü–†–û–ü–£–©–ï–ù* |
| 5 | –°—É–ø–µ—Ä-–∞–¥–º–∏–Ω ‚Üí –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π URL | –£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å | ‚úÖ –ü–†–û–ô–î–ï–ù |

*–¢–µ—Å—Ç—ã 3-4 –ø—Ä–æ–ø—É—â–µ–Ω—ã –∏–∑-–∑–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –ø–∞—Ä–æ–ª—è –¥–ª—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

**–î–∞—Ç–∞:** 2025-10-21  
**–ú–µ—Ç–æ–¥:** Chrome MCP (–∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)  
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ 3 –∏–∑ 3 –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ–π–¥–µ–Ω—ã

**–ö–æ–Ω—Å–æ–ª—å –ª–æ–≥–∏:**
```
[LOG] üö´ Access denied: super_admin cannot access PWA, redirecting to admin panel
[LOG] Profile found: {role: 'super_admin', ...}
[LOG] Admin stats loaded: {totalUsers: 14, totalEntries: 36, ...}
```

---

## üìä –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ü—Ä–æ–≤–µ—Ä–∫–∞ Supabase Advisors

**–î–∞—Ç–∞:** 2025-10-21

**Security:**
- ‚úÖ 0 –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º
- ‚ö†Ô∏è 1 WARN: Leaked Password Protection Disabled (P2, –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ)

**Performance:**
- ‚úÖ 0 –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º
- ‚ÑπÔ∏è 7 INFO: Unused Indexes (–æ—Å—Ç–∞–≤–ª–µ–Ω—ã –Ω–∞–º–µ—Ä–µ–Ω–Ω–æ, –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏)

### –ó–∞—â–∏—Ç–∞ –æ—Ç –æ–±—Ö–æ–¥–∞

1. **–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ç–æ—á–∫–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏:**
   - –§–æ—Ä–º—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
   - –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–µ—Å—Å–∏–∏
   - –ò–∑–º–µ–Ω–µ–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–∞
   - Edge Functions

2. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã—Ö–æ–¥:**
   - –ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –≤—Ö–æ–¥–∞ —á–µ—Ä–µ–∑ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—É—é —Ñ–æ—Ä–º—É
   - –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Å–µ—Å—Å–∏–∏

3. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ–¥–∏—Ä–µ–∫—Ç—ã:**
   - –ü—Ä–∏ –ø—Ä—è–º–æ–º –¥–æ—Å—Ç—É–ø–µ –∫ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–º—É URL
   - –ü—Ä–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä (–Ω–∞–∑–∞–¥/–≤–ø–µ—Ä–µ–¥)

4. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–∏ –∏–∑ –ë–î:**
   - –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è hardcoded email
   - –†–æ–ª—å –±–µ—Ä–µ—Ç—Å—è –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `profiles`
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç service role –¥–ª—è –æ–±—Ö–æ–¥–∞ RLS

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

```sql
-- –¢–∞–±–ª–∏—Ü–∞ profiles
CREATE TABLE profiles (
  id UUID PRIMARY KEY REFERENCES auth.users(id),
  email TEXT NOT NULL,
  name TEXT,
  role TEXT DEFAULT 'user' CHECK (role IN ('user', 'super_admin')),
  -- ... other fields
);

-- –ò–Ω–¥–µ–∫—Å –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞ –ø–æ —Ä–æ–ª–∏ (–µ—Å–ª–∏ –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è)
-- CREATE INDEX idx_profiles_role ON profiles(role);
```

### –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã

1. `src/features/mobile/auth/components/AuthScreenNew.tsx`
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–∏ –ø—Ä–∏ PWA –≤—Ö–æ–¥–µ
   - –ê–≤—Ç–æ–≤—ã—Ö–æ–¥ –¥–ª—è super_admin

2. `src/features/admin/auth/components/AdminLoginScreen.tsx`
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–∏ –∏–∑ –ë–î
   - –£–±—Ä–∞–Ω hardcoded email

3. `src/App.tsx`
   - –ó–∞—â–∏—Ç–∞ –º–∞—Ä—à—Ä—É—Ç–æ–≤ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
   - –ó–∞—â–∏—Ç–∞ –º–∞—Ä—à—Ä—É—Ç–æ–≤ –ø—Ä–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏

4. `supabase/functions/profiles/index.ts`
   - –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `role` –≤ GET/CREATE

---

## üìù –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

1. **–í–°–ï–ì–î–ê –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Ä–æ–ª—å** –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö –∑–∞—â–∏—â–µ–Ω–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
2. **–ù–ï –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ hardcoded email** –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
3. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ service role** –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
4. **–¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –≤—Å–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏** –¥–æ—Å—Ç—É–ø–∞ –ø–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º

### –î–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤

1. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `/?view=admin`** –¥–ª—è –≤—Ö–æ–¥–∞ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
2. **–ù–ï –ø—ã—Ç–∞–π—Ç–µ—Å—å –≤–æ–π—Ç–∏** —á–µ—Ä–µ–∑ –æ–±—ã—á–Ω—É—é —Ñ–æ—Ä–º—É PWA
3. **–ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Ä–æ–ª—å** –ø–µ—Ä–µ–¥ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ–º —Å—É–ø–µ—Ä-–∞–¥–º–∏–Ω–∞
4. **–ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –ª–æ–≥–∏** –Ω–∞ –ø–æ–ø—ã—Ç–∫–∏ –Ω–µ—Å–∞–Ω–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞

---

## üöÄ –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

### P1 - –í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
- [ ] –î–æ–±–∞–≤–∏—Ç—å —Ä–æ–ª—å `admin` (–Ω–µ super_admin) —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–º–∏ –ø—Ä–∞–≤–∞–º–∏
- [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ø—ã—Ç–æ–∫ –Ω–µ—Å–∞–Ω–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
- [ ] Email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

### P2 - –°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
- [ ] –î–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –¥–ª—è —Å—É–ø–µ—Ä-–∞–¥–º–∏–Ω–æ–≤
- [ ] –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã –¥–æ—Å—Ç—É–ø–∞ —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–º —Å—Ä–æ–∫–æ–º –¥–µ–π—Å—Ç–≤–∏—è
- [ ] –ê—É–¥–∏—Ç –ª–æ–≥ –≤—Å–µ—Ö –¥–µ–π—Å—Ç–≤–∏–π —Å—É–ø–µ—Ä-–∞–¥–º–∏–Ω–∞

### P3 - –ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
- [ ] –ì—Ä–∞–Ω—É–ª—è—Ä–Ω—ã–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ (permissions)
- [ ] –†–æ–ª–∏ –Ω–∞ —É—Ä–æ–≤–Ω–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
- [ ] SSO –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –¥–ª—è –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤

---

## üìö –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- [SESSION_MANAGEMENT.md](./SESSION_MANAGEMENT.md) - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏—è–º–∏
- [TEST_ACCOUNTS.md](../testing/TEST_ACCOUNTS.md) - –¢–µ—Å—Ç–æ–≤—ã–µ –∞–∫–∫–∞—É–Ω—Ç—ã
- [AUTHENTICATION.md](../guides/AUTHENTICATION.md) - –û–±—â–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- [SECURITY.md](./SECURITY.md) - –ü–æ–ª–∏—Ç–∏–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- [COMPREHENSIVE_ANALYSIS_2025-10-21.md](../plan/archive/completed/2025-10/COMPREHENSIVE_ANALYSIS_2025-10-21.md) - –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –∞–Ω–∞–ª–∏–∑

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2025-10-21  
**–ê–≤—Ç–æ—Ä:** AI Assistant  
**–í–µ—Ä—Å–∏—è:** 1.0

