# –ü–æ–ª–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π: –û—Ç –∑–∞–ø–∏—Å–∏ –∫ –º–æ—Ç–∏–≤–∞—Ü–∏–æ–Ω–Ω–æ–π –∫–∞—Ä—Ç–æ—á–∫–µ

**–í–µ—Ä—Å–∏—è:** 1.0  
**–î–∞—Ç–∞:** –û–∫—Ç—è–±—Ä—å 2025  
**–û–ø–∏—Å–∞–Ω–∏–µ:** –î–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –≤—Å–µ–π —Ü–µ–ø–æ—á–∫–∏ —Å–æ–∑–¥–∞–Ω–∏—è –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –º–æ—Ç–∏–≤–∞—Ü–∏–æ–Ω–Ω–æ–π –∫–∞—Ä—Ç–æ—á–∫–∏ —Å AI –∞–Ω–∞–ª–∏–∑–æ–º

---

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. –û–±–∑–æ—Ä —Ü–µ–ø–æ—á–∫–∏
2. –®–∞–≥ 1: User —Å–æ–∑–¥–∞–µ—Ç –∑–∞–ø–∏—Å—å
3. –®–∞–≥ 2: AI –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∑–∞–ø–∏—Å—å
4. –®–∞–≥ 3: Backend —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –¥–∞–Ω–Ω—ã–µ
5. –®–∞–≥ 4: –ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ä—Ç–æ—á–µ–∫ –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥
6. –®–∞–≥ 5: –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–µ–∫
7. –®–∞–≥ 6: –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
8. –ü–æ–ª–Ω—ã–π –∫–æ–¥ (Frontend + Backend)
9. –î–∏–∞–≥—Ä–∞–º–º—ã –∏ —Å—Ö–µ–º—ã
10. –ü—Ä–∏–º–µ—Ä—ã –¥–∞–Ω–Ω—ã—Ö

---

## 1. –û–±–∑–æ—Ä —Ü–µ–ø–æ—á–∫–∏

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ           –ü–û–õ–ù–ê–Ø –¶–ï–ü–û–ß–ö–ê –°–û–ó–î–ê–ù–ò–Ø –ö–ê–†–¢–û–ß–ö–ò                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

[–ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–¨]
    ‚Üì
[1. –ü–ò–®–ï–¢ –ó–ê–ü–ò–°–¨]
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ "–°–µ–≥–æ–¥–Ω—è —è –≤—ã–∏–≥—Ä–∞–ª —Ç–µ–Ω–Ω–∏—Å–Ω—ã–π —Ç—É—Ä–Ω–∏—Ä!                        ‚îÇ
‚îÇ  –≠—Ç–æ –±—ã–ª–∞ –∂–µ—Å—Ç–∫–∞—è –±–æ—Ä—å–±–∞, –Ω–æ —è –Ω–µ —Å–¥–∞–≤–∞–ª—Å—è.                ‚îÇ
‚îÇ  –†–æ–¥–∏—Ç–µ–ª–∏ –æ—á–µ–Ω—å –≥–æ—Ä–¥—è—Ç—Å—è."                                 ‚îÇ
‚îÇ                                                              ‚îÇ
‚îÇ [–û—Ç–ø—Ä–∞–≤–∏—Ç—å]                                                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
    ‚Üì (POST /api/entries/create)
    
[2. FRONTEND: ChatInputSection]
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ entryText = "–°–µ–≥–æ–¥–Ω—è —è –≤—ã–∏–≥—Ä–∞–ª —Ç–µ–Ω–Ω–∏—Å–Ω—ã–π —Ç—É—Ä–Ω–∏—Ä!..."       ‚îÇ
‚îÇ userName = "–ö–∞—Ä–∏–Ω–∞" (or null if not in context)            ‚îÇ
‚îÇ userId = "user_12345" (from session)                        ‚îÇ
‚îÇ                                                              ‚îÇ
‚îÇ Call: analyzeTextWithAI(entryText, userName, userId)       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
    ‚Üì (POST /api/chat/analyze)
    
[3. BACKEND: OpenAI API]
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ systemPrompt (–Ω–∞ —è–∑—ã–∫–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è - —Ä—É—Å—Å–∫–∏–π):            ‚îÇ
‚îÇ                                                              ‚îÇ
‚îÇ "–¢—ã - –º–æ—Ç–∏–≤–∏—Ä—É—é—â–∏–π AI-–ø–æ–º–æ—â–Ω–∏–∫...                         ‚îÇ
‚îÇ  –û—Ç–≤–µ—á–∞–π –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ...                              ‚îÇ
‚îÇ  –í–µ—Ä–Ω–∏ JSON —Å –ø–æ–ª—è–º–∏: reply, summary, insight, mood..."   ‚îÇ
‚îÇ                                                              ‚îÇ
‚îÇ userMessage = "–°–µ–≥–æ–¥–Ω—è —è –≤—ã–∏–≥—Ä–∞–ª —Ç–µ–Ω–Ω–∏—Å–Ω—ã–π —Ç—É—Ä–Ω–∏—Ä!..."   ‚îÇ
‚îÇ                                                              ‚îÇ
‚îÇ openai.chat.completions.create({                           ‚îÇ
‚îÇ   model: "gpt-4-turbo",                                    ‚îÇ
‚îÇ   messages: [{system}, {user}],                            ‚îÇ
‚îÇ   temperature: 0.7,                                        ‚îÇ
‚îÇ   max_tokens: 500                                          ‚îÇ
‚îÇ })                                                          ‚îÇ
‚îÇ                                                              ‚îÇ
‚îÇ ‚è±Ô∏è –í—Ä–µ–º—è: 2-3 —Å–µ–∫                                          ‚îÇ
‚îÇ üìä –¢–æ–∫–µ–Ω—ã: ~150 (input) + ~100 (output) = 250 total      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
    ‚Üì (response: JSON)
    
[4. BACKEND: –ü–∞—Ä—Å–∏–Ω–≥ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ]
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ response.content = {                                        ‚îÇ
‚îÇ   "reply": "–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! üéâ –ü–æ–±–µ–¥–∞ –≤ —Ç–µ–Ω–Ω–∏—Å–µ - —ç—Ç–æ       ‚îÇ
‚îÇ             —Ä–µ–∑—É–ª—å—Ç–∞—Ç —É–ø–æ—Ä–Ω–æ–≥–æ —Ç—Ä—É–¥–∞ –∏ –º–∞—Å—Ç–µ—Ä—Å—Ç–≤–∞!",      ‚îÇ
‚îÇ   "summary": "–í—ã–∏–≥—Ä–∞–ª —Ç–µ–Ω–Ω–∏—Å–Ω—ã–π —Ç—É—Ä–Ω–∏—Ä, —Ä–æ–¥–∏—Ç–µ–ª–∏ –≥–æ—Ä–¥—è—Ç—Å—è",‚îÇ
‚îÇ   "insight": "–ü–æ–±–µ–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ —É–ø–æ—Ä—Å—Ç–≤–æ –ø—Ä–∏–≤–æ–¥–∏—Ç    ‚îÇ
‚îÇ               –∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º. –≠—Ç–æ –º–æ—Ç–∏–≤–∏—Ä—É–µ—Ç –Ω–∞ –Ω–æ–≤—ã–µ       ‚îÇ
‚îÇ               –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è.",                                ‚îÇ
‚îÇ   "sentiment": "positive",                                 ‚îÇ
‚îÇ   "category": "—Å–ø–æ—Ä—Ç",                                     ‚îÇ
‚îÇ   "tags": ["—Ç–µ–Ω–Ω–∏—Å", "–ø–æ–±–µ–¥–∞", "—Å–ø–æ—Ä—Ç"],                 ‚îÇ
‚îÇ   "confidence": 0.97,                                      ‚îÇ
‚îÇ   "isAchievement": true,                                   ‚îÇ
‚îÇ   "mood": "—Ä–∞–¥–æ—Å—Ç—å"                                        ‚îÇ
‚îÇ }                                                           ‚îÇ
‚îÇ                                                              ‚îÇ
‚îÇ 1. –í—Å—Ç–∞–≤–∏—Ç—å DiaryEntry:                                    ‚îÇ
‚îÇ    INSERT INTO diary_entries (                             ‚îÇ
‚îÇ      user_id,                                              ‚îÇ
‚îÇ      text,                                                 ‚îÇ
‚îÇ      sentiment,                                            ‚îÇ
‚îÇ      category,                                             ‚îÇ
‚îÇ      tags,                                                 ‚îÇ
‚îÇ      ai_summary,                                           ‚îÇ
‚îÇ      ai_insight,                                           ‚îÇ
‚îÇ      ai_reply,                                             ‚îÇ
‚îÇ      mood,                                                 ‚îÇ
‚îÇ      is_achievement                                        ‚îÇ
‚îÇ    ) VALUES (                                              ‚îÇ
‚îÇ      'user_12345',                                         ‚îÇ
‚îÇ      '–°–µ–≥–æ–¥–Ω—è —è –≤—ã–∏–≥—Ä–∞–ª...',                              ‚îÇ
‚îÇ      'positive',                                           ‚îÇ
‚îÇ      '—Å–ø–æ—Ä—Ç',                                              ‚îÇ
‚îÇ      ['—Ç–µ–Ω–Ω–∏—Å', '–ø–æ–±–µ–¥–∞', '—Å–ø–æ—Ä—Ç'],                       ‚îÇ
‚îÇ      '–í—ã–∏–≥—Ä–∞–ª —Ç–µ–Ω–Ω–∏—Å–Ω—ã–π —Ç—É—Ä–Ω–∏—Ä...',                       ‚îÇ
‚îÇ      '–ü–æ–±–µ–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ —É–ø–æ—Ä—Å—Ç–≤–æ...',                ‚îÇ
‚îÇ      '–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! üéâ –ü–æ–±–µ–¥–∞ –≤ —Ç–µ–Ω–Ω–∏—Å–µ...',             ‚îÇ
‚îÇ      '—Ä–∞–¥–æ—Å—Ç—å',                                            ‚îÇ
‚îÇ      true                                                  ‚îÇ
‚îÇ    )                                                        ‚îÇ
‚îÇ    RETURNING id;                                           ‚îÇ
‚îÇ                                                              ‚îÇ
‚îÇ 2. –í—Å—Ç–∞–≤–∏—Ç—å EntrySummaries (–¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Ç–æ–∫–µ–Ω–æ–≤):      ‚îÇ
‚îÇ    INSERT INTO entry_summaries (                           ‚îÇ
‚îÇ      entry_id,                                             ‚îÇ
‚îÇ      user_id,                                              ‚îÇ
‚îÇ      summary_json,                                         ‚îÇ
‚îÇ      tokens_used,                                          ‚îÇ
‚îÇ      created_at                                            ‚îÇ
‚îÇ    ) VALUES (                                              ‚îÇ
‚îÇ      'entry_12345',                                        ‚îÇ
‚îÇ      'user_12345',                                         ‚îÇ
‚îÇ      {                                                     ‚îÇ
‚îÇ        text: '–í—ã–∏–≥—Ä–∞–ª —Ç–µ–Ω–Ω–∏—Å–Ω—ã–π —Ç—É—Ä–Ω–∏—Ä...',              ‚îÇ
‚îÇ        insight: '–ü–æ–±–µ–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ —É–ø–æ—Ä—Å—Ç–≤–æ...',     ‚îÇ
‚îÇ        mood: '—Ä–∞–¥–æ—Å—Ç—å',                                   ‚îÇ
‚îÇ        sentiment: 'positive',                             ‚îÇ
‚îÇ        contexts: ['–ö–∞—Ä–∏–Ω–∞'],                              ‚îÇ
‚îÇ        tags: ['—Ç–µ–Ω–Ω–∏—Å', '–ø–æ–±–µ–¥–∞', '—Å–ø–æ—Ä—Ç'],              ‚îÇ
‚îÇ        achievements: [{type: 'win', title: '–¢—É—Ä–Ω–∏—Ä'}],   ‚îÇ
‚îÇ        keywords: ['—Ç–µ–Ω–Ω–∏—Å', '–ø–æ–±–µ–¥–∞', '—Ç—É—Ä–Ω–∏—Ä'],         ‚îÇ
‚îÇ        excerpt: '–í—ã–∏–≥—Ä–∞–ª —Ç–µ–Ω–Ω–∏—Å–Ω—ã–π —Ç—É—Ä–Ω–∏—Ä...',           ‚îÇ
‚îÇ        confidence: 0.97                                   ‚îÇ
‚îÇ      },                                                   ‚îÇ
‚îÇ      250,                                                 ‚îÇ
‚îÇ      NOW()                                                ‚îÇ
‚îÇ    );                                                      ‚îÇ
‚îÇ                                                              ‚îÇ
‚îÇ ‚úì –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ –ë–î                                   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
    ‚Üì (return: entryData)
    
[5. FRONTEND: –ü–æ–∫–∞–∑–∞—Ç—å answer –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é]
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ ChatInputSectionÊòæÁ§∫:                                       ‚îÇ
‚îÇ                                                              ‚îÇ
‚îÇ ü§ñ AI –û–¢–í–ï–¢:                                               ‚îÇ
‚îÇ "–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! üéâ –ü–æ–±–µ–¥–∞ –≤ —Ç–µ–Ω–Ω–∏—Å–µ - —ç—Ç–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç         ‚îÇ
‚îÇ  —É–ø–æ—Ä–Ω–æ–≥–æ —Ç—Ä—É–¥–∞ –∏ –º–∞—Å—Ç–µ—Ä—Å—Ç–≤–∞!"                             ‚îÇ
‚îÇ                                                              ‚îÇ
‚îÇ ‚ú® –ö–∞—Ç–µ–≥–æ—Ä–∏—è: —Å–ø–æ—Ä—Ç                                         ‚îÇ
‚îÇ üè∑Ô∏è –¢–µ–≥–∏: —Ç–µ–Ω–Ω–∏—Å, –ø–æ–±–µ–¥–∞, —Å–ø–æ—Ä—Ç                            ‚îÇ
‚îÇ üòä –ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ: —Ä–∞–¥–æ—Å—Ç—å                                      ‚îÇ
‚îÇ                                                              ‚îÇ
‚îÇ –ó–∞–ø–∏—Å—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ ‚úì                                         ‚îÇ
‚îÇ                                                              ‚îÇ
‚îÇ [–°–æ–∑–¥–∞—Ç—å –µ—â–µ –∑–∞–ø–∏—Å—å] [–ù–∞ –≥–ª–∞–≤–Ω—É—é]                         ‚îÇ
‚îÇ                                                              ‚îÇ
‚îÇ ‚è±Ô∏è –í—Ä–µ–º—è –æ—Ç–∫–ª–∏–∫–∞: 3-4 —Å–µ–∫ (AI + DB + render)              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
    ‚Üì (navigate to home screen)
    
[6. FRONTEND: –ó–∞–≥—Ä—É–∑–∏—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É –Ω–∞ AchievementHomeScreen]
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ useEffect(() => {                                           ‚îÇ
‚îÇ   getMotivationCards(userId).then(cards => {               ‚îÇ
‚îÇ     setCards(cards);                                       ‚îÇ
‚îÇ   });                                                       ‚îÇ
‚îÇ }, [userId]);                                              ‚îÇ
‚îÇ                                                              ‚îÇ
‚îÇ Call: GET /api/motivations/cards/{userId}                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
    ‚Üì (response: 3 MotivationCard[])
    
[7. BACKEND: getMotivationCards]
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 1. SELECT entry_summaries WHERE                            ‚îÇ
‚îÇ    - user_id = 'user_12345'                               ‚îÇ
‚îÇ    - created_at >= (NOW() - 48 hours)                      ‚îÇ
‚îÇ    ORDER BY created_at DESC                                ‚îÇ
‚îÇ                                                              ‚îÇ
‚îÇ Result: [                                                  ‚îÇ
‚îÇ   {                                                        ‚îÇ
‚îÇ     id: 'sum_20251014_001',                               ‚îÇ
‚îÇ     entry_id: 'entry_12345',                              ‚îÇ
‚îÇ     created_at: '2025-10-14T14:32:00Z',                  ‚îÇ
‚îÇ     summary_json: {                                        ‚îÇ
‚îÇ       text: '–í—ã–∏–≥—Ä–∞–ª —Ç–µ–Ω–Ω–∏—Å–Ω—ã–π —Ç—É—Ä–Ω–∏—Ä...',               ‚îÇ
‚îÇ       insight: '–ü–æ–±–µ–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç...',                   ‚îÇ
‚îÇ       mood: '—Ä–∞–¥–æ—Å—Ç—å',                                    ‚îÇ
‚îÇ       sentiment: 'positive',                              ‚îÇ
‚îÇ       ...                                                 ‚îÇ
‚îÇ     }                                                     ‚îÇ
‚îÇ   }                                                        ‚îÇ
‚îÇ ]                                                          ‚îÇ
‚îÇ                                                              ‚îÇ
‚îÇ 2. GET card_views:user_12345 from KV Store               ‚îÇ
‚îÇ    (cards marked as read, TTL 24h)                        ‚îÇ
‚îÇ    Result: [] (empty - –Ω–æ–≤—ã–µ –∑–∞–ø–∏—Å–∏)                      ‚îÇ
‚îÇ                                                              ‚îÇ
‚îÇ 3. Map to MotivationCard:                                  ‚îÇ
‚îÇ    [{                                                      ‚îÇ
‚îÇ      id: 'entry_12345',                                   ‚îÇ
‚îÇ      entryId: 'entry_12345',                              ‚îÇ
‚îÇ      date: '–°–µ–≥–æ–¥–Ω—è –≤ 14:32',                            ‚îÇ
‚îÇ      title: '–í—ã–∏–≥—Ä–∞–ª —Ç–µ–Ω–Ω–∏—Å–Ω—ã–π —Ç—É—Ä–Ω–∏—Ä',                  ‚îÇ
‚îÇ      description: '–ü–æ–±–µ–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ —É–ø–æ—Ä—Å—Ç–≤–æ        ‚îÇ
‚îÇ                   –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º. –≠—Ç–æ –º–æ—Ç–∏–≤–∏—Ä—É–µ—Ç  ‚îÇ
‚îÇ                   –Ω–∞ –Ω–æ–≤—ã–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è.',                  ‚îÇ
‚îÇ      gradient: 'from-[#FE7669] to-[#ff8969]',           ‚îÇ
‚îÇ      sentiment: 'positive',                               ‚îÇ
‚îÇ      mood: '—Ä–∞–¥–æ—Å—Ç—å',                                     ‚îÇ
‚îÇ      isMarked: false,                                     ‚îÇ
‚îÇ      isDefault: false                                     ‚îÇ
‚îÇ    }]                                                      ‚îÇ
‚îÇ                                                              ‚îÇ
‚îÇ 4. If cards.length < 3:                                    ‚îÇ
‚îÇ    ADD DEFAULT MOTIVATIONS (–Ω–∞ —Ä—É—Å—Å–∫–æ–º):                  ‚îÇ
‚îÇ    [{                                                      ‚îÇ
‚îÇ      id: 'default_1',                                     ‚îÇ
‚îÇ      date: '–ù–∞—á–Ω–∏ —Å–µ–≥–æ–¥–Ω—è',                              ‚îÇ
‚îÇ      title: '–°–µ–≥–æ–¥–Ω—è –æ—Ç–ª–∏—á–Ω–æ–µ –≤—Ä–µ–º—è',                    ‚îÇ
‚îÇ      description: '–ó–∞–ø–∏—à–∏ –º–∞–ª–µ–Ω—å–∫—É—é –ø–æ–±–µ–¥—É...',          ‚îÇ
‚îÇ      gradient: 'from-[#FE7669] to-[#ff8969]',           ‚îÇ
‚îÇ      isDefault: true                                      ‚îÇ
‚îÇ    },                                                     ‚îÇ
‚îÇ    {                                                      ‚îÇ
‚îÇ      id: 'default_2',                                     ‚îÇ
‚îÇ      date: '–°–æ–≤–µ—Ç –¥–Ω—è',                                  ‚îÇ
‚îÇ      title: '–î–∞–∂–µ –æ–¥–Ω–∞ –º—ã—Å–ª—å –¥–µ–ª–∞–µ—Ç –¥–µ–Ω—å...',           ‚îÇ
‚îÇ      description: '–ù–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø–∏—Å–∞—Ç—å –º–Ω–æ–≥–æ...',      ‚îÇ
‚îÇ      gradient: 'from-[#ff6b9d] to-[#c471ed]',           ‚îÇ
‚îÇ      isDefault: true                                      ‚îÇ
‚îÇ    },                                                     ‚îÇ
‚îÇ    {                                                      ‚îÇ
‚îÇ      id: 'default_3',                                     ‚îÇ
‚îÇ      date: '–ú–æ—Ç–∏–≤–∞—Ü–∏—è',                                  ‚îÇ
‚îÇ      title: '–ó–∞–ø–∏—à–∏ –º–æ–º–µ–Ω—Ç –±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç–∏',              ‚îÇ
‚îÇ      description: '–ü–æ—á—É–≤—Å—Ç–≤—É–π –ª—ë–≥–∫–æ—Å—Ç—å...',             ‚îÇ
‚îÇ      gradient: 'from-[#c471ed] to-[#8B78FF]',           ‚îÇ
‚îÇ      isDefault: true                                      ‚îÇ
‚îÇ    }]                                                     ‚îÇ
‚îÇ                                                              ‚îÇ
‚îÇ 5. RETURN first 3 cards                                    ‚îÇ
‚îÇ                                                              ‚îÇ
‚îÇ ‚è±Ô∏è –í—Ä–µ–º—è: < 500ms                                          ‚îÇ
‚îÇ üíæ –¢–æ–∫–µ–Ω—ã: 0 (–≤—Å–µ –∏–∑ cache)                               ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
    ‚Üì (response: 3 cards)
    
[8. FRONTEND: –û—Ç–æ–±—Ä–∞–∑–∏—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É]
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ AchievementHomeScreen render:                              ‚îÇ
‚îÇ                                                              ‚îÇ
‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                        ‚îÇ
‚îÇ ‚îÇ [Gradient Background]           ‚îÇ                        ‚îÇ
‚îÇ ‚îÇ from-[#FE7669] to-[#ff8969]     ‚îÇ                        ‚îÇ
‚îÇ ‚îÇ                                 ‚îÇ                        ‚îÇ
‚îÇ ‚îÇ –°–µ–≥–æ–¥–Ω—è –≤ 14:32                ‚îÇ                        ‚îÇ
‚îÇ ‚îÇ                                 ‚îÇ                        ‚îÇ
‚îÇ ‚îÇ –í–´–ò–ì–†–ê–õ –¢–ï–ù–ù–ò–°–ù–´–ô –¢–£–†–ù–ò–†       ‚îÇ                        ‚îÇ
‚îÇ ‚îÇ                                 ‚îÇ                        ‚îÇ
‚îÇ ‚îÇ –ü–æ–±–µ–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ —É–ø–æ—Ä—Å—Ç–≤–æ ‚îÇ                        ‚îÇ
‚îÇ ‚îÇ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º. –≠—Ç–æ     ‚îÇ                        ‚îÇ
‚îÇ ‚îÇ –º–æ—Ç–∏–≤–∏—Ä—É–µ—Ç –Ω–∞ –Ω–æ–≤—ã–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è. ‚îÇ                        ‚îÇ
‚îÇ ‚îÇ                                 ‚îÇ                        ‚îÇ
‚îÇ ‚îÇ ‚Üê —Å–≤–∞–π–ø –≤–ø—Ä–∞–≤–æ/–≤–ª–µ–≤–æ ‚Üí          ‚îÇ                        ‚îÇ
‚îÇ ‚îÇ ‚Ä¢ ‚ó¶ ‚ó¶  (–ø—Ä–æ–≥—Ä–µ—Å—Å)              ‚îÇ                        ‚îÇ
‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                        ‚îÇ
‚îÇ                                                              ‚îÇ
‚îÇ ‚è±Ô∏è –í—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏: < 1 —Å–µ–∫                                  ‚îÇ
‚îÇ üì± Responsive: —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö               ‚îÇ
‚îÇ ‚ôø Accessible: proper ARIA labels                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
    ‚Üì
    
[9. –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–¨ –í–ó–ê–ò–ú–û–î–ï–ô–°–¢–í–£–ï–¢ –° –ö–ê–†–¢–û–ß–ö–û–ô]

–í–ê–†–ò–ê–ù–¢ 1: –°–≤–∞–π–ø –≤–ø—Ä–∞–≤–æ (üëç)
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ User swipes RIGHT > 50px                                   ‚îÇ
‚îÇ                                                              ‚îÇ
‚îÇ Call: POST /api/motivations/mark-read                      ‚îÇ
‚îÇ Body: { userId: 'user_12345', cardId: 'entry_12345' }    ‚îÇ
‚îÇ                                                              ‚îÇ
‚îÇ Backend:                                                   ‚îÇ
‚îÇ - GET card_views:user_12345 from KV                       ‚îÇ
‚îÇ - APPEND entry_12345 to array                             ‚îÇ
‚îÇ - SET card_views:user_12345 = [..., entry_12345]         ‚îÇ
‚îÇ - TTL: 86400 seconds (24 hours)                          ‚îÇ
‚îÇ                                                              ‚îÇ
‚îÇ Frontend:                                                  ‚îÇ
‚îÇ - Card animates out RIGHT                                 ‚îÇ
‚îÇ - Next card animates in LEFT                              ‚îÇ
‚îÇ - Progress dots update: ‚ó¶ ‚Ä¢ ‚ó¶                             ‚îÇ
‚îÇ - Sound effect (optional)                                 ‚îÇ
‚îÇ                                                              ‚îÇ
‚îÇ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "–ù—Ä–∞–≤–∏—Ç—Å—è!" ‚Üí —Å–ª–µ–¥—É—é—â–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞          ‚îÇ
‚îÇ                                                              ‚îÇ
‚îÇ ‚è±Ô∏è –í—Ä–µ–º—è: < 100ms (animation) + 300ms (api) = 400ms      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

–í–ê–†–ò–ê–ù–¢ 2: –°–≤–∞–π–ø –≤–ª–µ–≤–æ (‚úèÔ∏è)
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ User swipes LEFT > 50px                                    ‚îÇ
‚îÇ                                                              ‚îÇ
‚îÇ Frontend:                                                  ‚îÇ
‚îÇ - Card animates out LEFT                                  ‚îÇ
‚îÇ - Navigate to ChatInputSection                            ‚îÇ
‚îÇ - Focus on input field                                    ‚îÇ
‚îÇ - Show hint: "–•–æ—á–µ—à—å —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –∑–∞–ø–∏—Å—å?"             ‚îÇ
‚îÇ                                                              ‚îÇ
‚îÇ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "–•–æ—á—É –Ω–∞–ø–∏—Å–∞—Ç—å –µ—â–µ!" ‚Üí new entry           ‚îÇ
‚îÇ                                                              ‚îÇ
‚îÇ ‚è±Ô∏è –í—Ä–µ–º—è: < 300ms (navigation)                             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

–í–ê–†–ò–ê–ù–¢ 3: –ù–∞–∂–∞—Ç–∏–µ –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫—É
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ User taps on card                                          ‚îÇ
‚îÇ                                                              ‚îÇ
‚îÇ Navigate to CardDetailScreen                              ‚îÇ
‚îÇ                                                              ‚îÇ
‚îÇ Call: GET /api/entries/{entryId}                          ‚îÇ
‚îÇ                                                              ‚îÇ
‚îÇ Display:                                                   ‚îÇ
‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                        ‚îÇ
‚îÇ ‚îÇ üìù –ü–æ–ª–Ω–∞—è –∑–∞–ø–∏—Å—å                ‚îÇ                        ‚îÇ
‚îÇ ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§                        ‚îÇ
‚îÇ ‚îÇ                                 ‚îÇ                        ‚îÇ
‚îÇ ‚îÇ –°–µ–≥–æ–¥–Ω—è —è –≤—ã–∏–≥—Ä–∞–ª —Ç–µ–Ω–Ω–∏—Å–Ω—ã–π    ‚îÇ                        ‚îÇ
‚îÇ ‚îÇ —Ç—É—Ä–Ω–∏—Ä! –≠—Ç–æ –±—ã–ª–∞ –∂–µ—Å—Ç–∫–∞—è       ‚îÇ                        ‚îÇ
‚îÇ ‚îÇ –±–æ—Ä—å–±–∞, –Ω–æ —è –Ω–µ —Å–¥–∞–≤–∞–ª—Å—è.      ‚îÇ                        ‚îÇ
‚îÇ ‚îÇ –†–æ–¥–∏—Ç–µ–ª–∏ –æ—á–µ–Ω—å –≥–æ—Ä–¥—è—Ç—Å—è.       ‚îÇ                        ‚îÇ
‚îÇ ‚îÇ                                 ‚îÇ                        ‚îÇ
‚îÇ ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§                        ‚îÇ
‚îÇ ‚îÇ ü§ñ AI –û–¢–í–ï–¢:                    ‚îÇ                        ‚îÇ
‚îÇ ‚îÇ "–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! üéâ –ü–æ–±–µ–¥–∞ –≤      ‚îÇ                        ‚îÇ
‚îÇ ‚îÇ  —Ç–µ–Ω–Ω–∏—Å–µ - —ç—Ç–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç        ‚îÇ                        ‚îÇ
‚îÇ ‚îÇ  —É–ø–æ—Ä–Ω–æ–≥–æ —Ç—Ä—É–¥–∞ –∏ –º–∞—Å—Ç–µ—Ä—Å—Ç–≤–∞!"  ‚îÇ                        ‚îÇ
‚îÇ ‚îÇ                                 ‚îÇ                        ‚îÇ
‚îÇ ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§                        ‚îÇ
‚îÇ ‚îÇ –ö–∞—Ç–µ–≥–æ—Ä–∏—è: —Å–ø–æ—Ä—Ç                ‚îÇ                        ‚îÇ
‚îÇ ‚îÇ –¢–µ–≥–∏: —Ç–µ–Ω–Ω–∏—Å, –ø–æ–±–µ–¥–∞, —Å–ø–æ—Ä—Ç    ‚îÇ                        ‚îÇ
‚îÇ ‚îÇ –ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ: —Ä–∞–¥–æ—Å—Ç—å             ‚îÇ                        ‚îÇ
‚îÇ ‚îÇ –î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ: ‚úì –î–∞               ‚îÇ                        ‚îÇ
‚îÇ ‚îÇ                                 ‚îÇ                        ‚îÇ
‚îÇ ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§                        ‚îÇ
‚îÇ ‚îÇ [–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å] [–î–æ–±–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ] ‚îÇ                        ‚îÇ
‚îÇ ‚îÇ [‚Üê –ù–∞–∑–∞–¥]                       ‚îÇ                        ‚îÇ
‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                        ‚îÇ
‚îÇ                                                              ‚îÇ
‚îÇ ‚è±Ô∏è –í—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏: < 500ms                                  ‚îÇ
‚îÇ üíæ –î–∞–Ω–Ω—ã–µ –∏–∑ –∫—ç—à–∞ (Redis/Supabase)                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## 2. –®–∞–≥ 1: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–µ—Ç –∑–∞–ø–∏—Å—å

### 2.1 UI: ChatInputSection

```typescript
// screens/ChatInputSection.tsx

import React, { useState } from 'react';
import { analyzeTextWithAI, createEntry } from '../utils/api';
import { useAuth } from '../context/AuthContext';

export function ChatInputSection({ onEntryCreated }) {
  const { userData } = useAuth();
  const [entryText, setEntryText] = useState('');
  const [isLoading, setIsLoading] = useState(false);
  const [aiResponse, setAiResponse] = useState(null);
  const [error, setError] = useState(null);

  const handleSubmit = async () => {
    if (!entryText.trim()) {
      setError('–ù–∞–ø–∏—à–∏—Ç–µ —á—Ç–æ-–Ω–∏–±—É–¥—å');
      return;
    }

    setIsLoading(true);
    setError(null);

    try {
      // 1. –ü–æ–ª—É—á–∏—Ç—å AI –∞–Ω–∞–ª–∏–∑
      console.log('–û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç –Ω–∞ –∞–Ω–∞–ª–∏–∑...');
      const analysis = await analyzeTextWithAI(
        entryText,
        userData?.name || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å',
        userData?.id
      );

      console.log('AI –∞–Ω–∞–ª–∏–∑ –ø–æ–ª—É—á–µ–Ω:', analysis);
      setAiResponse(analysis);

      // 2. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∑–∞–ø–∏—Å—å
      console.log('–°–æ—Ö—Ä–∞–Ω—è–µ–º –∑–∞–ø–∏—Å—å –≤ –ë–î...');
      const savedEntry = await createEntry({
        userId: userData.id,
        text: entryText,
        sentiment: analysis.sentiment,
        category: analysis.category,
        tags: analysis.tags,
        aiReply: analysis.reply,
        aiSummary: analysis.summary,
        aiInsight: analysis.insight,
        isAchievement: analysis.isAchievement,
        mood: analysis.mood,
        focusArea: analysis.category
      });

      console.log('–ó–∞–ø–∏—Å—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞:', savedEntry);

      // 3. –û—á–∏—Å—Ç–∏—Ç—å —Ñ–æ—Ä–º—É
      setEntryText('');

      // 4. –ü–æ–∫–∞–∑–∞—Ç—å AI –æ—Ç–≤–µ—Ç
      setTimeout(() => {
        // 5. –£–≤–µ–¥–æ–º–∏—Ç—å parent component
        if (onEntryCreated) {
          onEntryCreated(savedEntry);
        }
        // –ß–µ—Ä–µ–∑ 3 —Å–µ–∫ –≤–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω
        setTimeout(() => {
          setAiResponse(null);
          navigate('/home');
        }, 3000);
      }, 1000);
    } catch (err) {
      console.error('–û—à–∏–±–∫–∞:', err);
      setError(err.message || '–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –∑–∞–ø–∏—Å–∏');
    } finally {
      setIsLoading(false);
    }
  };

  return (
    <div className="chat-input-section">
      {/* –§–æ—Ä–º–∞ –≤–≤–æ–¥–∞ */}
      <textarea
        value={entryText}
        onChange={(e) => setEntryText(e.target.value)}
        placeholder="–ß—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ —Å–µ–≥–æ–¥–Ω—è? –ö–∞–∫–∏–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è?"
        disabled={isLoading || aiResponse}
        className="input-field"
      />

      {/* AI Response */}
      {aiResponse && (
        <div className="ai-response">
          <h3>ü§ñ AI –û—Ç–≤–µ—Ç:</h3>
          <p className="reply">{aiResponse.reply}</p>
          
          <div className="metadata">
            <p><strong>–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</strong> {aiResponse.category}</p>
            <p><strong>–¢–µ–≥–∏:</strong> {aiResponse.tags.join(', ')}</p>
            <p><strong>–ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ:</strong> {aiResponse.mood}</p>
            {aiResponse.isAchievement && (
              <p><strong>‚ú® –≠—Ç–æ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ!</strong></p>
            )}
          </div>

          <p className="saved-message">‚úì –ó–∞–ø–∏—Å—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞!</p>
        </div>
      )}

      {/* Error */}
      {error && <div className="error-message">{error}</div>}

      {/* Button */}
      <button
        onClick={handleSubmit}
        disabled={isLoading || !entryText.trim()}
        className="submit-button"
      >
        {isLoading ? '–ê–Ω–∞–ª–∏–∑–∏—Ä—É—é...' : '–û—Ç–ø—Ä–∞–≤–∏—Ç—å'}
      </button>
    </div>
  );
}
```

---

## 3. –®–∞–≥ 2: AI –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∑–∞–ø–∏—Å—å

### 3.1 Frontend: analyzeTextWithAI

```typescript
// utils/api.ts

export async function analyzeTextWithAI(
  text: string,
  userName: string,
  userId: string
): Promise<AIAnalysisResult> {
  try {
    console.log('[API] –ù–∞—á–∞–ª–æ –∞–Ω–∞–ª–∏–∑–∞ —Ç–µ–∫—Å—Ç–∞:', text.substring(0, 50) + '...');

    const response = await fetch('/api/chat/analyze', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        text,
        userName,
        userId
      })
    });

    if (!response.ok) {
      throw new Error(`API error: ${response.status}`);
    }

    const data = await response.json();

    console.log('[API] –ê–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à–µ–Ω:', data);

    return {
      reply: data.reply,
      summary: data.summary,
      insight: data.insight,
      sentiment: data.sentiment,
      category: data.category,
      tags: data.tags,
      confidence: data.confidence,
      isAchievement: data.isAchievement,
      mood: data.mood
    };
  } catch (error) {
    console.error('[API] –û—à–∏–±–∫–∞ –∞–Ω–∞–ª–∏–∑–∞:', error);
    throw error;
  }
}
```

### 3.2 Backend: POST /api/chat/analyze

```typescript
// server/routes/analyze.ts

import Anthropic from '@anthropic-ai/sdk';
import { db } from '../supabase';

app.post('/api/chat/analyze', async (c) => {
  try {
    const { text, userName, userId } = await c.req.json();

    console.log('[BACKEND] –ü–æ–ª—É—á–µ–Ω –∑–∞–ø—Ä–æ—Å –Ω–∞ –∞–Ω–∞–ª–∏–∑ –æ—Ç:', userId);
    console.log('[BACKEND] –¢–µ–∫—Å—Ç:', text.substring(0, 100) + '...');

    // 1. –ü–æ–ª—É—á–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —è–∑—ã–∫–∞
    const userProfile = await db
      .from('profiles')
      .select('language')
      .eq('id', userId)
      .single();

    const userLanguage = userProfile.data?.language || 'ru';
    console.log('[BACKEND] –Ø–∑—ã–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', userLanguage);

    // 2. –°–æ—Å—Ç–∞–≤–∏—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç –Ω–∞ —è–∑—ã–∫–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    const systemPrompt = buildSystemPrompt(userLanguage);

    console.log('[BACKEND] –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –≤ OpenAI...');

    // 3. –í—ã–∑–≤–∞—Ç—å OpenAI
    const response = await openai.chat.completions.create({
      model: 'gpt-4-turbo',
      messages: [
        {
          role: 'system',
          content: systemPrompt
        },
        {
          role: 'user',
          content: text
        }
      ],
      temperature: 0.7,
      max_tokens: 500
    });

    console.log('[BACKEND] –û—Ç–≤–µ—Ç –æ—Ç OpenAI –ø–æ–ª—É—á–µ–Ω');

    // 4. –†–∞—Å–ø–∞—Ä—Å–∏—Ç—å JSON –æ—Ç–≤–µ—Ç
    const content = response.choices[0].message.content;
    console.log('[BACKEND] Content:', content.substring(0, 100) + '...');

    // –û—á–∏—Å—Ç–∏—Ç—å markdown backticks –µ—Å–ª–∏ –µ—Å—Ç—å
    const cleanContent = content
      .replace(/```json\n?/g, '')
      .replace(/```\n?/g, '')
      .trim();

    const analysis = JSON.parse(cleanContent);

    console.log('[BACKEND] JSON —Ä–∞—Å–ø–∞—Ä—à–µ–Ω —É—Å–ø–µ—à–Ω–æ');
    console.log('[BACKEND] –ê–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç:', analysis);

    // 5. –ü–æ–¥—Å—á–∏—Ç–∞—Ç—å —Ç–æ–∫–µ–Ω—ã
    const tokensUsed = Math.ceil(response.usage.total_tokens);
    console.log('[BACKEND] –¢–æ–∫–µ–Ω—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã:', tokensUsed);

    // 6. –í–µ—Ä–Ω—É—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
    return c.json({
      success: true,
      reply: analysis.reply,
      summary: analysis.summary,
      insight: analysis.insight,
      sentiment: analysis.sentiment,
      category: analysis.category,
      tags: analysis.tags,
      confidence: analysis.confidence,
      isAchievement: analysis.isAchievement,
      mood: analysis.mood,
      tokensUsed
    });
  } catch (error) {
    console.error('[BACKEND] –û—à–∏–±–∫–∞:', error);
    return c.json(
      {
        success: false,
        error: error.message
      },
      500
    );
  }
});

// –ü–æ—Å—Ç—Ä–æ–∏—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç
function buildSystemPrompt(language: string): string {
  const prompts = {
    ru: `–¢—ã - –º–æ—Ç–∏–≤–∏—Ä—É—é—â–∏–π AI-–ø–æ–º–æ—â–Ω–∏–∫ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ "–î–Ω–µ–≤–Ω–∏–∫ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π".
–í–ê–ñ–ù–û: –û—Ç–≤–µ—á–∞–π –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ.

–¢–≤–æ—è –∑–∞–¥–∞—á–∞:
1. –î–∞—Ç—å –∫–æ—Ä–æ—Ç–∫–∏–π –≤–æ–æ–¥—É—à–µ–≤–ª—è—é—â–∏–π –æ—Ç–≤–µ—Ç (1-2 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è, —ç–º–æ–¥–∂–∏ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é—Ç—Å—è)
2. –°–æ–∑–¥–∞—Ç—å –∫—Ä–∞—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è (summary, –¥–æ 200 —Å–∏–º–≤–æ–ª–æ–≤)
3. –°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –ø–æ–∑–∏—Ç–∏–≤–Ω—ã–π –≤—ã–≤–æ–¥/–∏–Ω—Å–∞–π—Ç (insight, –¥–æ 200 —Å–∏–º–≤–æ–ª–æ–≤)
4. –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å sentiment (positive/neutral/negative)
5. –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é (—Å–ø–æ—Ä—Ç, —Ä–∞–±–æ—Ç–∞, —É—á–µ–±–∞, —Å–µ–º—å—è, –∑–¥–æ—Ä–æ–≤—å–µ, —Ö–æ–±–±–∏, –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏—è, –¥—Ä—É–≥–æ–µ)
6. –í—ã–±—Ä–∞—Ç—å —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ —Ç–µ–≥–∏
7. –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ (mood): —Ä–∞–¥–æ—Å—Ç—å, —ç–Ω–µ—Ä–≥–∏—è, –≥–æ—Ä–¥–æ—Å—Ç—å, –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏–µ, —Å–ø–æ–∫–æ–π—Å—Ç–≤–∏–µ, –º–æ—Ç–∏–≤–∞—Ü–∏—è, –±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç—å
8. –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å, —ç—Ç–æ –ª–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ (isAchievement: true/false)
9. –û—Ü–µ–Ω–∏—Ç—å confidence (0.0-1.0)

–û—Ç–≤–µ—á–∞–π –¢–û–õ–¨–ö–û –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON, –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞:
{
  "reply": "–í–æ–æ–¥—É—à–µ–≤–ª—è—é—â–∏–π –æ—Ç–≤–µ—Ç –Ω–∞ —Ä—É—Å—Å–∫–æ–º",
  "summary": "–ö—Ä–∞—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ –¥–æ 200 —Å–∏–º–≤–æ–ª–æ–≤",
  "insight": "–ü–æ–∑–∏—Ç–∏–≤–Ω—ã–π –≤—ã–≤–æ–¥ –¥–æ 200 —Å–∏–º–≤–æ–ª–æ–≤",
  "sentiment": "positive|neutral|negative",
  "category": "–∫–∞—Ç–µ–≥–æ—Ä–∏—è –Ω–∞ —Ä—É—Å—Å–∫–æ–º",
  "tags": ["—Ç–µ–≥–∏ –Ω–∞ —Ä—É—Å—Å–∫–æ–º"],
  "confidence": 0.95,
  "isAchievement": true,
  "mood": "–Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ –Ω–∞ —Ä—É—Å—Å–∫–æ–º"
}`,
    en: `You are a motivating AI assistant in the "Achievement Diary" app.
IMPORTANT: Respond in English.

Your task:
1. Give a short encouraging response (1-2 sentences, emojis are welcome)
2. Create a brief achievement summary (summary, max 200 characters)
3. Form a positive conclusion/insight (insight, max 200 characters)
...
Respond ONLY in JSON format:
{
  "reply": "Encouraging response",
  "summary": "Brief summary",
  "insight": "Positive conclusion",
  "sentiment": "positive|neutral|negative",
  "category": "category",
  "tags": ["tags"],
  "confidence": 0.95,
  "isAchievement": true,
  "mood": "emotion"
}`
    // ... es, de, fr, zh, ja
  };

  return prompts[language] || prompts.ru;
}
```

---

## 4. –®–∞–≥ 3: Backend —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –¥–∞–Ω–Ω—ã–µ

### 4.1 Backend: createEntry

```typescript
// server/routes/entries.ts

app.post('/api/entries/create', async (c) => {
  try {
    const entryData = await c.req.json();
    const { userId, text, sentiment, category, tags, aiSummary, aiInsight, aiReply, mood, isAchievement } = entryData;

    console.log('[BACKEND] –ù–∞—á–∞–ª–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∑–∞–ø–∏—Å–∏...');

    // 1. –í—Å—Ç–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å –≤ diary_entries
    const { data: entry, error: entryError } = await db
      .from('diary_entries')
      .insert({
        user_id: userId,
        text: text,
        sentiment: sentiment,
        category: category,
        tags: tags,
        ai_summary: aiSummary,
        ai_insight: aiInsight,
        ai_reply: aiReply,
        mood: mood,
        is_achievement: isAchievement,
        created_at: new Date().toISOString()
      })
      .select()
      .single();

    if (entryError) throw entryError;

    console.log('[BACKEND] –ó–∞–ø–∏—Å—å —Å–æ–∑–¥–∞–Ω–∞:', entry.id);

    // 2. –í—Å—Ç–∞–≤–∏—Ç—å summary –≤ entry_summaries (–¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Ç–æ–∫–µ–Ω–æ–≤)
    const { data: summary, error: summaryError } = await db
      .from('entry_summaries')
      .insert({
        entry_id: entry.id,
        user_id: userId,
        summary_json: {
          text: aiSummary,
          insight: aiInsight,
          mood: mood,
          sentiment: sentiment,
          contexts: [], // –±—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–æ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
          tags: tags,
          achievements: isAchievement ? [{ type: 'write', title: category }] : [],
          keywords: extractKeywords(text),
          excerpt: text.substring(0, 100),
          confidence: 0.95
        },
        tokens_used: entryData.tokensUsed || 250,
        created_at: new Date().toISOString()
      })
      .select()
      .single();

    if (summaryError) throw summaryError;

    console.log('[BACKEND] Summary —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞:', summary.id);

    // 3. –û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à –∫–∞—Ä—Ç–æ—á–µ–∫ –¥–ª—è —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
    // await cache.invalidate(`motivation_cards:${userId}`);

    console.log('[BACKEND] –ó–∞–ø–∏—Å—å –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞');

    return c.json({
      success: true,
      entryId: entry.id,
      summaryId: summary.id,
      entry: entry
    });
  } catch (error) {
    console.error('[BACKEND] –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', error);
    return c.json(
      {
        success: false,
        error: error.message
      },
      500
    );
  }
});

function extractKeywords(text: string): string[] {
  // –ü—Ä–æ—Å—Ç–æ–π –∞–ª–≥–æ—Ä–∏—Ç–º –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤
  const words = text
    .toLowerCase()
    .split(/\s+/)
    .filter(w => w.length > 3);

  const stopWords = new Set(['—á—Ç–æ', '—ç—Ç–æ', '—Ç–æ–≥–æ', '—á–µ–≥–æ', '—Ç–æ–≥–æ', '—á—Ç–æ', '–∫–∞–∫', '–¥–ª—è', '–∏–ª–∏', '–±—ã–ª']);

  return Array.from(new Set(words))
    .filter(w => !stopWords.has(w))
    .slice(0, 5);
}
```

---

## 5. –®–∞–≥ 4: –ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ä—Ç–æ—á–µ–∫ –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥

### 5.1 Backend: GET /api/motivations/cards

```typescript
// server/routes/motivations.ts

app.get('/api/motivations/cards/:userId', async (c) => {
  try {
    const userId = c.req.param('userId');

    console.log('[BACKEND] –ó–∞–ø—Ä–æ—Å –∫–∞—Ä—Ç–æ—á–µ–∫ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', userId);

    // 1. –ü–æ–ª—É—á–∏—Ç—å –∑–∞–ø–∏—Å–∏ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 48 —á–∞—Å–æ–≤
    const yesterday = new Date(Date.now() - 48 * 60 * 60 * 1000);

    const { data: recentEntries, error: entriesError } = await db
      .from('entry_summaries')
      .select('*')
      .eq('user_id', userId)
      .gte('created_at', yesterday.toISOString())
      .order('created_at', { ascending: false })
      .limit(10);

    if (entriesError) throw entriesError;

    console.log('[BACKEND] –ù–∞–π–¥–µ–Ω–æ –∑–∞–ø–∏—Å–µ–π –∑–∞ 48—á:', recentEntries.length);

    // 2. –ü–æ–ª—É—á–∏—Ç—å –ø—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –∏–∑ KV Store
    const viewedKey = `card_views:${userId}`;
    const viewedData = await kv.get(viewedKey);
    const viewedIds = viewedData ? JSON.parse(viewedData) : [];

    console.log('[BACKEND] –ü—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏:', viewedIds);

    // 3. –û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –Ω–µ–ø—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã–µ
    const availableEntries = recentEntries
      .filter(entry => !viewedIds.includes(entry.entry_id))
      .slice(0, 3);

    console.log('[BACKEND] –î–æ—Å—Ç—É–ø–Ω—ã—Ö –∫–∞—Ä—Ç–æ—á–µ–∫:', availableEntries.length);

    // 4. –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å –≤ MotivationCard
    const cards = availableEntries.map(entry => ({
      id: entry.entry_id,
      entryId: entry.entry_id,
      date: formatDate(entry.created_at),
      title: entry.summary_json.text
        .split(' ')
        .slice(0, 3)
        .join(' '),
      description: entry.summary_json.insight,
      gradient: getGradient(entry.summary_json.sentiment),
      sentiment: entry.summary_json.sentiment,
      mood: entry.summary_json.mood,
      isMarked: false,
      isDefault: false
    }));

    console.log('[BACKEND] –†–µ–∞–ª—å–Ω—ã—Ö –∫–∞—Ä—Ç–æ—á–µ–∫:', cards.length);

    // 5. –î–æ–±–∞–≤–∏—Ç—å –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
    if (cards.length < 3) {
      const userProfile = await db
        .from('profiles')
        .select('language')
        .eq('id', userId)
        .single();

      const language = userProfile.data?.language || 'ru';
      const defaults = getDefaultMotivations(language);

      const additionalDefaults = defaults.slice(0, 3 - cards.length);
      console.log('[BACKEND] –î–æ–±–∞–≤–ª–µ–Ω–æ –¥–µ—Ñ–æ–ª—Ç–Ω—ã—Ö –∫–∞—Ä—Ç–æ—á–µ–∫:', additionalDefaults.length);

      cards.push(...additionalDefaults);
    }

    console.log('[BACKEND] –ò—Ç–æ–≥–æ –∫–∞—Ä—Ç–æ—á–µ–∫ –∫ –æ—Ç–ø—Ä–∞–≤–∫–µ:', cards.length);

    return c.json({
      success: true,
      data: cards,
      count: cards.length
    });
  } catch (error) {
    console.error('[BACKEND] –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∫–∞—Ä—Ç–æ—á–µ–∫:', error);
    return c.json(
      {
        success: false,
        error: error.message
      },
      500
    );
  }
});

function formatDate(dateString: string): string {
  const date = new Date(dateString);
  const now = new Date();
  const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
  const yesterday = new Date(today);
  yesterday.setDate(yesterday.getDate() - 1);
  const entryDate = new Date(date.getFullYear(), date.getMonth(), date.getDate());

  if (entryDate.getTime() === today.getTime()) {
    return `–°–µ–≥–æ–¥–Ω—è –≤ ${date.getHours()}:${String(date.getMinutes()).padStart(2, '0')}`;
  } else if (entryDate.getTime() === yesterday.getTime()) {
    return `–í—á–µ—Ä–∞ –≤ ${date.getHours()}:${String(date.getMinutes()).padStart(2, '0')}`;
  } else {
    return date.toLocaleDateString('ru-RU', {
      day: 'numeric',
      month: 'long',
      hour: '2-digit',
      minute: '2-digit'
    });
  }
}

function getGradient(sentiment: string): string {
  const gradients = {
    positive: 'from-[#FE7669] to-[#ff8969]',
    neutral: 'from-[#ff6b9d] to-[#c471ed]',
    negative: 'from-[#c471ed] to-[#8B78FF]'
  };
  return gradients[sentiment] || gradients.positive;
}

function getDefaultMotivations(language: string) {
  const motivations = {
    ru: [
      {
        id: 'default_1',
        date: '–ù–∞—á–Ω–∏ —Å–µ–≥–æ–¥–Ω—è',
        title: '–°–µ–≥–æ–¥–Ω—è –æ—Ç–ª–∏—á–Ω–æ–µ –≤—Ä–µ–º—è',
        description: '–ó–∞–ø–∏—à–∏ –º–∞–ª–µ–Ω—å–∫—É—é –ø–æ–±–µ–¥—É ‚Äî —ç—Ç–æ –ø–µ—Ä–≤—ã–π —à–∞–≥ –∫ –æ—Å–æ–∑–Ω–∞–Ω–∏—é —Å–≤–æ–∏—Ö –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π.',
        gradient: 'from-[#FE7669] to-[#ff8969]',
        isMarked: false,
        isDefault: true
      },
      {
        id: 'default_2',
        date: '–°–æ–≤–µ—Ç –¥–Ω—è',
        title: '–î–∞–∂–µ –æ–¥–Ω–∞ –º—ã—Å–ª—å –¥–µ–ª–∞–µ—Ç –¥–µ–Ω—å –æ—Å–º—ã—Å–ª–µ–Ω–Ω—ã–º',
        description: '–ù–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø–∏—Å–∞—Ç—å –º–Ω–æ–≥–æ ‚Äî –æ–¥–Ω–∞ —Ñ—Ä–∞–∑–∞ –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å —Ç–≤–æ–π –≤–∑–≥–ª—è–¥ –Ω–∞ –¥–µ–Ω—å.',
        gradient: 'from-[#ff6b9d] to-[#c471ed]',
        isMarked: false,
        isDefault: true
      },
      {
        id: 'default_3',
        date: '–ú–æ—Ç–∏–≤–∞—Ü–∏—è',
        title: '–ó–∞–ø–∏—à–∏ –º–æ–º–µ–Ω—Ç –±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç–∏',
        description: '–ü–æ—á—É–≤—Å—Ç–≤—É–π –ª—ë–≥–∫–æ—Å—Ç—å, –∫–æ–≥–¥–∞ –∑–∞–º–µ—á–∞–µ—à—å —Ö–æ—Ä–æ—à–µ–µ –≤ —Å–≤–æ–µ–π –∂–∏–∑–Ω–∏. –≠—Ç–æ –ø—É—Ç—å –∫ —Å—á–∞—Å—Ç—å—é.',
        gradient: 'from-[#c471ed] to-[#8B78FF]',
        isMarked: false,
        isDefault: true
      }
    ],
    en: [
      {
        id: 'default_1',
        date: 'Start today',
        title: 'Today is a great time',
        description: 'Write down a small victory ‚Äî it is the first step to recognizing your achievements.',
        gradient: 'from-[#FE7669] to-[#ff8969]',
        isMarked: false,
        isDefault: true
      },
      // ... 2 more
    ]
    // ... es, de, fr, zh, ja
  };

  return motivations[language] || motivations.ru;
}
```

### 5.2 Frontend: Load cards in component

```typescript
// components/AchievementHomeScreen.tsx

import React, { useState, useEffect } from 'react';
import { getMotivationCards, markCardAsRead } from '../utils/api';
import { useAuth } from '../context/AuthContext';

export function AchievementHomeScreen({ diaryData }) {
  const { userData } = useAuth();
  const [cards, setCards] = useState([]);
  const [currentCardIndex, setCurrentCardIndex] = useState(0);
  const [isLoading, setIsLoading] = useState(true);
  const [error, setError] = useState(null);

  // –ó–∞–≥—Ä—É–∑–∏—Ç—å –∫–∞—Ä—Ç–æ—á–∫–∏ –ø—Ä–∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏
  useEffect(() => {
    loadCards();
  }, [userData?.id]);

  const loadCards = async () => {
    try {
      setIsLoading(true);
      setError(null);

      console.log('[FRONTEND] –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–∞—Ä—Ç–æ—á–∫–∏ –¥–ª—è:', userData?.id);

      const motivationCards = await getMotivationCards(userData.id);

      console.log('[FRONTEND] –ö–∞—Ä—Ç–æ—á–∫–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã:', motivationCards.length);

      setCards(motivationCards);
    } catch (err) {
      console.error('[FRONTEND] –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', err);
      setError('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ä—Ç–æ—á–µ–∫');
    } finally {
      setIsLoading(false);
    }
  };

  const handleSwipe = async (direction) => {
    const currentCard = cards[currentCardIndex];

    if (direction === 'right') {
      // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ–≥–æ–ª–æ—Å–æ–≤–∞–ª "–ª–∞–π–∫"
      await markCardAsRead(userData.id, currentCard.id);
    } else if (direction === 'left') {
      // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–≤–∞–π–ø–Ω—É–ª –≤–ª–µ–≤–æ - –ø–µ—Ä–µ–π—Ç–∏ –≤ —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏
      navigateTo('/chat');
      return;
    }

    // –ü–æ–∫–∞–∑–∞—Ç—å —Å–ª–µ–¥—É—é—â—É—é –∫–∞—Ä—Ç–æ—á–∫—É
    const nextIndex = (currentCardIndex + 1) % cards.length;
    setCurrentCardIndex(nextIndex);
  };

  if (isLoading) {
    return <div className="loading-spinner">–ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ä—Ç–æ—á–µ–∫...</div>;
  }

  if (error) {
    return <div className="error-message">{error}</div>;
  }

  if (cards.length === 0) {
    return <div className="no-cards">–ù–µ—Ç –∫–∞—Ä—Ç–æ—á–µ–∫</div>;
  }

  const currentCard = cards[currentCardIndex];

  return (
    <div className="achievement-home-screen">
      <header className="header">
        <h1>{diaryData.emoji} {diaryData.name}</h1>
      </header>

      {/* Swipeable Card */}
      <div
        className={`motivation-card gradient-${currentCard.sentiment}`}
        style={{
          backgroundImage: `linear-gradient(135deg, var(--${currentCard.gradient.split(' ')[0]}), var(--${currentCard.gradient.split(' ')[1]}))`
        }}
        onTouchStart={handleTouchStart}
        onTouchEnd={handleTouchEnd}
      >
        <p className="date">{currentCard.date}</p>
        <h2 className="title">{currentCard.title}</h2>
        <p className="description">{currentCard.description}</p>
      </div>

      {/* Progress Dots */}
      <div className="progress-dots">
        {cards.map((_, index) => (
          <div
            key={index}
            className={`dot ${index === currentCardIndex ? 'active' : ''}`}
          />
        ))}
      </div>

      {/* Action Buttons */}
      <div className="action-buttons">
        <button onClick={() => navigateTo('/chat')} className="btn-primary">
          + –ù–æ–≤–∞—è –∑–∞–ø–∏—Å—å
        </button>
        <button onClick={() => navigateTo('/books')} className="btn-secondary">
          –ú–æ–∏ –∫–Ω–∏–≥–∏
        </button>
      </div>
    </div>
  );
}
```

---

## 6. –î–∏–∞–≥—Ä–∞–º–º–∞ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (Sequence Diagram)

```
USER          FRONTEND         BACKEND          OPENAI          DATABASE
 ‚îÇ                ‚îÇ               ‚îÇ                ‚îÇ               ‚îÇ
 ‚îú‚îÄ Type text ‚îÄ‚îÄ‚îÄ‚Üí‚îÇ               ‚îÇ                ‚îÇ               ‚îÇ
 ‚îÇ                ‚îÇ               ‚îÇ                ‚îÇ               ‚îÇ
 ‚îú‚îÄ Click send ‚îÄ‚îÄ‚îÄ‚Üí‚îÇ               ‚îÇ                ‚îÇ               ‚îÇ
 ‚îÇ                ‚îÇ               ‚îÇ                ‚îÇ               ‚îÇ
 ‚îÇ                ‚îú‚îÄ POST /chat/analyze ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚Üí‚îÇ               ‚îÇ
 ‚îÇ                ‚îÇ               ‚îÇ (text, userId)  ‚îÇ               ‚îÇ
 ‚îÇ                ‚îÇ               ‚îÇ                 ‚îÇ               ‚îÇ
 ‚îÇ                ‚îÇ               ‚îú‚îÄ Get user language              ‚îÇ
 ‚îÇ                ‚îÇ               ‚îÇ (from cache or DB)              ‚îÇ
 ‚îÇ                ‚îÇ               ‚îÇ                                 ‚îÇ
 ‚îÇ                ‚îÇ               ‚îú‚îÄ Build systemPrompt             ‚îÇ
 ‚îÇ                ‚îÇ               ‚îÇ (in user's language)            ‚îÇ
 ‚îÇ                ‚îÇ               ‚îÇ                                 ‚îÇ
 ‚îÇ                ‚îÇ               ‚îú‚îÄ Call gpt-4-turbo ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚Üí‚îÇ
 ‚îÇ                ‚îÇ               ‚îÇ (system + user prompt)          ‚îÇ
 ‚îÇ                ‚îÇ ‚è± 2-3 sec     ‚îÇ                                 ‚îÇ
 ‚îÇ                ‚îÇ               ‚îÇ‚Üê‚îÄ JSON response ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
 ‚îÇ                ‚îÇ               ‚îÇ {reply, summary, insight, ...}  ‚îÇ
 ‚îÇ                ‚îÇ               ‚îÇ                                 ‚îÇ
 ‚îÇ                ‚îÇ               ‚îú‚îÄ Parse JSON                     ‚îÇ
 ‚îÇ                ‚îÇ               ‚îÇ                                 ‚îÇ
 ‚îÇ                ‚îÇ               ‚îú‚îÄ INSERT diary_entries ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚Üí‚îÇ
 ‚îÇ                ‚îÇ               ‚îÇ                    ‚Üì            ‚îÇ
 ‚îÇ                ‚îÇ               ‚îÇ ‚úì Entry created    ‚Üì            ‚îÇ
 ‚îÇ                ‚îÇ               ‚îÇ‚Üê‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
 ‚îÇ                ‚îÇ               ‚îÇ                                 ‚îÇ
 ‚îÇ                ‚îÇ               ‚îú‚îÄ INSERT entry_summaries ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚Üí‚îÇ
 ‚îÇ                ‚îÇ               ‚îÇ (for token optimization)        ‚îÇ
 ‚îÇ                ‚îÇ               ‚îÇ                    ‚Üì            ‚îÇ
 ‚îÇ                ‚îÇ               ‚îÇ ‚úì Summary stored   ‚Üì            ‚îÇ
 ‚îÇ                ‚îÇ               ‚îÇ‚Üê‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
 ‚îÇ                ‚îÇ               ‚îÇ                                 ‚îÇ
 ‚îÇ                ‚îú‚îÄ