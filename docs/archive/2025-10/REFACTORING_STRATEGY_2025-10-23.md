# üîß –°—Ç—Ä–∞—Ç–µ–≥–∏—è —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ UNITY-v2

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è**: 23 –æ–∫—Ç—è–±—Ä—è 2025  
**–û—Å–Ω–æ–≤–∞–Ω–∏–µ**: [–ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –∞—É–¥–∏—Ç –∫–æ–¥–æ–≤–æ–π –±–∞–∑—ã](../reports/COMPREHENSIVE_CODEBASE_AUDIT_2025-10-23.md)  
**–¶–µ–ª—å**: –ù–∞–≤–µ—Å—Ç–∏ –ø–æ—Ä—è–¥–æ–∫ –≤ –∫–æ–¥–æ–≤–æ–π –±–∞–∑–µ –±–µ–∑ –ø–æ–ª–æ–º–∫–∏ production

---

## üéØ –û–±—â–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è

### –ü—Ä–∏–Ω—Ü–∏–ø—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞

1. **Safety First** - –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –ø—Ä–µ–≤—ã—à–µ —Å–∫–æ—Ä–æ—Å—Ç–∏
2. **Test Before Commit** - —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ö–ê–ñ–î–û–ï –∏–∑–º–µ–Ω–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Chrome DevTools MCP
3. **Incremental Changes** - –º–∞–ª–µ–Ω—å–∫–∏–µ —à–∞–≥–∏, —á–∞—Å—Ç—ã–µ –∫–æ–º–º–∏—Ç—ã
4. **Rollback Ready** - –≤—Å–µ–≥–¥–∞ –≥–æ—Ç–æ–≤—ã –æ—Ç–∫–∞—Ç–∏—Ç—å—Å—è –Ω–∞–∑–∞–¥
5. **Production Monitoring** - —Å–ª–µ–¥–∏—Ç—å –∑–∞ Vercel –¥–µ–ø–ª–æ—è–º–∏

### Workflow –¥–ª—è –ö–ê–ñ–î–û–ì–û –∏–∑–º–µ–Ω–µ–Ω–∏—è

```mermaid
graph TD
    A[–ù–∞—á–∞–ª–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è] --> B[–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Å–æ–ª–∏ BEFORE]
    B --> C[–í–Ω–µ—Å–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π]
    C --> D[–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Å–æ–ª–∏ AFTER]
    D --> E{–û—à–∏–±–∫–∏?}
    E -->|–î–∞| F[–ò—Å–ø—Ä–∞–≤–∏—Ç—å –ù–ï–ú–ï–î–õ–ï–ù–ù–û]
    F --> D
    E -->|–ù–µ—Ç| G[–ö–æ–º–º–∏—Ç]
    G --> H[Push –≤ main]
    H --> I[Vercel auto-deploy]
    I --> J[–ü—Ä–æ–≤–µ—Ä–∫–∞ production]
    J --> K{–†–∞–±–æ—Ç–∞–µ—Ç?}
    K -->|–î–∞| L[–°–ª–µ–¥—É—é—â–∞—è –∑–∞–¥–∞—á–∞]
    K -->|–ù–µ—Ç| M[Rollback]
    M --> N[–ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º—ã]
```

---

## üìã –ü–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á

### –§–∞–∑–∞ 1: –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (P0) - 1-2 –¥–Ω—è

**–¶–µ–ª—å**: –£—Å—Ç—Ä–∞–Ω–∏—Ç—å security –∏ performance –ø—Ä–æ–±–ª–µ–º—ã –ë–î

#### 1.1 Supabase Security Fixes (2 —á–∞—Å–∞)
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: üî¥ P0  
**–†–∏—Å–∫**: üü¢ –ù–∏–∑–∫–∏–π (—Ç–æ–ª—å–∫–æ –ë–î)  
**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: Supabase Advisors

**–ó–∞–¥–∞—á–∏**:
- [ ] –î–æ–±–∞–≤–∏—Ç—å `SET search_path = public, pg_temp` –≤ 5 —Ñ—É–Ω–∫—Ü–∏–π:
  - `update_push_subscription_updated_at`
  - `get_users_with_entries_count`
  - `calculate_user_streak`
  - `get_users_with_stats`
  - `update_api_services_updated_at`
- [ ] –í–∫–ª—é—á–∏—Ç—å Leaked Password Protection –≤ Supabase Dashboard
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á–µ—Ä–µ–∑ `get_advisors_supabase` (0 WARN security)

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è**:
- ‚úÖ Supabase Security Advisors: 0 WARN
- ‚úÖ –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–º–µ—é—Ç `SET search_path`
- ‚úÖ Password Protection –≤–∫–ª—é—á–µ–Ω

---

#### 1.2 RLS –ü–æ–ª–∏—Ç–∏–∫–∏ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è (4 —á–∞—Å–∞)
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: üî¥ P0  
**–†–∏—Å–∫**: üü° –°—Ä–µ–¥–Ω–∏–π (–º–æ–∂–µ—Ç –ø–æ–≤–ª–∏—è—Ç—å –Ω–∞ –¥–æ—Å—Ç—É–ø)  
**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: Chrome DevTools + Supabase Advisors

**–ó–∞–¥–∞—á–∏**:
- [ ] –ó–∞–º–µ–Ω–∏—Ç—å `auth.uid()` –Ω–∞ `(select auth.uid())` –≤ 12 –ø–æ–ª–∏—Ç–∏–∫–∞—Ö:
  - `push_notifications_history` (4 –ø–æ–ª–∏—Ç–∏–∫–∏)
  - `usage` (4 –ø–æ–ª–∏—Ç–∏–∫–∏)
  - `push_subscriptions` (4 –ø–æ–ª–∏—Ç–∏–∫–∏)
- [ ] –û–±—ä–µ–¥–∏–Ω–∏—Ç—å Multiple Permissive Policies (16 –ø–æ–ª–∏—Ç–∏–∫)
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á–µ—Ä–µ–∑ `get_advisors_supabase` (0 WARN performance)
- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–æ—Å—Ç—É–ø –¥–ª—è user –∏ super_admin

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è**:
- ‚úÖ Supabase Performance Advisors: 0 WARN Auth RLS
- ‚úÖ –í—Å–µ –ø–æ–ª–∏—Ç–∏–∫–∏ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã
- ‚úÖ –î–æ—Å—Ç—É–ø —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –æ–±–µ–∏—Ö —Ä–æ–ª–µ–π

---

#### 1.3 –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ë–î –ò–Ω–¥–µ–∫—Å–æ–≤ (2 —á–∞—Å–∞)
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: üî¥ P0  
**–†–∏—Å–∫**: üü¢ –ù–∏–∑–∫–∏–π (—Ç–æ–ª—å–∫–æ –ë–î)  
**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: Supabase Advisors

**–ó–∞–¥–∞—á–∏**:
- [ ] –î–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è foreign keys:
  - `CREATE INDEX idx_media_files_entry_id ON media_files(entry_id)`
  - `CREATE INDEX idx_media_files_user_id ON media_files(user_id)`
- [ ] –£–¥–∞–ª–∏—Ç—å 7 –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –∏–Ω–¥–µ–∫—Å–æ–≤:
  - `DROP INDEX idx_usage_user_id`
  - `DROP INDEX idx_push_subscriptions_endpoint`
  - `DROP INDEX idx_push_history_created_at`
  - `DROP INDEX idx_push_history_status`
  - `DROP INDEX idx_push_history_sent_by`
  - `DROP INDEX idx_profiles_last_active`
  - `DROP INDEX idx_profiles_pwa_installed`
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á–µ—Ä–µ–∑ `get_advisors_supabase` (0 INFO unused indexes)

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è**:
- ‚úÖ Supabase Performance Advisors: 0 INFO unused indexes
- ‚úÖ Foreign keys –∏–º–µ—é—Ç –∏–Ω–¥–µ–∫—Å—ã
- ‚úÖ –ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∏–Ω–¥–µ–∫—Å—ã —É–¥–∞–ª–µ–Ω—ã

---

### –§–∞–∑–∞ 2: –£–¥–∞–ª–µ–Ω–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ (P0) - 2 —á–∞—Å–∞

**–¶–µ–ª—å**: –£—Å—Ç—Ä–∞–Ω–∏—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞

#### 2.1 –£–¥–∞–ª–µ–Ω–∏–µ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ (2 —á–∞—Å–∞)
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: üî¥ P0  
**–†–∏—Å–∫**: üü° –°—Ä–µ–¥–Ω–∏–π (–º–æ–∂–µ—Ç —Å–ª–æ–º–∞—Ç—å –∏–º–ø–æ—Ä—Ç—ã)  
**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: Chrome DevTools (–∫–æ–Ω—Å–æ–ª—å)

**–ó–∞–¥–∞—á–∏**:
- [ ] –£–¥–∞–ª–∏—Ç—å `src/features/mobile/media/hooks/useMediaUploader.ts`
  - –û–±–Ω–æ–≤–∏—Ç—å –∏–º–ø–æ—Ä—Ç—ã –Ω–∞ `src/shared/hooks/useMediaUploader.ts`
  - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞
- [ ] –£–¥–∞–ª–∏—Ç—å `src/components/hooks/useSpeechRecognition.ts`
  - –û–±–Ω–æ–≤–∏—Ç—å –∏–º–ø–æ—Ä—Ç—ã –Ω–∞ `src/shared/hooks/useSpeechRecognition.ts`
  - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞
- [ ] –£–¥–∞–ª–∏—Ç—å `src/components/ui/sidebar.tsx`
  - –û–±–Ω–æ–≤–∏—Ç—å –∏–º–ø–æ—Ä—Ç—ã –Ω–∞ `src/shared/components/ui/sidebar.tsx`
  - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞
- [ ] –£–¥–∞–ª–∏—Ç—å `src/components/ui/shadcn-io/*` (–≤—Å–µ –¥—É–±–ª–∏–∫–∞—Ç—ã)
  - –û–±–Ω–æ–≤–∏—Ç—å –∏–º–ø–æ—Ä—Ç—ã –Ω–∞ `src/shared/components/ui/shadcn-io/*`
  - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è**:
- ‚úÖ –í—Å–µ –¥—É–±–ª–∏–∫–∞—Ç—ã —É–¥–∞–ª–µ–Ω—ã
- ‚úÖ –ò–º–ø–æ—Ä—Ç—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã
- ‚úÖ –ö–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞: 0 –æ—à–∏–±–æ–∫
- ‚úÖ PWA —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ Admin –ø–∞–Ω–µ–ª—å —Ä–∞–±–æ—Ç–∞–µ—Ç

---

### –§–∞–∑–∞ 3: –†–∞–∑–±–∏–µ–Ω–∏–µ –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤ (P1) - 3 –¥–Ω—è

**–¶–µ–ª—å**: –°–¥–µ–ª–∞—Ç—å –∫–æ–¥ AI-friendly

#### 3.1 –†–∞–∑–±–∏–µ–Ω–∏–µ api.ts (1 –¥–µ–Ω—å)
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: üü° P1  
**–†–∏—Å–∫**: üî¥ –í—ã—Å–æ–∫–∏–π (–∫—Ä–∏—Ç–∏—á–Ω—ã–π —Ñ–∞–π–ª)  
**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: Chrome DevTools + —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**–°—Ç—Ä–∞—Ç–µ–≥–∏—è**:
1. –°–æ–∑–¥–∞—Ç—å –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã –≤ `src/shared/lib/api/`:
   - `auth.ts` - –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
   - `entries.ts` - –∑–∞–ø–∏—Å–∏
   - `media.ts` - –º–µ–¥–∏–∞
   - `analytics.ts` - –∞–Ω–∞–ª–∏—Ç–∏–∫–∞
   - `admin.ts` - –∞–¥–º–∏–Ω —Ñ—É–Ω–∫—Ü–∏–∏
2. –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏
3. –û–±–Ω–æ–≤–ª—è—Ç—å –∏–º–ø–æ—Ä—Ç—ã –ø–æ –æ–¥–Ω–æ–º—É –º–æ–¥—É–ª—é
4. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –º–æ–¥—É–ª—è

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è**:
- ‚úÖ api.ts —Ä–∞–∑–±–∏—Ç –Ω–∞ 5+ —Ñ–∞–π–ª–æ–≤
- ‚úÖ –ö–∞–∂–¥—ã–π —Ñ–∞–π–ª <300 —Å—Ç—Ä–æ–∫
- ‚úÖ –í—Å–µ –∏–º–ø–æ—Ä—Ç—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã
- ‚úÖ –ö–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞: 0 –æ—à–∏–±–æ–∫

---

#### 3.2 –†–∞–∑–±–∏–µ–Ω–∏–µ server/index.tsx (1 –¥–µ–Ω—å)
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: üü° P1  
**–†–∏—Å–∫**: üî¥ –í—ã—Å–æ–∫–∏–π (Edge Function)  
**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: Chrome DevTools + Edge Function logs

**–°—Ç—Ä–∞—Ç–µ–≥–∏—è**:
1. –°–æ–∑–¥–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–µ Edge Functions:
   - `profiles-v5` - –ø—Ä–æ—Ñ–∏–ª–∏
   - `admin-api-v9` - –∞–¥–º–∏–Ω API
   - `push-sender-v2` - push —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
2. –î–µ–ø–ª–æ–∏—Ç—å —á–µ—Ä–µ–∑ Supabase MCP `deploy_edge_function_supabase`
3. –û–±–Ω–æ–≤–ª—è—Ç—å –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–π –∫–æ–¥ –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ
4. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–∞–∂–¥—É—é —Ñ—É–Ω–∫—Ü–∏—é –æ—Ç–¥–µ–ª—å–Ω–æ

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è**:
- ‚úÖ server/index.tsx —Ä–∞–∑–±–∏—Ç –Ω–∞ 3+ Edge Functions
- ‚úÖ –ö–∞–∂–¥–∞—è —Ñ—É–Ω–∫—Ü–∏—è <700 —Å—Ç—Ä–æ–∫
- ‚úÖ –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∑–∞–¥–µ–ø–ª–æ–µ–Ω—ã
- ‚úÖ –ö–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞: 0 –æ—à–∏–±–æ–∫

---

#### 3.3 –†–∞–∑–±–∏–µ–Ω–∏–µ –±–æ–ª—å—à–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ (1 –¥–µ–Ω—å)
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: üü° P1  
**–†–∏—Å–∫**: üü° –°—Ä–µ–¥–Ω–∏–π  
**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: Chrome DevTools

**–§–∞–π–ª—ã –¥–ª—è —Ä–∞–∑–±–∏–µ–Ω–∏—è**:
- `OnboardingScreen4.tsx` (933 —Å—Ç—Ä–æ–∫) ‚Üí 3-4 –ø–æ–¥–∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
- `SettingsScreen.tsx` (858 —Å—Ç—Ä–æ–∫) ‚Üí —Å–µ–∫—Ü–∏–∏
- `ChatInputSection.tsx` (820 —Å—Ç—Ä–æ–∫) ‚Üí –ª–æ–≥–∏–∫–∞ –≤ hooks
- `AchievementHomeScreen.tsx` (749 —Å—Ç—Ä–æ–∫) ‚Üí –ø–æ–¥–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- `AIAnalyticsTab.tsx` (712 —Å—Ç—Ä–æ–∫) ‚Üí –≤–∏–¥–∂–µ—Ç—ã

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è**:
- ‚úÖ –í—Å–µ —Ñ–∞–π–ª—ã <500 —Å—Ç—Ä–æ–∫
- ‚úÖ –õ–æ–≥–∏–∫–∞ –≤—ã–Ω–µ—Å–µ–Ω–∞ –≤ hooks
- ‚úÖ –ö–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞: 0 –æ—à–∏–±–æ–∫

---

### –§–∞–∑–∞ 4: –ú–∏–≥—Ä–∞—Ü–∏—è legacy –∫–æ–¥–∞ (P1) - 2 –¥–Ω—è

**–¶–µ–ª—å**: –ó–∞–≤–µ—Ä—à–∏—Ç—å –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ FSD –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É

#### 4.1 –ú–∏–≥—Ä–∞—Ü–∏—è components/ (1 –¥–µ–Ω—å)
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: üü° P1  
**–†–∏—Å–∫**: üü° –°—Ä–µ–¥–Ω–∏–π  
**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: Chrome DevTools

**–°—Ç—Ä–∞—Ç–µ–≥–∏—è**:
1. –ù–∞–π—Ç–∏ –≤—Å–µ –∏–º–ø–æ—Ä—Ç—ã –∏–∑ `src/components/`
2. –û–±–Ω–æ–≤–∏—Ç—å –∏–º–ø–æ—Ä—Ç—ã –Ω–∞ `src/shared/components/`
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Å–æ–ª—å –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —Ñ–∞–π–ª–∞
4. –ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å –≤ `/old/components/`

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è**:
- ‚úÖ –í—Å–µ –∏–º–ø–æ—Ä—Ç—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã
- ‚úÖ components/ –ø–µ—Ä–µ–º–µ—â–µ–Ω –≤ /old
- ‚úÖ –ö–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞: 0 –æ—à–∏–±–æ–∫

---

#### 4.2 –ú–∏–≥—Ä–∞—Ü–∏—è utils/ (1 –¥–µ–Ω—å)
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: üü° P1  
**–†–∏—Å–∫**: üü° –°—Ä–µ–¥–Ω–∏–π  
**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: Chrome DevTools

**–°—Ç—Ä–∞—Ç–µ–≥–∏—è**:
1. –ù–∞–π—Ç–∏ –≤—Å–µ –∏–º–ø–æ—Ä—Ç—ã –∏–∑ `src/utils/`
2. –û–±–Ω–æ–≤–∏—Ç—å –∏–º–ø–æ—Ä—Ç—ã –Ω–∞ `src/shared/lib/`
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Å–æ–ª—å –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —Ñ–∞–π–ª–∞
4. –ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å –≤ `/old/utils/`

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è**:
- ‚úÖ –í—Å–µ –∏–º–ø–æ—Ä—Ç—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã
- ‚úÖ utils/ –ø–µ—Ä–µ–º–µ—â–µ–Ω –≤ /old
- ‚úÖ –ö–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞: 0 –æ—à–∏–±–æ–∫

---

### –§–∞–∑–∞ 5: React Native –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ (P2) - 2 –Ω–µ–¥–µ–ª–∏

**–¶–µ–ª—å**: –î–æ–≤–µ—Å—Ç–∏ React Native –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –¥–æ 100%

#### 5.1 –†–µ–∞–ª–∏–∑–∞—Ü–∏—è Native –∞–¥–∞–ø—Ç–µ—Ä–æ–≤ (1 –Ω–µ–¥–µ–ª—è)
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: üü¢ P2  
**–†–∏—Å–∫**: üü¢ –ù–∏–∑–∫–∏–π (–Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ PWA)  
**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: Unit tests

**–ó–∞–¥–∞—á–∏**:
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `NativeStorageAdapter` (AsyncStorage)
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `NativeMediaAdapter` (ImagePicker)
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `NativeNavigationAdapter` (React Navigation)
- [ ] –ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è –≤—Å–µ—Ö –∞–¥–∞–ø—Ç–µ—Ä–æ–≤

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è**:
- ‚úÖ –í—Å–µ Native –∞–¥–∞–ø—Ç–µ—Ä—ã —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã
- ‚úÖ –¢–µ—Å—Ç—ã –ø–æ–∫—Ä—ã–≤–∞—é—Ç 80%+ –∫–æ–¥–∞
- ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞

---

#### 5.2 Universal Components (1 –Ω–µ–¥–µ–ª—è)
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: üü¢ P2  
**–†–∏—Å–∫**: üü¢ –ù–∏–∑–∫–∏–π  
**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: Unit tests

**–ó–∞–¥–∞—á–∏**:
- [ ] –°–æ–∑–¥–∞—Ç—å 10+ Universal Components:
  - Input, TextArea, Checkbox, Radio
  - Card, List, Grid
  - Toast, Alert, Dialog
- [ ] –ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è**:
- ‚úÖ 15+ Universal Components
- ‚úÖ –¢–µ—Å—Ç—ã –ø–æ–∫—Ä—ã–≤–∞—é—Ç 80%+ –∫–æ–¥–∞
- ‚úÖ Storybook –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

---

## üß™ –°—Ç—Ä–∞—Ç–µ–≥–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –ü–µ—Ä–µ–¥ –ö–ê–ñ–î–´–ú –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º

1. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Å–æ–ª–∏ BEFORE**
   ```bash
   # Chrome DevTools MCP
   take_snapshot_chrome-devtools()
   list_console_messages_chrome-devtools()
   ```

2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ Supabase BEFORE**
   ```bash
   # Supabase MCP
   get_advisors_supabase(project_id='ecuwuzqlwdkkdncampnc', type='security')
   get_advisors_supabase(project_id='ecuwuzqlwdkkdncampnc', type='performance')
   ```

### –ü–æ—Å–ª–µ –ö–ê–ñ–î–û–ì–û –∏–∑–º–µ–Ω–µ–Ω–∏—è

1. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Å–æ–ª–∏ AFTER**
   ```bash
   # Chrome DevTools MCP
   take_snapshot_chrome-devtools()
   list_console_messages_chrome-devtools()
   ```

2. **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**
   - PWA: –í—Ö–æ–¥ ‚Üí –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ ‚Üí –ü—Ä–æ—Å–º–æ—Ç—Ä –∏—Å—Ç–æ—Ä–∏–∏ ‚Üí –í—ã—Ö–æ–¥
   - Admin: –í—Ö–æ–¥ ‚Üí –ü—Ä–æ—Å–º–æ—Ç—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π ‚Üí –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí –í—ã—Ö–æ–¥

3. **–ü—Ä–æ–≤–µ—Ä–∫–∞ Vercel –¥–µ–ø–ª–æ—è**
   - –î–æ–∂–¥–∞—Ç—å—Å—è —É—Å–ø–µ—à–Ω–æ–≥–æ –¥–µ–ø–ª–æ—è
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å production URL: https://unity-wine.vercel.app
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Å–æ–ª—å –Ω–∞ production

### –ö—Ä–∏—Ç–µ—Ä–∏–∏ "–∑–µ–ª–µ–Ω–æ–≥–æ —Å–≤–µ—Ç–∞"

- ‚úÖ –ö–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞: 0 –æ—à–∏–±–æ–∫
- ‚úÖ Supabase Advisors: 0 –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö WARN
- ‚úÖ Vercel –¥–µ–ø–ª–æ–π: —É—Å–ø–µ—à–Ω—ã–π
- ‚úÖ PWA —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ Admin –ø–∞–Ω–µ–ª—å —Ä–∞–±–æ—Ç–∞–µ—Ç

---

## üö® –ü–ª–∞–Ω –æ—Ç–∫–∞—Ç–∞ (Rollback Strategy)

### –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ —Å–ª–æ–º–∞–ª–æ—Å—å

1. **–ù–µ–º–µ–¥–ª–µ–Ω–Ω—ã–π –æ—Ç–∫–∞—Ç**
   ```bash
   git revert HEAD
   git push origin main
   ```

2. **–ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º—ã**
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Vercel logs
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Supabase logs

3. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**
   - –°–æ–∑–¥–∞—Ç—å hotfix
   - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ
   - –î–µ–ø–ª–æ–∏—Ç—å —Å–Ω–æ–≤–∞

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ production

- –ü—Ä–æ–≤–µ—Ä—è—Ç—å Vercel Dashboard –∫–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç
- –ü—Ä–æ–≤–µ—Ä—è—Ç—å Sentry –¥–ª—è –æ—à–∏–±–æ–∫
- –ü—Ä–æ–≤–µ—Ä—è—Ç—å Supabase Dashboard –¥–ª—è –ø—Ä–æ–±–ª–µ–º –ë–î

---

## üìä –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞

### Code Quality
- –§–∞–π–ª–æ–≤ >300 —Å—Ç—Ä–æ–∫: 51 ‚Üí 20 (-60%)
- –î—É–±–ª–∏–∫–∞—Ç–æ–≤ –∫–æ–¥–∞: 10 ‚Üí 0 (-100%)
- Legacy —Ñ–∞–π–ª–æ–≤: 62 ‚Üí 0 (-100%)

### Architecture
- FSD —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ: 95% ‚Üí 100%
- AI-friendly: 75% ‚Üí 95%
- React Native –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å: 90% ‚Üí 100%

### Performance
- Supabase WARN: 34 ‚Üí 0 (-100%)
- –ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∏–Ω–¥–µ–∫—Å—ã: 7 ‚Üí 0 (-100%)
- RLS –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è: 0% ‚Üí 100%

---

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –ø–æ—Ä—è–¥–∫—É –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

### –ú–æ–∂–Ω–æ –¥–µ–ª–∞—Ç—å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ

- ‚úÖ Supabase Security + RLS –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è (–æ–±–∞ –ë–î)
- ‚úÖ –£–¥–∞–ª–µ–Ω–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ + –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏–Ω–¥–µ–∫—Å–æ–≤ (–Ω–µ–∑–∞–≤–∏—Å–∏–º—ã)
- ‚úÖ React Native –∞–¥–∞–ø—Ç–µ—Ä—ã + Universal Components (–Ω–µ –≤–ª–∏—è—é—Ç –Ω–∞ PWA)

### –¢—Ä–µ–±—É—é—Ç –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

- ‚ö†Ô∏è –†–∞–∑–±–∏–µ–Ω–∏–µ api.ts ‚Üí –†–∞–∑–±–∏–µ–Ω–∏–µ server/index.tsx (–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å)
- ‚ö†Ô∏è –£–¥–∞–ª–µ–Ω–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ ‚Üí –ú–∏–≥—Ä–∞—Ü–∏—è legacy (—Å–Ω–∞—á–∞–ª–∞ —É–±—Ä–∞—Ç—å –¥—É–±–ª–∏–∫–∞—Ç—ã)
- ‚ö†Ô∏è –ú–∏–≥—Ä–∞—Ü–∏—è components/ ‚Üí –ú–∏–≥—Ä–∞—Ü–∏—è utils/ (–ø–æ –æ—á–µ—Ä–µ–¥–∏)

### –û—Å–æ–±–∞—è –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ—Å—Ç—å

- üî¥ –†–∞–∑–±–∏–µ–Ω–∏–µ api.ts - –∫—Ä–∏—Ç–∏—á–Ω—ã–π —Ñ–∞–π–ª, –º–∞–ª–µ–Ω—å–∫–∏–µ —à–∞–≥–∏
- üî¥ –†–∞–∑–±–∏–µ–Ω–∏–µ server/index.tsx - Edge Function, —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç—â–∞—Ç–µ–ª—å–Ω–æ
- üî¥ RLS –ø–æ–ª–∏—Ç–∏–∫–∏ - –º–æ–∂–µ—Ç –ø–æ–≤–ª–∏—è—Ç—å –Ω–∞ –¥–æ—Å—Ç—É–ø, —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –æ–±–µ —Ä–æ–ª–∏

---

**–ê–≤—Ç–æ—Ä**: AI Assistant (Augment Agent)  
**–î–∞—Ç–∞**: 23 –æ–∫—Ç—è–±—Ä—è 2025  
**–í–µ—Ä—Å–∏—è**: 1.0

