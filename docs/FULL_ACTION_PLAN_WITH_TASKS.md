# üéØ –ü–û–õ–ù–´–ô –ü–õ–ê–ù –î–ï–ô–°–¢–í–ò–ô –° –¢–ê–°–ö–ê–ú–ò

**–ü—Ä–æ–µ–∫—Ç:** UNITY Diary Application  
**–î–∞—Ç–∞:** 15 –æ–∫—Ç—è–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** –ù–ê–ß–ò–ù–ê–ï–ú –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

---

## üìã –ê–ù–ê–õ–ò–ó –¢–ï–ö–£–©–ï–ô –°–ò–¢–£–ê–¶–ò–ò

### ‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–ë–õ–ï–ú–´:

1. **Edge Function —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–∞—è** (2140 —Å—Ç—Ä–æ–∫ > 1800 –ª–∏–º–∏—Ç –¥–µ–ø–ª–æ—è)
2. **–¢–∞–±–ª–∏—Ü–∞ `entry_summaries` –ø—É—Å—Ç–∞—è** - –Ω–∞—Ä—É—à–µ–Ω–∞ Token Optimization Strategy
3. **–ú–æ–∫–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ** –≤ ReportsScreen –∏ AchievementsScreen
4. **–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –±–ª–æ–∫ "–õ–µ–Ω—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –∑–∞–ø–∏—Å–µ–π"** –Ω–∞ –≥–ª–∞–≤–Ω–æ–º —ç–∫—Ä–∞–Ω–µ (—Å–æ–≥–ª–∞—Å–Ω–æ Figma)
5. **–ù–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ** –≤ –∑–∞–ø–∏—Å—è—Ö

### ‚úÖ –ß–¢–û –†–ê–ë–û–¢–ê–ï–¢:

- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π —Å AI –∞–Ω–∞–ª–∏–∑–æ–º
- ‚úÖ –ú–æ—Ç–∏–≤–∞—Ü–∏–æ–Ω–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ (–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç defaults)
- ‚úÖ –ò—Å—Ç–æ—Ä–∏—è –∑–∞–ø–∏—Å–µ–π
- ‚úÖ –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ JWT –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

### üìä –†–ï–ê–õ–¨–ù–´–ï –î–ê–ù–ù–´–ï –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø:

```
User: rustam@leadshunter.biz
ID: 726a9369-8c28-4134-b03f-3c29ad1235f4

‚úÖ entries: 5 –∑–∞–ø–∏—Å–µ–π
‚ùå entry_summaries: 0 –∑–∞–ø–∏—Å–µ–π (–ö–†–ò–¢–ò–ß–ù–û!)
```

**–ó–∞–ø–∏—Å–∏:**
1. 13.10 - –†–∞–±–æ—Ç–∞ - "–ó–∞–≤–µ—Ä—à–∏–ª –≤–∞–∂–Ω—ã–π –ø—Ä–æ–µ–∫—Ç"
2. 12.10 - –ó–¥–æ—Ä–æ–≤—å–µ - "–£—Ç—Ä–µ–Ω–Ω—è—è –ø—Ä–æ–±–µ–∂–∫–∞ 5 –∫–º"
3. 11.10 - –†–∞–±–æ—Ç–∞ - "–í—Å—Ç—Ä–µ—á–∞ —Å –∫–ª–∏–µ–Ω—Ç–æ–º"
4. 10.10 - –û–±—É—á–µ–Ω–∏–µ - "–ò–∑—É—á–∏–ª React Server Components"
5. 09.10 - –†–∞–±–æ—Ç–∞ - "–ü–æ–º–æ–≥ –∫–æ–ª–ª–µ–≥–µ"

---

## üéØ –ü–õ–ê–ù –î–ï–ô–°–¢–í–ò–ô (–ü–†–ò–û–†–ò–¢–ò–ó–ò–†–û–í–ê–ù–ù–´–ô)

### üìÖ –ù–ï–î–ï–õ–Ø 1: –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø (7 –¥–Ω–µ–π)

#### **–î–ï–ù–¨ 1-2: –ò—Å–ø—Ä–∞–≤–∏—Ç—å entry_summaries** üî¥ –ö–†–ò–¢–ò–ß–ù–û

**–¢–∞—Å–∫–∞:** `üî¥ –ö–†–ò–¢–ò–ß–ù–û: –ò—Å–ø—Ä–∞–≤–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ entry_summaries`

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–ø–∏—Å–∏ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ `entry_summaries` —Ç–∞–±–ª–∏—Ü—É

**–†–µ—à–µ–Ω–∏–µ:**

1. –ù–∞–π—Ç–∏ —ç–Ω–¥–ø–æ–∏–Ω—Ç `/api/chat/analyze` –≤ `supabase/functions/make-server-9729c493/index.ts`
2. –î–æ–±–∞–≤–∏—Ç—å INSERT –≤ `entry_summaries` –ø–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è `entry`

**–ö–æ–¥ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è:**

```typescript
// –ü–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è entry
const { data: entry, error: entryError } = await supabase
  .from('entries')
  .insert({
    user_id: userId,
    text,
    ai_summary: analysis.summary,
    ai_insight: analysis.insight,
    sentiment: analysis.sentiment,
    category: analysis.category,
    tags: analysis.tags,
    mood: analysis.mood,
    is_achievement: analysis.isAchievement,
    ai_reply: analysis.reply
  })
  .select()
  .single();

if (entryError) throw entryError;

// –î–û–ë–ê–í–ò–¢–¨: –°–æ—Ö—Ä–∞–Ω–∏—Ç—å entry_summary
const { error: summaryError } = await supabase
  .from('entry_summaries')
  .insert({
    entry_id: entry.id,
    user_id: userId,
    summary_json: {
      text: analysis.summary,
      insight: analysis.insight,
      mood: analysis.mood,
      sentiment: analysis.sentiment,
      contexts: [],
      tags: analysis.tags,
      achievements: analysis.isAchievement ? [{ text: analysis.summary }] : [],
      keywords: text.split(' ').filter(w => w.length > 3).slice(0, 5),
      excerpt: text.substring(0, 200),
      confidence: 0.95
    },
    tokens_used: usage.total_tokens || 0
  });

if (summaryError) {
  console.error('Failed to save entry_summary:', summaryError);
}
```

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
1. –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –∑–∞–ø–∏—Å—å —á–µ—Ä–µ–∑ UI
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –∑–∞–ø–∏—Å—å –ø–æ—è–≤–∏–ª–∞—Å—å –≤ `entries` —Ç–∞–±–ª–∏—Ü–µ
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ summary –ø–æ—è–≤–∏–ª—Å—è –≤ `entry_summaries` —Ç–∞–±–ª–∏—Ü–µ
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –º–æ—Ç–∏–≤–∞—Ü–∏–æ–Ω–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ —Ç–µ–ø–µ—Ä—å –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

**Acceptance Criteria:**
- ‚úÖ –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–ø–∏—Å–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∏ entry, –∏ entry_summary
- ‚úÖ –ú–æ—Ç–∏–≤–∞—Ü–∏–æ–Ω–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç —Ä–µ–∞–ª—å–Ω—ã–µ –∑–∞–ø–∏—Å–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ –ù–µ—Ç –æ—à–∏–±–æ–∫ –≤ –∫–æ–Ω—Å–æ–ª–∏

---

#### **–î–ï–ù–¨ 3-4: –°–æ–∑–¥–∞—Ç—å Stats Edge Function** üìä

**–¢–∞—Å–∫–∞:** `üìä –°–æ–∑–¥–∞—Ç—å Stats Edge Function`

**–¶–µ–ª—å:** –°–æ–∑–¥–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—É—é Edge Function –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

**–®–∞–≥–∏:**

1. **–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é —Ñ—É–Ω–∫—Ü–∏—é:**
```bash
cd "/Users/rustamkarimov/DEV/UNITY ‚Äî v 2"
supabase functions new stats
```

2. **–°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª `supabase/functions/stats/index.ts`:**

```typescript
import { Hono } from 'npm:hono';
import { cors } from 'npm:hono/cors';
import { createClient } from 'jsr:@supabase/supabase-js@2';

const app = new Hono();

app.use('*', cors({
  origin: '*',
  allowMethods: ['GET', 'OPTIONS'],
  allowHeaders: ['Content-Type', 'Authorization'],
}));

const supabaseUrl = Deno.env.get('SUPABASE_URL')!;
const supabaseServiceKey = Deno.env.get('SUPABASE_SERVICE_ROLE_KEY')!;
const supabase = createClient(supabaseUrl, supabaseServiceKey);

// GET /stats/user/:userId
app.get('/stats/user/:userId', async (c) => {
  try {
    const userId = c.req.param('userId');

    const { data: entries, error } = await supabase
      .from('entries')
      .select('*')
      .eq('user_id', userId)
      .order('created_at', { ascending: false });

    if (error) throw error;

    // –í—ã—á–∏—Å–ª–∏—Ç—å —Å–µ—Ä–∏—é (streak)
    const streak = calculateStreak(entries);
    
    // –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–π
    const moodDistribution = calculateMoodDistribution(entries);
    
    // –¢–æ–ø –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
    const topCategories = calculateTopCategories(entries);

    // –£—Ä–æ–≤–µ–Ω—å (1 –∑–∞–ø–∏—Å—å = 10 XP, —É—Ä–æ–≤–µ–Ω—å –∫–∞–∂–¥—ã–µ 100 XP)
    const totalXP = entries.length * 10;
    const level = Math.floor(totalXP / 100) + 1;
    const nextLevelProgress = (totalXP % 100);

    return c.json({
      success: true,
      stats: {
        totalEntries: entries.length,
        currentStreak: streak.current,
        longestStreak: streak.longest,
        level,
        nextLevelProgress,
        moodDistribution,
        topCategories,
        lastEntryDate: entries[0]?.created_at,
        thisWeekEntries: entries.filter(e => 
          new Date(e.created_at) > new Date(Date.now() - 7 * 24 * 60 * 60 * 1000)
        ).length
      }
    });
  } catch (error) {
    console.error('Error in /stats/user:', error);
    return c.json({ success: false, error: error.message }, 500);
  }
});

// GET /stats/achievements/:userId
app.get('/stats/achievements/:userId', async (c) => {
  try {
    const userId = c.req.param('userId');

    const { data: entries } = await supabase
      .from('entries')
      .select('*')
      .eq('user_id', userId);

    const achievements = calculateAchievements(entries);

    return c.json({
      success: true,
      achievements,
      totalBadges: achievements.filter(a => a.earned).length
    });
  } catch (error) {
    console.error('Error in /stats/achievements:', error);
    return c.json({ success: false, error: error.message }, 500);
  }
});

// –£—Ç–∏–ª–∏—Ç—ã (—Å–º. MIGRATION_PLAN_STEP_BY_STEP.md)
function calculateStreak(entries) { /* ... */ }
function calculateMoodDistribution(entries) { /* ... */ }
function calculateTopCategories(entries) { /* ... */ }
function calculateAchievements(entries) { /* ... */ }

Deno.serve(app.fetch);
```

3. **–ó–∞–¥–µ–ø–ª–æ–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é:**
```bash
supabase functions deploy stats
```

**Acceptance Criteria:**
- ‚úÖ –§—É–Ω–∫—Ü–∏—è –¥–µ–ø–ª–æ–∏—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
- ‚úÖ –≠–Ω–¥–ø–æ–∏–Ω—Ç `/stats/user/:userId` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∞–ª—å–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
- ‚úÖ –≠–Ω–¥–ø–æ–∏–Ω—Ç `/stats/achievements/:userId` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è

---

#### **–î–ï–ù–¨ 5: –û–±–Ω–æ–≤–∏—Ç—å ReportsScreen** üéØ

**–¢–∞—Å–∫–∞:** `üéØ –û–±–Ω–æ–≤–∏—Ç—å ReportsScreen –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ`

**–§–∞–π–ª:** `src/components/screens/ReportsScreen.tsx`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**

```typescript
// –ó–∞–º–µ–Ω–∏—Ç—å –º–æ–∫–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –Ω–∞ API –∑–∞–ø—Ä–æ—Å—ã
const [monthlyReport, setMonthlyReport] = useState<any>(null);
const [loading, setLoading] = useState(true);

useEffect(() => {
  async function loadReport() {
    try {
      setLoading(true);
      const response = await apiRequest(
        `/stats/user/${userData.id}`,
        'GET'
      );
      
      if (response.success) {
        setMonthlyReport({
          period: new Date().toLocaleDateString('ru-RU', { 
            month: 'long', 
            year: 'numeric' 
          }),
          totalEntries: response.stats.totalEntries,
          streakDays: response.stats.currentStreak,
          topMood: response.stats.moodDistribution[0]?.mood || "üòä",
          moodDistribution: response.stats.moodDistribution,
          topCategories: response.stats.topCategories,
          keyAchievements: [] // TODO: –ø–æ–ª—É—á–∏—Ç—å –∏–∑ AI
        });
      }
    } catch (error) {
      console.error('Failed to load report:', error);
    } finally {
      setLoading(false);
    }
  }

  if (userData?.id) {
    loadReport();
  }
}, [userData?.id]);
```

**Acceptance Criteria:**
- ‚úÖ ReportsScreen –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–µ–∞–ª—å–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ –ù–µ—Ç –º–æ–∫–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –î–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –Ω–æ–≤–æ–π –∑–∞–ø–∏—Å–∏

---

#### **–î–ï–ù–¨ 6: –û–±–Ω–æ–≤–∏—Ç—å AchievementsScreen** üèÜ

**–¢–∞—Å–∫–∞:** `üèÜ –û–±–Ω–æ–≤–∏—Ç—å AchievementsScreen –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ`

**–§–∞–π–ª:** `src/components/screens/AchievementsScreen.tsx`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:** (–∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ ReportsScreen)

**Acceptance Criteria:**
- ‚úÖ AchievementsScreen –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è
- ‚úÖ –ü—Ä–æ–≥—Ä–µ—Å—Å –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–µ–∞–ª—å–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π
- ‚úÖ –£—Ä–æ–≤–µ–Ω—å –∏ XP –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã

---

#### **–î–ï–ù–¨ 7: –î–æ–±–∞–≤–∏—Ç—å –±–ª–æ–∫ "–õ–µ–Ω—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –∑–∞–ø–∏—Å–µ–π"** üìù

**–¢–∞—Å–∫–∞:** `üìù –î–æ–±–∞–≤–∏—Ç—å –±–ª–æ–∫ '–õ–µ–Ω—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –∑–∞–ø–∏—Å–µ–π' –Ω–∞ –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω`

**–°–æ–≥–ª–∞—Å–Ω–æ Figma –¥–∏–∑–∞–π–Ω—É:**
- –ë–ª–æ–∫ –ø–æ–¥ –º–æ—Ç–∏–≤–∞—Ü–∏–æ–Ω–Ω—ã–º–∏ –∫–∞—Ä—Ç–æ—á–∫–∞–º–∏
- –î–æ 3 –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –∑–∞–ø–∏—Å–µ–π
- –ö–∞–∂–¥–∞—è –∑–∞–ø–∏—Å—å: –¥–∞—Ç–∞, –∑–∞–≥–æ–ª–æ–≤–æ–∫, –ø—Ä–µ–≤—å—é —Ç–µ–∫—Å—Ç–∞, –∫–∞—Ç–µ–≥–æ—Ä–∏—è, –ª–∞–π–∫–∏

**–°–æ–∑–¥–∞—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç:** `src/components/RecentEntriesFeed.tsx`

```typescript
interface RecentEntriesFeedProps {
  userId: string;
}

export function RecentEntriesFeed({ userId }: RecentEntriesFeedProps) {
  const [entries, setEntries] = useState<DiaryEntry[]>([]);

  useEffect(() => {
    async function loadEntries() {
      const response = await apiRequest(`/entries/recent/${userId}?limit=3`, 'GET');
      setEntries(response.entries);
    }
    loadEntries();
  }, [userId]);

  return (
    <div className="recent-entries-feed">
      <div className="flex items-center justify-between mb-4">
        <h2 className="text-lg font-semibold">–õ–µ–Ω—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –∑–∞–ø–∏—Å–µ–π</h2>
        <button className="text-blue-600">‚Üí</button>
      </div>

      {entries.map(entry => (
        <div key={entry.id} className="entry-card bg-white border rounded-2xl p-4 mb-3">
          <p className="text-xs text-gray-500">{formatDate(entry.created_at)}</p>
          <h3 className="font-bold text-sm mt-1">{entry.ai_summary}</h3>
          <p className="text-xs text-gray-600 mt-1 line-clamp-2">{entry.text}</p>
          
          <div className="flex items-center justify-between mt-2">
            <span className="bg-purple-100 text-purple-700 text-xs px-3 py-1 rounded-full">
              {entry.category}
            </span>
            <div className="flex items-center gap-2">
              <button className="text-gray-400">üëç</button>
              <button className="text-gray-400">üëé</button>
              <button className="text-gray-400">‚ãÆ</button>
            </div>
          </div>
        </div>
      ))}
    </div>
  );
}
```

**–î–æ–±–∞–≤–∏—Ç—å –≤ AchievementHomeScreen.tsx:**

```typescript
<RecentEntriesFeed userId={userData.id} />
```

**Acceptance Criteria:**
- ‚úÖ –ë–ª–æ–∫ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –ø–æ–¥ –∫–∞—Ä—Ç–æ—á–∫–∞–º–∏
- ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –¥–æ 3 –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –∑–∞–ø–∏—Å–µ–π
- ‚úÖ –î–∏–∑–∞–π–Ω —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç Figma

---

### üìÖ –ù–ï–î–ï–õ–Ø 2: –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò (7 –¥–Ω–µ–π)

#### **–î–ï–ù–¨ 8-9: –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ** üì∏

**–¢–∞—Å–∫–∞:** `üì∏ –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ –≤ –∑–∞–ø–∏—Å–∏`

**–®–∞–≥–∏:**

1. –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ `media_urls` –≤ —Ç–∞–±–ª–∏—Ü—É `entries`
2. –°–æ–∑–¥–∞—Ç—å UI –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ –≤ ChatInputSection
3. –ó–∞–≥—Ä—É–∂–∞—Ç—å —Ñ–æ—Ç–æ –≤ Supabase Storage bucket `diary-media`
4. –°–æ—Ö—Ä–∞–Ω—è—Ç—å URL –≤ `media_urls` –º–∞—Å—Å–∏–≤

**Acceptance Criteria:**
- ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–æ 5 —Ñ–æ—Ç–æ
- ‚úÖ –§–æ—Ç–æ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤ –∑–∞–ø–∏—Å–∏
- ‚úÖ –§–æ—Ç–æ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ Supabase Storage

---

### üìÖ –ù–ï–î–ï–õ–Ø 3: –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø (7 –¥–Ω–µ–π)

#### **–î–ï–ù–¨ 15-21: –†–∞–∑–¥–µ–ª–∏—Ç—å Edge Function** üîß

**–¢–∞—Å–∫–∞:** `üîß –†–∞–∑–¥–µ–ª–∏—Ç—å Edge Function –Ω–∞ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã`

**–ü–ª–∞–Ω:**
1. –°–æ–∑–¥–∞—Ç—å 6 –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π: profiles, entries, motivations, stats, books, admin
2. –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ –∫–æ–¥ –∏–∑ index.ts
3. –û–±–Ω–æ–≤–∏—Ç—å frontend API URLs
4. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–∞–∂–¥—É—é —Ñ—É–Ω–∫—Ü–∏—é
5. –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—É—é make-server-9729c493

**Acceptance Criteria:**
- ‚úÖ –ö–∞–∂–¥–∞—è —Ñ—É–Ω–∫—Ü–∏—è < 500 —Å—Ç—Ä–æ–∫
- ‚úÖ –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–µ–ø–ª–æ—è—Ç—Å—è —É—Å–ø–µ—à–Ω–æ
- ‚úÖ Frontend —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –Ω–æ–≤—ã–º–∏ URL

---

## ‚úÖ –§–ò–ù–ê–õ–¨–ù–û–ï –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï

**–¢–∞—Å–∫–∞:** `‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π`

**–ß–µ–∫–ª–∏—Å—Ç:**
- [ ] –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç entry_summaries
- [ ] –ú–æ—Ç–∏–≤–∞—Ü–∏–æ–Ω–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- [ ] ReportsScreen –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–µ–∞–ª—å–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
- [ ] AchievementsScreen –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è
- [ ] –ë–ª–æ–∫ "–õ–µ–Ω—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –∑–∞–ø–∏—Å–µ–π" —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –í—Å–µ Edge Functions –∑–∞–¥–µ–ø–ª–æ–µ–Ω—ã
- [ ] –ù–µ—Ç –º–æ–∫–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö

---

## üìä –ú–ï–¢–†–ò–ö–ò –£–°–ü–ï–•–ê

**–î–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:**
- Edge Function: 2140 —Å—Ç—Ä–æ–∫ (–Ω–µ –¥–µ–ø–ª–æ–∏—Ç—Å—è)
- –ú–æ–∫–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ: 100%
- entry_summaries: 0 –∑–∞–ø–∏—Å–µ–π
- –°—Ç–æ–∏–º–æ—Å—Ç—å: ~$300/–º–µ—Å—è—Ü

**–ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:**
- Edge Functions: 6 —Ñ—É–Ω–∫—Ü–∏–π –ø–æ ~300 —Å—Ç—Ä–æ–∫
- –†–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ: 100%
- entry_summaries: –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- –°—Ç–æ–∏–º–æ—Å—Ç—å: ~$50/–º–µ—Å—è—Ü

**–≠–ö–û–ù–û–ú–ò–Ø: $250/–º–µ—Å—è—Ü = $3000/–≥–æ–¥** üí∞

---

**–ì–æ—Ç–æ–≤—ã –Ω–∞—á–∞—Ç—å? –ù–∞—á–∏–Ω–∞–µ–º —Å –¢–∞—Å–∫–∏ #1: –ò—Å–ø—Ä–∞–≤–∏—Ç—å entry_summaries!** üöÄ

