# UNITY Flow - Принцип работы системы

## Обзор системы

UNITY - это приложение для ведения дневника достижений с административной панелью для управления пользователями и системой. Система построена на базе React/TypeScript с использованием Supabase для аутентификации и хранения данных.

## Архитектура системы

```
┌─────────────────────────────────────────────────────────────┐
│                        Пользователи                         │
├─────────────────────────────────────────────────────────────┤
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐         │
│  │   Регистрация│  │   Аутенти-  │  │   Использо- │         │
│  │   /Авторизация│  │   фикация   │  │   вание    │         │
│  └─────────────┘  └─────────────┘  └─────────────┘         │
└─────────────────────────────────────────────────────────────┘
┌─────────────────────────────────────────────────────────────┐
│                    Администраторы                          │
├─────────────────────────────────────────────────────────────┤
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐         │
│  │   Доступ к  │  │   Управление│  │   Системные │         │
│  │   админ-    │  │   пользователя-││   настройки│         │
│  │   панели    │  │   ми и подпис- ││            │         │
│  │             │  │   ками      │  └─────────────┘         │
│  └─────────────┘  └─────────────┘                         │
└─────────────────────────────────────────────────────────────┘
┌─────────────────────────────────────────────────────────────┐
│                    База данных (Supabase)                  │
├─────────────────────────────────────────────────────────────┤
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐         │
│  │ Пользователи│  │   Записи    │  │   Подписки  │         │
│  │   данные    │  │ достижений  │  │             │         │
│  └─────────────┘  └─────────────┘  └─────────────┘         │
└─────────────────────────────────────────────────────────────┘
```

## Пользовательский Flow (User Journey)

### 1. Регистрация и Аутентификация

#### Процесс регистрации нового пользователя:
1. **Запуск приложения** → Пользователь видит экран приветствия
2. **Выбор языка** → Система поддерживает 6 языков (RU, EN, ES, DE, FR, ZH, JA)
3. **Ввод данных**:
   - Email адрес
   - Имя пользователя
   - Пароль (мин. 6 символов)
4. **Верификация email** → Письмо с подтверждением на указанный адрес
5. **Создание профиля** → Автоматическое создание профиля в базе данных

#### Процесс входа в систему:
1. **Ввод учетных данных** → Email и пароль
2. **Аутентификация** → Проверка через Supabase Auth
3. **Загрузка профиля** → Получение данных пользователя из базы
4. **Перенаправление** → Переход к основному экрану приложения

#### Социальная аутентификация:
- **Google** → OAuth 2.0 интеграция
- **Facebook** → OAuth 2.0 интеграция
- **Apple ID** → Sign in with Apple
- **Telegram** → Полная авторизация через Telegram с подтягиванием имени из профиля

### 2. Основное использование приложения

#### Главный экран (AchievementHomeScreen):
```
┌─────────────────────────────────────────────────┐
│                Дневник Достижений               │
├─────────────────────────────────────────────────┤
│  ┌─────────────────────────────────────────┐    │
│  │             Мотивационные карточки       │    │
│  └─────────────────────────────────────────┘    │
│  ┌─────────────────────────────────────────┐    │
│  │           Поле ввода записи             │    │
│  └─────────────────────────────────────────┘    │
│  ┌─────────────────────────────────────────┐    │
│  │            История записей              │    │
│  └─────────────────────────────────────────┘    │
└─────────────────────────────────────────────────┘
```

#### Создание записи достижения:
1. **Активация поля ввода** → Нажатие на поле или кнопка "Новая запись"
2. **Ввод текста** → Пользователь описывает свое достижение
3. **Анализ настроения** → AI определяет эмоциональную окраску текста
4. **Категоризация** → Автоматическое определение категории достижения
5. **Сохранение** → Запись сохраняется в базе данных с метаданными:
   - Дата и время создания
   - Категория достижения
   - Эмоциональный тон
   - Количество символов
   - Уникальный ID

#### Просмотр истории:
- **Хронологическая лента** → Записи от новых к старым
- **Фильтрация по категориям** → Работа, Личное, Здоровье, Образование и т.д.
- **Поиск по тексту** → Поиск конкретных записей
- **Избранное** → Отметка важных достижений

### 3. Дополнительные функции пользователя

#### PWA (Progressive Web App):
- **Установка** → Добавление на главный экран мобильного устройства
- **Офлайн режим** → Работа без интернета
- **Push уведомления** → Напоминания о записи достижений
- **Автообновления** → Автоматическое обновление приложения

#### Настройки профиля:
- **Изменение данных** → Имя, email, пароль
- **Языковые настройки** → Выбор предпочитаемого языка
- **Уведомления** → Настройка push уведомлений
- **Тема** → Светлая/темная тема приложения

## Административный Flow (Admin Journey)

### 1. Доступ к админ-панели

#### Аутентификация администратора:
- **Специальный доступ** → Только email `diary@leadshunter.biz` имеет доступ
- **Двухфакторная проверка** → Проверка прав супер-админа при входе
- **Блокировка доступа** → Автоматический редирект для обычных пользователей

### 2. Структура админ-панели

```
┌─────────────────────────────────────────────────────┐
│                 Admin Dashboard                     │
├─────────────────────────────────────────────────────┤
│  ┌─────────────────────────────────────────────┐    │
│  │              Панель навигации               │    │
│  ├─────────────────────────────────────────────┤    │
│  │  • Обзор системы                           │    │
│  │  • Управление пользователями               │    │
│  │  • Управление подписками                   │    │
│  │  • Системные настройки                     │    │
│  └─────────────────────────────────────────────┘    │
│  ┌─────────────────────────────────────────────┐    │
│  │              Основной контент               │    │
│  └─────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────┘
```

### 3. Раздел "Обзор системы" (Overview)

#### Статистика системы:
- **Общее количество пользователей** → Реал-тайм данные из базы
- **Активные пользователи** → Пользователи активные за последние 7 дней
- **Премиум пользователи** → Количество активных премиум подписок
- **Общий доход** → Сумма всех платежей в рублях
- **Новые пользователи сегодня** → Прирост за текущий день
- **Записи достижений** → Общее количество записей в системе
- **PWA установки** → Количество установок приложения

#### Быстрые действия:
- **Настройки PWA** → Управление установкой и обновлениями
- **Push уведомления** → Массовые уведомления пользователям
- **Управление пользователями** → Переход к списку пользователей
- **Управление подписками** → Переход к премиум подпискам

#### Статус системы:
- **База данных** → Статус подключения к Supabase
- **API сервер** → Статус серверных функций
- **Service Worker** → Версия и статус PWA
- **Push уведомления** → Статус системы уведомлений

### 4. Раздел "Управление пользователями" (Users Management)

#### Просмотр пользователей:
- **Поиск и фильтрация**:
  - Поиск по имени или email
  - Фильтр по статусу (Все/Активные/Премиум/Заблокированные)
- **Таблица пользователей**:
  - Имя и email
  - Статус аккаунта
  - Дата регистрации
  - Количество записей
  - Текущий стрик (дней подряд)

#### Действия с пользователями:
- **Выдача премиум** → Активация премиум подписки
- **Отмена премиум** → Деактивация премиум подписки
- **Отправка email** → Прямая отправка сообщений
- **Блокировка аккаунта** → Запрет доступа пользователю

#### Пагинация:
- **50 пользователей на страницу**
- **Навигация по страницам**
- **Общее количество пользователей**

### 5. Раздел "Управление подписками" (Subscriptions)

#### Метрики подписок:
- **Общий доход** → Сумма всех платежей
- **Активных подписок** → Количество активных премиум аккаунтов
- **MRR (Monthly Recurring Revenue)** → Ежемесячный регулярный доход
- **Churn Rate** → Процент оттока пользователей

#### Управление подписками:
- **Таблица активных подписок**:
  - Имя и email пользователя
  - Тип плана (месячный/годовой)
  - Статус подписки
  - Дата начала
  - Следующая дата платежа
  - Сумма платежа

### 6. Раздел "Системные настройки" (Settings)

#### Вкладки настроек:
1. **API** → Управление API ключами и доступами
2. **Языки** → Настройки многоязычности
3. **PWA** → Настройки Progressive Web App
4. **Push уведомления** → Управление системой уведомлений
5. **Общие настройки** → Основные параметры системы
6. **Системные настройки** → Глубокие настройки сервера

#### Поиск по настройкам:
- **Полнотекстовый поиск** по всем параметрам
- **Фильтрация по категориям**
- **Быстрая навигация к нужным настройкам**

## Взаимодействие пользователей и администраторов

### 1. Пользователь → Система → Администратор

#### Автоматическое взаимодействие:
- **Регистрация пользователя** → Логируется в админ-панели
- **Создание записи достижения** → Увеличивает статистику
- **Оформление премиум подписки** → Отражается в финансовой отчетности
- **PWA установка** → Увеличивает счетчик установок

#### Ручное взаимодействие администратора:
- **Мониторинг активности** → Просмотр действий пользователей
- **Управление премиум доступом** → Выдача/отмена премиум функций
- **Блокировка нарушителей** → Запрет доступа проблемным пользователям
- **Рассылка уведомлений** → Массовые сообщения всем пользователям

### 2. Администратор → Пользователи

#### Массовые действия:
- **Push уведомления** → Отправка сообщений всем пользователям
- **Системные обновления** → Обновление PWA приложения
- **Изменение функционала** → Добавление/удаление возможностей

#### Индивидуальные действия:
- **Персональные уведомления** → Отправка email конкретному пользователю
- **Управление подпиской** → Изменение статуса премиум аккаунта
- **Блокировка аккаунта** → Запрет доступа конкретному пользователю

### 3. Обратная связь

#### Пользователь → Администратор:
- **Отзывы и предложения** → Через форму обратной связи
- **Сообщения об ошибках** → Автоматическая отправка логов ошибок
- **Запросы в поддержку** → Через встроенную систему тикетов

#### Администратор → Пользователь:
- **Информационные уведомления** → О новых функциях и обновлениях
- **Техническое обслуживание** → Уведомления о плановых работах
- **Персональные ответы** → На запросы пользователей

## Технические особенности

### Безопасность:
- **Ролевые модели доступа** → Разделение прав пользователей и администраторов
- **Шифрование данных** → Все чувствительные данные зашифрованы
- **Аутентификация** → JWT токены через Supabase Auth
- **API ключи** → Защищенные ключи для серверных функций

### Производительность:
- **Кеширование** → Данные кешируются для быстрой загрузки
- **Ленивая загрузка** → Компоненты загружаются по требованию
- **Оптимизация изображений** → Сжатие медиа файлов
- **CDN** → Использование сети доставки контента

### Мониторинг:
- **Логирование действий** → Все действия пользователей логируются
- **Аналитика использования** → Сбор статистики для улучшения UX
- **Мониторинг ошибок** → Автоматическое отслеживание сбоев
- **Производительность** → Мониторинг скорости работы приложения

## Заключение

Система UNITY представляет собой полнофункциональное приложение для ведения дневника достижений с мощной административной панелью. Четкое разделение ролей между обычными пользователями и администраторами обеспечивает эффективное управление системой и качественное обслуживание пользователей.

Основные принципы:
- **Простота использования** для конечных пользователей
- **Мощные инструменты управления** для администраторов
- **Безопасность и надежность** всех процессов
- **Масштабируемость** для роста пользовательской базы
